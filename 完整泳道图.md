# AIæ–‡å­—äº¤äº’å¼æ¸¸æˆ - å®Œæ•´æ³³é“å›¾

```mermaid
sequenceDiagram
    participant H as ğŸ­ ä¸»æŒäºº
    participant P as ğŸ‘¤ ç©å®¶
    participant FE as ğŸ’» å‰ç«¯
    participant BE as âš™ï¸ åç«¯
    participant AI as ğŸ¤– AIæ™ºèƒ½ä½“
    participant DB as ğŸ—„ï¸ å­˜å‚¨

    H->>FE: åˆ›å»ºæˆ¿é—´
    FE->>BE: POST /rooms
    BE->>DB: å­˜å‚¨Room
    BE-->>FE: roomId
    H->>FE: é…ç½®AI(endpoint/apiKey)
    H->>FE: é…ç½®æ¸¸æˆè§„åˆ™
    FE->>BE: POST /host-config
    BE->>DB: å­˜å‚¨HostConfig
    P->>FE: æµè§ˆæˆ¿é—´åˆ—è¡¨
    FE->>BE: GET /rooms/list
    BE-->>FE: æˆ¿é—´åˆ—è¡¨
    P->>FE: åŠ å…¥æˆ¿é—´
    FE->>BE: POST /rooms/join
    BE-->>H: WebSocketé€šçŸ¥
    H->>FE: å¼€å§‹æ¸¸æˆ
    FE->>BE: POST /rooms/start
    BE->>DB: åˆ›å»ºGameSession
    BE-->>P: WebSocketé€šçŸ¥
    P->>FE: è¯·æ±‚å†³ç­–å»ºè®®
    FE->>BE: GET /decision-options
    BE->>AI: ç”Ÿæˆæ¨èé€‰é¡¹
    AI-->>BE: è¿”å›3-4ä¸ªé€‰é¡¹
    BE-->>FE: é€‰é¡¹åˆ—è¡¨
    FE-->>P: æ˜¾ç¤ºAIæ¨è
    P->>FE: æäº¤å†³ç­–
    FE->>BE: POST /decision
    BE->>DB: å­˜å‚¨PlayerAction
    BE-->>H: WebSocketé€šçŸ¥
    H->>FE: æŸ¥çœ‹æ‰€æœ‰å†³ç­–
    FE->>BE: GET /decisions
    BE-->>FE: å†³ç­–åˆ—è¡¨
    H->>FE: ä¿®æ”¹/æ‰¹å‡†å†³ç­–
    FE->>BE: PUT /decision
    H->>FE: è§¦å‘æ¨æ¼”
    FE->>BE: POST /inference
    BE->>BE: æ„å»ºPrompt(è§„åˆ™+å†³ç­–+äº‹ä»¶)
    BE->>AI: è°ƒç”¨AI API
    AI-->>BE: TurnResultDTO(å™äº‹/äº‹ä»¶/æ’è¡Œæ¦œ)
    BE->>DB: ç¼“å­˜æ¨æ¼”ç»“æœ
    BE-->>P: WebSocketå¹¿æ’­
    BE-->>H: WebSocketå¹¿æ’­
    P->>FE: æŸ¥çœ‹æ¨æ¼”ç»“æœ
    FE->>BE: GET /inference/result
    BE->>DB: è¯»å–ç¼“å­˜
    BE-->>FE: å®Œæ•´ç»“æœæ•°æ®
    FE-->>P: æ’­æ”¾å™äº‹åŠ¨ç”»
    FE-->>P: æ˜¾ç¤ºæ’è¡Œæ¦œ
    FE-->>P: æ˜¾ç¤ºå¦è±¡/æˆå°±
    H->>FE: è¿›å…¥ä¸‹ä¸€å›åˆ
    FE->>BE: POST /next-round
    BE-->>P: WebSocketé€šçŸ¥(å¾ªç¯ç»§ç»­)
```
