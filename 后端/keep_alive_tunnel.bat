@echo off
title 云端连接器 
color 0A

:loop
cls
echo ========================================================
echo        正在启动阿里云数据库连接隧道...
echo ========================================================
echo.
echo [提示] 正在连接 47.243.153.225 ...
echo [提示] 如果你是第一次连接，可能会询问 (yes/no)，请输入 yes
echo [提示] 接下来请输入密码 (密码输入时不可见，输完回车)
echo.

:: 核心连接命令
:: -N: 不执行远程命令
:: -L: 端口映射 (本地27017 -> 远程27017)
:: ServerAliveInterval: 防止超时断开
ssh -N -o ServerAliveInterval=60 -o ServerAliveCountMax=3 -o ExitOnForwardFailure=yes -L 27017:127.0.0.1:27017 root@47.243.153.225

:: 如果 ssh 命令成功执行并保持连接，下面的代码不会被执行，直到连接断开
:: 如果 ssh 命令立即退出（通常意味着连接失败），则会执行下面的错误处理

if %ERRORLEVEL% EQU 0 (
    :: 正常断开（通常用户手动关闭，很少走到这里）
    goto loop
) else (
    echo.
    echo ========================================================
    echo [警告] 隧道意外断开了！(错误码: %ERRORLEVEL%)
    echo [警告] 3秒后尝试自动重连...
    echo ========================================================
    timeout /t 3 >nul
    goto loop
)
