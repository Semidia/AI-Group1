# 第一阶段测试说明

## 测试目标

验证项目基础搭建是否完成，包括：
- 后端服务器启动和基础功能
- 前端项目启动和路由
- 数据库连接（PostgreSQL）
- Redis连接
- WebSocket连接
- 代码质量检查

## 测试前准备

### 1. 安装依赖

```bash
# 后端
cd ../../正式搭建/backend
npm install

# 前端
cd ../../正式搭建/frontend
npm install
```

### 2. 启动数据库服务

```bash
cd ../../正式搭建/backend
docker-compose up -d
```

### 3. 配置环境变量

```bash
# 后端
cd ../../正式搭建/backend
cp .env.example .env
# 编辑 .env 文件，确保配置正确

# 前端（可选）
cd ../../正式搭建/frontend
cp .env.example .env
```

### 4. 运行数据库迁移

```bash
cd ../../正式搭建/backend
npm run prisma:migrate
```

## 测试步骤

### 测试1：后端服务器启动

```bash
cd ../../正式搭建/backend
npm run dev
```

**预期结果**：
- 服务器在端口 3000 启动
- 控制台显示 "Server running on port 3000"
- 没有错误信息

### 测试2：健康检查接口

打开新终端，运行：
```bash
curl http://localhost:3000/health
```

或使用浏览器访问：http://localhost:3000/health

**预期结果**：
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

### 测试3：数据库连接测试

访问：http://localhost:3000/api/test/db

**预期结果**：
```json
{
  "status": "ok",
  "message": "Database connected"
}
```

### 测试4：Redis连接测试

访问：http://localhost:3000/api/test/redis

**预期结果**：
```json
{
  "status": "ok",
  "message": "Redis connected"
}
```

### 测试5：前端服务器启动

```bash
cd ../../正式搭建/frontend
npm run dev
```

**预期结果**：
- 前端在端口 5173 启动
- 浏览器访问 http://localhost:5173 能看到页面

### 测试6：前端路由测试

- 访问 http://localhost:5173/ → 显示首页
- 访问 http://localhost:5173/login → 显示登录页
- 访问 http://localhost:5173/register → 显示注册页

### 测试7：WebSocket连接测试

访问：http://localhost:5173/test-websocket

**预期结果**：
- 页面显示 "WebSocket Test"
- 状态显示 "Connected"
- 控制台显示连接成功消息

### 测试8：代码质量检查

```bash
# 后端
cd ../../正式搭建/backend
npm run lint

# 前端
cd ../../正式搭建/frontend
npm run lint
```

**预期结果**：没有 lint 错误

### 测试9：代码格式化

```bash
# 后端
cd ../../正式搭建/backend
npm run format

# 前端
cd ../../正式搭建/frontend
npm run format
```

**预期结果**：代码格式化成功，没有错误

### 测试10：Docker容器状态

```bash
cd ../../正式搭建/backend
docker ps
```

**预期结果**：
- `game-postgres` 容器运行中
- `game-redis` 容器运行中

## 自动化测试脚本

运行自动化测试脚本：

```bash
# Windows PowerShell
cd 各阶段测试用/第一阶段测试
.\test-phase1.ps1

# Linux/Mac
cd 各阶段测试用/第一阶段测试
chmod +x test-phase1.sh
./test-phase1.sh
```

## 测试检查清单

- [ ] 后端服务器能正常启动
- [ ] 健康检查接口返回正确
- [ ] 数据库连接正常
- [ ] Redis连接正常
- [ ] 前端服务器能正常启动
- [ ] 前端路由正常工作
- [ ] WebSocket连接正常
- [ ] 代码质量检查通过
- [ ] Docker容器运行正常
- [ ] 所有测试通过

## 常见问题

### 问题1：数据库连接失败
**解决方案**：
1. 检查 Docker 容器是否运行：`docker ps`
2. 检查 .env 文件中的 DATABASE_URL 配置
3. 尝试重启容器：`docker-compose restart`

### 问题2：端口被占用
**解决方案**：
1. 修改 backend/.env 中的 PORT
2. 修改 frontend/vite.config.ts 中的 port

### 问题3：Prisma 迁移失败
**解决方案**：
1. 确保数据库容器已启动
2. 检查 DATABASE_URL 是否正确
3. 运行 `npm run prisma:generate` 重新生成客户端

### 问题4：WebSocket 连接失败
**解决方案**：
1. 确保后端服务器正在运行
2. 检查 CORS 配置
3. 检查浏览器控制台的错误信息

## 测试通过标准

所有测试项都通过后，第一阶段才算完成。如果某个测试失败，需要修复问题后重新测试。

