# 前三阶段联合测试使用说明

## 快速开始

### 1. 启动服务

**终端1：启动后端服务**
```powershell
cd "重新打造/正式搭建/backend"
npm run dev
```

**终端2：启动前端服务（可选，用于手动测试）**
```powershell
cd "重新打造/正式搭建/frontend"
npm run dev
```

### 2. 运行联合测试

**终端3：运行测试脚本**
```powershell
cd "重新打造/各阶段测试用/全阶段共同测试"
.\test-phase1-3.ps1
```
> 如仅需阶段1/2，可运行 `.\test-phase1-2.ps1`。

## 测试流程说明

### 第一阶段测试（自动）
1. ✅ 检查后端服务状态（http://localhost:3000）
2. ✅ 检查前端服务状态（http://localhost:5173，可选）
3. ✅ 测试数据库连接（PostgreSQL）
4. ✅ 测试Redis连接（可选）

### 第二阶段测试（自动，如果第一阶段通过）
1. ✅ 用户注册测试
2. ✅ 用户登录测试
3. ✅ 获取用户信息测试
4. ✅ 更新用户信息测试
5. ✅ Token刷新测试
6. ✅ 忘记密码测试
7. ✅ 未授权访问测试

### 第三阶段测试（自动，如果前两阶段通过）
1. ✅ 创建房间
2. ✅ 房间列表
3. ✅ 加入房间
4. ✅ 离开房间

## 预期输出

### 成功情况
```
========================================
第一阶段测试：项目基础搭建
========================================

1.1 检查服务状态...
   ✓ 后端服务运行正常
   ✓ 前端服务运行正常

1.2 测试数据库连接...
   ✓ 数据库连接正常

1.3 测试Redis连接...
   ✓ Redis连接正常

✓ 第一阶段测试通过！

========================================
第二阶段测试：用户认证系统
========================================

2.1 测试用户注册...
   ✓ 注册成功
     用户名: testuser_1234
     邮箱: test_1234@example.com

2.2 测试用户登录...
   ✓ 登录成功

2.3 测试获取用户信息...
   ✓ 获取用户信息成功

...

========================================
🎉 所有测试通过！
========================================
```

### 失败情况
如果任一阶段失败，会显示对应错误，后续阶段不再执行：
```
✗ 后端服务未运行，请先启动后端服务
   启动命令: cd 重新打造/正式搭建/backend && npm run dev
```

## 故障排查

### 问题1：后端服务未运行
**错误信息**：`✗ 后端服务未运行`

**解决方案**：
1. 检查后端服务是否在运行：访问 http://localhost:3000/health
2. 如果未运行，启动后端：`cd backend && npm run dev`
3. 检查端口3000是否被占用

### 问题2：数据库连接失败
**错误信息**：`✗ 数据库连接失败`

**解决方案**：
1. 检查PostgreSQL是否运行：`docker ps` 或检查PostgreSQL服务
2. 检查`.env`文件中的`DATABASE_URL`配置
3. 执行数据库迁移：`cd backend && npm run prisma:migrate`

### 问题3：注册失败
**错误信息**：`✗ 注册失败`

**解决方案**：
1. 检查数据库表是否已创建
2. 查看后端日志获取详细错误
3. 确保数据库迁移已执行

## 测试账号信息（阶段2）

测试脚本会自动创建测试账号，测试完成后会显示：
```
测试账号信息:
  用户名: testuser_xxxx
  邮箱: test_xxxx@example.com
  密码: password123
```

可以使用这些账号在前端界面进行手动测试。

## 手动测试建议

测试脚本通过后，建议进行以下手动测试：

1. **登录测试**
   - 访问 http://localhost:5173/login
   - 使用测试账号登录
   - 验证是否成功跳转到首页

2. **注册测试**
   - 访问 http://localhost:5173/register
   - 注册新账号
   - 验证是否自动登录

3. **路由守卫测试**
   - 清除localStorage中的token
   - 访问首页，验证是否跳转到登录页

4. **忘记密码测试**
   - 访问 http://localhost:5173/forgot-password
   - 输入邮箱，查看后端日志获取resetToken
   - 访问 http://localhost:5173/reset-password?token=xxx 重置密码

## 注意事项

1. **服务启动顺序**：先启动后端，再运行测试脚本
2. **数据库迁移**：确保已执行数据库迁移
3. **环境变量**：确保`.env`文件配置正确
4. **端口占用**：确保3000和5173端口未被占用

## 已知问题
- 未授权访问在阶段1/2脚本中返回500（期望401），不影响主链路；后端修复后可回归验证。

## 下一步

完成前三阶段后，继续前端房间界面与实时通信联调（房间列表/创建/等待页，对接 `/api/rooms/*` + WS）。

