# AI文字交互式游戏前端需求文档

## 1. 项目概述

> 进度与验收（前端侧状态说明）  
> - 后端阶段1/2/3 已通过自动化测试；前端未运行自动化脚本，界面联调待完成。  
> - 需对接接口：`/api/rooms/create|list|{id}/join|leave`，并在等待页订阅 `player_joined/player_left/system_message`。  
> - 待关注：未授权时后端目前返回 500（期望 401），前端应保留全局401跳转逻辑，后端修复后再回归。

### 1.1 项目简介
**游戏名称**：《凡墙皆是门》

本项目是AI文字交互式多人竞争博弈游戏《凡墙皆是门》的前端应用。玩家通过文字指令进行游戏，实时接收AI生成的剧情和决策结果，体验多人同步的竞争博弈乐趣。

### 1.2 核心特性
- **文字交互界面**：纯文字交互，通过自然语言指令进行游戏
- **实时状态同步**：WebSocket实时接收游戏状态更新
- **AI剧情展示**：流畅展示AI生成的剧情和决策结果
- **多人竞争界面**：清晰展示玩家状态、排名和竞争关系
- **响应式设计**：支持PC、平板、手机多端访问

### 1.3 技术栈建议
- **前端框架**：React 18+ / Vue 3+ / Next.js
- **状态管理**：Redux Toolkit / Zustand / Pinia
- **UI组件库**：Ant Design / Material-UI / Element Plus
- **实时通信**：Socket.io-client / WebSocket API
- **路由管理**：React Router / Vue Router
- **HTTP客户端**：Axios / Fetch API
- **样式方案**：Tailwind CSS / Styled-components / CSS Modules
- **构建工具**：Vite / Webpack
- **类型检查**：TypeScript（强烈推荐）

## 2. 页面结构设计

### 2.1 页面路由规划

```
/ (首页)
├── /login (登录页)
├── /register (注册页)
├── /home (主页)
│   ├── /rooms (房间列表)
│   ├── /rooms/create (创建房间)
│   ├── /rooms/:roomId (房间详情/等待页)
│   ├── /rooms/:roomId/host (主持人初始化设定页)
│   └── /history (游戏历史)
├── /game/:sessionId (游戏主界面)
│   └── /game/:sessionId/panel (面板器页面)
└── /profile (个人中心)
    ├── /profile/info (个人信息)
    └── /profile/settings (设置)
```

### 2.2 页面功能说明

#### 2.2.0 首页 (`/`)
- **返回按钮**（左上角）
  - 首页为根页面，返回按钮可隐藏或显示为"返回登录"（如果从登录页跳转而来）
  - 返回按钮样式：图标+文字，固定在左上角

- **游戏名称展示**
  - **游戏名称**：《凡墙皆是门》（醒目显示，作为页面主标题）
  - 游戏名称样式：大号字体，居中或顶部显示，可配合Logo设计
  - 游戏副标题/简介（可选）：AI文字交互式多人竞争博弈游戏

- **主要内容区**
  - 游戏介绍/特色展示
  - 快速开始按钮（跳转到登录或主页）
  - 游戏规则/玩法说明（可选）
  - 最新动态/公告（可选）
  - **"进入编辑模式"按钮**（仅管理员或特定权限用户可见）
    - 点击后进入帮助内容编辑模式
    - 可以编辑游戏说明/帮助内容
    - 编辑完成后保存，所有玩家和主持人看到的帮助内容会更新

- **导航链接**
  - 登录链接
  - 注册链接
  - 关于游戏链接（可选）

#### 2.2.1 登录/注册页
- **返回按钮**（左上角）
  - 登录页：返回首页
  - 注册页：返回登录页或首页
  - 返回按钮样式：图标+文字，固定在左上角

- **登录页** (`/login`)
  - **游戏名称显示**：《凡墙皆是门》（页面顶部或Logo位置）
  - 用户名/邮箱登录
  - 密码输入
  - 记住我选项
  - 忘记密码链接
  - 跳转注册页链接
  - 登录按钮（加载状态）

- **注册页** (`/register`)
  - **游戏名称显示**：《凡墙皆是门》（页面顶部或Logo位置）
  - 用户名输入（实时验证）
  - 邮箱输入（格式验证）
  - 密码输入（强度提示）
  - 确认密码
  - 昵称输入
  - 注册协议勾选
  - 注册按钮（加载状态）

#### 2.2.2 主页 (`/home`)
- **返回按钮**（左上角）
  - 返回首页或上一页
  - 返回按钮样式：图标+文字，固定在左上角

- **导航栏**
  - **游戏名称显示**：《凡墙皆是门》（醒目显示，可作为Logo或标题）
  - **帮助按钮**（右上角或导航栏）
    - 点击后显示游戏说明/帮助内容
    - 帮助内容从服务器获取（可通过首页编辑模式修改）
    - 帮助弹窗/侧边栏，可关闭
  - 用户头像和昵称（下拉菜单：个人中心、设置、退出）
  - 通知图标（消息提醒）
  - 用户等级和经验值显示

- **侧边栏/导航菜单**
  - 房间列表
  - 创建房间
  - 游戏历史
  - 个人中心

- 在册用户管理视图
  - 首页显示“在册用户”按钮，点击后打开用户列表抽屉
  - 仅登录用户可见入口；未登录时不展示或引导先登录
  - 列表展示字段：用户ID、用户名、昵称、状态（正常/已冻结）、是否在线、所在房间（名称+ID）、最近登录时间
  - 支持按状态筛选（全部/正常/已冻结），支持分页
  - 开发者密令：在面板内提供“开发者密令”输入框，输入 `wskfz` 且当前账号为开发者时，解锁管理操作（冻结/解冻/删除）
  - 管理操作：调用后端 `/api/admin/users` 相关接口，对选中用户执行冻结/解冻/物理删除，操作结果在表格中即时刷新

- 在线房间管理视图
  - 首页显示“在线房间”按钮，点击后打开在线房间抽屉
  - 默认展示活跃房间（等待中/游戏中），支持按状态筛选（活跃/仅等待/仅进行/已关闭/全部）
  - 列表字段：房间ID、名称、状态、人数（当前/上限）、房主昵称/用户名、创建时间
  - 开发者密令：在面板内提供“开发者密令”输入框，输入 `wskfz` 且当前账号为开发者时，解锁“关闭房间”操作
  - 管理操作：调用后端 `POST /api/admin/rooms/{room_id}/close`，强制关闭选中房间，刷新列表

- **主要内容区**
  - 默认显示房间列表或欢迎信息
  - 快速开始游戏按钮

#### 2.2.3 房间列表页 (`/rooms`)
- **返回按钮**（左上角）
  - 返回主页
  - 返回按钮样式：图标+文字，固定在左上角

- **帮助按钮**（右上角）
  - 点击后显示游戏说明/帮助内容

- **房间筛选**
  - 状态筛选（等待中/游戏中）
  - 游戏模式筛选
  - 搜索框（房间名称）

- **房间卡片列表**
  - 房间名称
  - 创建者/主持人信息（显示后端返回的 `hostName`，无昵称则回退用户名）
  - 当前玩家数/最大玩家数
  - 游戏模式标签
  - 房间状态（等待中/游戏中）
  - 加入按钮（需要密码的房间显示锁图标）
  - 刷新按钮
  - **页面滚动要求**：保持浏览器垂直滚动条可用（body/root 溢出时可滚动），避免全屏 flex 居中导致无法滚动查看列表

- **分页组件**
  - 页码导航
  - 每页数量选择

#### 2.2.4 创建房间页 (`/rooms/create`)
- **返回按钮**（左上角）
  - 返回房间列表页
  - 返回按钮样式：图标+文字，固定在左上角

- **帮助按钮**（右上角）
  - 点击后显示游戏说明/帮助内容

- **房间配置表单**
  - 房间名称输入
  - 最大玩家数选择（2-10人）
  - 游戏模式选择（竞争/合作/自由）
  - 游戏难度选择（简单/中等/困难）
  - 房间密码设置（可选，开关控制）
  - 高级设置（展开/收起）
    - 游戏时长限制
    - 回合数限制
    - 其他自定义规则

- **操作按钮**
  - 创建房间按钮
  - 取消按钮

#### 2.2.x 第三阶段交付要点（当前迭代）
- API 对齐：调用后端 `/api/rooms/create`、`/api/rooms/list`、`/api/rooms/{room_id}/join`、`/api/rooms/{room_id}/leave`。
- 页面最小流：房间列表（显示状态/人数/模式/密码标记）→ 创建房间 → 等待页（展示成员/状态，准备按钮可后续实现）。
- WebSocket：在房间等待页订阅 `player_joined` / `player_left` / `system_message`，实时刷新成员。
- 状态管理：房间列表可用 Zustand/Redux 管理分页与筛选；等待页用局部状态 + socket 订阅。
- 错误处理：人数已满、密码错误、房间不存在、未登录（401）均需提示；token 过期跳转登录（沿用现有拦截器）。
- 测试对齐：按照 `重新打造/各阶段测试用/第三阶段测试/test-phase3.ps1` 的接口约定联调。

#### 2.2.5 房间等待页 (`/rooms/:roomId`)
- **返回按钮**（左上角）
  - 返回房间列表页
  - 返回按钮样式：图标+文字，固定在左上角

- **帮助按钮**（右上角）
  - 点击后显示游戏说明/帮助内容
  - 玩家和主持人都可以看到

- **房间信息展示**
  - 房间名称和状态
  - 房间配置信息
  - 创建者/主持人信息
  - 初始化状态指示（未配置/配置中/已完成）

- **玩家列表**
  - 玩家头像和昵称
  - 玩家等级
  - 玩家状态（已准备/未准备）
  - 准备按钮（未准备玩家）
  - 踢出玩家按钮（仅主持人可见）

- **聊天区域**（可选）
  - 消息列表
  - 消息输入框
  - 发送按钮

- **操作区域**
  - 进入初始化设定按钮（仅主持人可见，未完成初始化时显示）
  - 开始游戏按钮（仅主持人可见，需完成初始化设定）
  - 离开房间按钮
  - 房间设置按钮（仅主持人可见）

#### 2.2.6 主持人初始化设定页 (`/rooms/:roomId/host`)
- **返回按钮**（左上角）
  - 返回房间等待页
  - 返回按钮样式：图标+文字，固定在左上角

- **帮助按钮**（右上角）
  - 点击后显示游戏说明/帮助内容

- **页面权限**
  - 仅主持人可访问
  - 非主持人访问时提示并跳转

- **配置步骤导航**
  - 步骤1：API配置
  - 步骤2：游戏规则
  - 步骤3：玩家位数
  - 步骤指示器（当前步骤高亮）

- **步骤1：API配置**
  - **AI服务提供商选择**
    - 下拉选择：DeepSeek（默认）/ OpenAI / 自定义
    - 选择后自动填充默认配置
  
  - **API端点配置**
    - 端点URL输入框
    - 默认值：DeepSeek API地址
    - URL格式验证
  
  - **请求方法选择**
    - 下拉选择：POST（默认）/ GET / PUT / DELETE
  
  - **请求头配置**
    - 键值对编辑器
    - 默认项：
      - Content-Type: application/json
      - Authorization: Bearer {token}
    - 添加/删除请求头
    - Token输入框（敏感信息，可隐藏显示）
  
  - **请求体模板配置**
    - 代码编辑器（支持JSON格式）
    - 语法高亮
    - 模板变量提示（如 {messages}, {model} 等）
    - 默认模板显示
  
  - **网络权限配置**
    - CORS启用开关
    - 代理设置（可选）
    - 超时设置（秒）
  
  - **配置测试按钮**
    - 测试API连接
    - 显示测试结果（成功/失败）
    - 错误信息提示

- **步骤2：游戏规则配置**
  - **规则输入区域**
    - 多行文本编辑器
    - 支持Markdown格式
    - 字符计数
    - 规则模板选择（常用规则模板）
  
  - **规则预览**
    - 实时预览格式化后的规则
    - 规则结构检查
  
  - **规则模板管理**
    - 保存当前规则为模板
    - 加载已有模板
    - 模板列表展示

- **步骤3：玩家位数配置**
  - **决策主体数量设置**
    - 数字输入框
    - 范围：2-20
    - 说明文字：本场游戏的决策主体总数
  
  - **人类玩家数量设置**
    - 数字输入框
    - 范围：1-{决策主体数}
    - 说明文字：允许加入的人类玩家数量
    - 实时验证：不能超过决策主体数
  
  - **AI玩家数量显示**
    - 自动计算：决策主体数 - 人类玩家数
    - 只读显示
    - 说明文字：系统自动创建的AI玩家数量
  
  - **决策时限设置**
    - 数字输入框（单位：分钟）
    - 默认值：4分钟
    - 范围：1-30分钟
    - 说明文字：每回合玩家决策的时间限制
    - 超时处理策略选择（自动提交/跳过/惩罚）
  
  - **配置预览**
    - 显示配置摘要
    - 玩家分配预览

- **操作按钮**
  - 上一步按钮（步骤2、3显示）
  - 下一步按钮（步骤1、2显示）
  - 保存当前步骤按钮（自动保存）
  - 完成初始化按钮（步骤3显示）
  - 取消按钮（返回房间等待页）

- **配置状态提示**
  - 已保存提示
  - 未完成配置提示
  - 配置验证错误提示

#### 2.2.7 游戏主界面 (`/game/:sessionId`)
- **返回按钮**（左上角）
  - 返回房间等待页或主页
  - 返回按钮样式：图标+文字，固定在左上角
  - 返回前确认（防止误操作丢失游戏进度）

- **帮助按钮**（右上角）
  - 点击后显示游戏说明/帮助内容
  - 玩家和主持人都可以看到
  - 帮助内容可在游戏过程中随时查看

- **游戏状态栏**（顶部）
  - 当前回合数
  - 回合阶段显示（决策阶段/审核阶段/推演阶段/结果阶段）
  - **决策倒计时**（决策阶段显示）
    - 圆形进度条
    - 剩余时间显示（MM:SS格式）
    - 警告提示（剩余30秒时变红）
    - 超时提示
  - 游戏状态（进行中/暂停/已结束）
  - 退出游戏按钮

- **左侧面板**：玩家信息
  - **面板器按钮**（顶部）
    - 位置：左侧面板顶部，在当前玩家信息上方
    - 样式：图标+文字"面板器"，醒目标识
    - 点击后跳转到面板器页面（`/game/:sessionId/panel`）
    - 按钮状态：游戏进行中时可用
  - 当前玩家信息（高亮显示）
    - 头像、昵称、等级
    - 资源显示（金币、能量等）
    - 状态属性（生命值、攻击力等）
    - **决策状态指示**（决策阶段显示）
      - 已提交：绿色对勾
      - 未提交：红色警告
      - 提交时间显示
  - 其他玩家列表
    - 玩家头像和昵称
    - 资源概览
    - **决策状态指示器**（决策阶段显示）
      - 已提交：绿色对勾图标
      - 未提交：灰色待提交图标
      - 悬停显示提交时间
    - 状态指示器

- **中间面板**：游戏主区域
  - **剧情展示区**
    - AI生成的剧情文本（打字机效果）
    - 场景描述
    - 事件提示
    - 历史剧情滚动查看
  - **操作输入区**（决策阶段显示）
    - **决策选项区域**（AI生成，每回合3个选项）
      - 选项列表（复选框，支持多选）
        - 每个选项显示：
          - 选项文本（如"攻击敌人A"）
          - 预期效果提示（如"可能造成15点伤害"）
          - 选项类别标签（攻击/防御/合作/探索/交易等）
        - 选项加载状态（生成中显示骨架屏）
        - 选项刷新按钮（每回合限制刷新1次）
        - 选项说明："AI为您推荐的决策选项，可多选组合"
      - 选项选择提示：
        - 已选择X个选项
        - 多选组合说明："多个选项将组合执行，主持人可调整"
    - **决策输入框**（自由输入，支持多行）
      - 输入框占位符："可输入详细指令，或补充说明已选选项"
      - 支持与选项组合使用
      - 字符计数显示
      - 输入提示/建议（可选）
    - **提交按钮**
      - 按钮状态：
        - 未选择选项且未输入文本：禁用
        - 已选择选项或已输入文本：可用
      - 提交时显示加载状态
      - 已提交后禁用，显示"已提交"提示
      - 提交时间显示
    - **已提交提示**（提交后显示）
      - 显示提交的选项（如有）
      - 显示提交的自定义文本（如有）
      - 显示提交时间
    - **公开声明按钮**（决策阶段显示）
      - 点击后弹出公开声明编辑弹窗
      - 输入声明内容（文字，支持多行）
      - 发送按钮（发送给所有玩家）
      - 取消按钮
      - 声明内容长度限制提示
    - 操作历史记录（可展开/收起）
  - **审核区域**（审核阶段，仅主持人可见）
    - 所有玩家决策列表
    - 决策详情查看
    - 临时事件/规则添加面板
    - 提交给AI按钮

- **右侧面板**：游戏信息
  - **排名面板**
    - 实时排名列表
    - 排名变化动画
  - **资源面板**
    - 全局资源统计
    - 资源变化趋势
  - **决策状态面板**（决策阶段显示）
    - 决策进度（已提交/总数）
    - 各玩家决策状态列表
    - 未提交玩家提醒
  - **任务/目标面板**
    - 当前任务列表
      - 任务标题和描述
      - 任务类型标签（收集/战斗/探索/合作）
      - 任务进度条
      - 任务奖励显示
      - 任务截止时间
      - 任务状态（进行中/已完成/已失败）
    - 任务详情查看（点击展开）
    - 任务完成提示
  - **资源交易面板**（可选，可折叠）
    - 交易请求列表
    - 发起交易按钮
    - 待处理交易通知
    - 交易历史记录
  - **合作申请面板**（可选，可折叠）
    - 合作申请请求列表
    - 发起合作申请按钮
    - 待处理合作申请通知
    - 合作申请历史记录
    - 谈判中的合作申请（显示谈判轮次）
  - **临时事件/规则面板**（审核阶段，仅主持人可见）
    - 当前回合临时事件列表
    - 当前回合临时规则列表
    - 多回合规则列表
    - 添加按钮
  - **多回合事件进度面板**（所有玩家可见）
    - 活跃的多回合事件列表
    - 每个事件显示：
      - 事件内容描述
      - 进度条（当前进度/目标进度）
      - 进度百分比显示
      - 事件状态（进行中/已完成/已失败）
      - 进度历史时间线（可展开查看）
      - 最后更新回合数
    - 事件完成/失败提示
    - 自动刷新（实时更新）
  - **游戏存档面板**（可选，可折叠）
    - 存档列表
    - 保存游戏按钮
    - 恢复游戏按钮（仅主持人）

- **底部面板**：消息/通知
  - **公开声明区域**（决策阶段显示）
    - 公开声明列表（按时间倒序）
    - 每个声明显示：
      - 发布者信息（头像、昵称、玩家索引）
      - 声明内容
      - 发布时间
      - 声明标识（醒目标识为公开声明）
    - 新声明提示（收到新声明时高亮显示）
    - 声明滚动查看
    - 声明数量统计
  - 系统消息滚动
  - 玩家操作通知
  - 决策提交通知
  - 交易请求通知
  - 任务完成通知
  - 多回合事件进度更新通知
  - 多回合事件完成/失败通知
  - 重要事件提示

- **资源交易弹窗**
  - 选择交易对象（其他玩家列表）
  - 选择交易资源（资源类型、数量）
  - 选择请求资源（资源类型、数量）
  - 交易说明输入（可选）
  - 发起交易按钮
  - 交易预览

- **交易详情弹窗**
  - 交易发起者信息
  - 交易资源详情
  - 请求资源详情
  - 接受/拒绝按钮
  - 交易倒计时
  - 交易状态显示

- **合作申请弹窗**（发起）
  - 选择合作对象（其他玩家列表）
  - 合作内容编辑（富文本编辑器，支持详细描述）
  - 合作类型选择（资源合作/行动合作/策略合作等）
  - 合作条件/要求输入
  - 预期收益说明
  - 发起合作申请按钮
  - 合作内容预览

- **合作申请详情弹窗**（接收方）
  - 合作发起者信息
  - 合作内容详情（完整显示）
  - 合作类型标签
  - 合作条件/要求
  - 预期收益说明
  - **操作按钮**：
    - **接受按钮**：直接接受合作申请
    - **拒绝按钮**：完全拒绝合作申请
    - **谈判按钮**：进入谈判模式，重新编辑合作内容发回对方
  - 合作申请倒计时
  - 合作申请状态显示
  - 谈判历史记录（如果进入谈判）

- **合作申请谈判弹窗**（接收方选择谈判后）
  - 显示原始合作内容
  - 编辑合作内容（可修改所有字段）
  - 修改说明输入（说明修改原因）
  - 发送谈判内容按钮
  - 谈判轮次显示（第X轮谈判）
  - 谈判历史时间线

- **游戏存档弹窗**
  - 存档列表展示
  - 存档信息（名称、回合、时间）
  - 保存新存档（输入存档名称）
  - 恢复存档按钮（确认对话框）
  - 删除存档按钮

#### 2.2.7.1 主持人审核界面（审核阶段）
- **决策列表区域**
  - 所有玩家决策卡片
    - 玩家信息（头像、昵称、索引）
    - **决策选项显示**（如果玩家选择了选项）
      - 已选选项列表（带选项ID和文本）
      - 选项组合建议（AI生成的组合说明）
      - 组合有效性标识（✓合理 / ⚠警告 / ✗冲突）
      - 选项类别标签（攻击/防御/合作等）
    - **自定义文本显示**（如果玩家输入了自定义文本）
      - 文本内容完整显示
      - 字符数统计
    - **决策编辑功能**（主持人可编辑）
      - 编辑按钮（点击进入编辑模式）
      - 编辑界面：
        - 可修改/删除已选选项
        - 可添加新选项（从选项库选择）
        - 可修改自定义文本
        - 可查看选项组合建议
        - 修改说明输入（可选，说明修改原因）
        - 保存修改按钮
        - 取消编辑按钮
      - 修改记录显示（显示修改历史）
    - 提交时间
    - 审核状态（待审核/已审核）
    - 审核按钮（批量审核）

- **临时事件添加区域**
  - 事件类型选择（单回合/多回合）
  - 事件内容输入框
  - 有效回合数设置（多回合事件）
  - **多回合事件进度设置**（多回合事件时显示）
    - 初始进度值设置（可选，默认0）
    - 目标进度值设置（默认100）
    - 进度描述输入（可选）
  - 添加按钮
  - 已添加事件列表（可删除）
  - **多回合事件进度管理**（仅主持人可见）
    - 活跃的多回合事件列表
    - 每个事件显示进度条和状态
    - 手动更新进度按钮（可选）
    - 进度更新历史查看

- **临时规则添加区域**
  - 规则类型选择（单回合/多回合）
  - 规则内容输入框
  - 有效回合数设置（多回合规则）
  - 优先级设置
  - 添加按钮
  - 已添加规则列表（可删除）

- **本轮合作事件区域**（重要）
  - **达成的合作事件列表**
    - 显示所有在本回合达成一致的合作申请
    - 每个合作事件卡片显示：
      - 合作双方信息（发起方和接收方）
      - 合作类型标签（资源合作/行动合作/策略合作等）
      - 合作内容（完整显示）
      - 合作条件/要求
      - 预期收益说明
      - 达成时间
      - 谈判轮次（如果经过谈判）
  - **合作事件编辑功能**
    - 主持人可以点击合作事件卡片进入编辑模式
    - 可以修改合作内容、条件、要求、预期收益等所有字段
    - 修改说明输入（可选，说明修改原因）
    - 保存修改按钮
    - 删除合作事件按钮（如果不需要该合作参与推演）
  - **合作事件状态**
    - 原始状态：显示达成的原始合作内容
    - 已修改状态：显示主持人修改后的内容
    - 已删除状态：标记为不参与推演（但仍保留记录）
  - **合作事件统计**
    - 显示本轮达成的合作事件总数
    - 显示已修改的合作事件数量
    - 显示将参与推演的合作事件数量

- **提交区域**
  - 配置摘要显示
  - 决策数量统计
  - 临时事件/规则数量统计
  - **合作事件数量统计**（新增）
  - 提交给AI推演按钮
    - 提交时包含：所有玩家决策 + 临时事件/规则 + **本轮合作事件**
  - 确认对话框

#### 2.2.8 面板器页面 (`/game/:sessionId/panel`)
- **返回按钮**（左上角）
  - 返回游戏主界面
  - 返回按钮样式：图标+文字，固定在左上角
  - 返回时保持游戏状态，不影响游戏进行

- **帮助按钮**（右上角）
  - 点击后显示游戏说明/帮助内容

- **页面标题**
  - 显示"面板器"标题
  - 显示当前游戏会话信息（房间名称、当前回合等）

- **标签切换区域**
  - **个人面板标签**：显示当前玩家详细信息
  - **群体面板标签**：显示所有玩家对比信息
  - 标签切换动画效果
  - 当前选中标签高亮显示

- **数据刷新控制**
  - **自动刷新**：每5秒自动刷新一次数据
  - **最后更新时间显示**：显示"最后更新：XX:XX:XX"
  - **手动刷新按钮**：点击立即刷新数据
  - **刷新状态指示**：刷新时显示加载动画

- **个人面板内容**（选中"个人面板"标签时显示）
  - **基本信息卡片**
    - 玩家头像、昵称、等级
    - 当前排名及排名变化（↑↓箭头，颜色区分上升/下降）
    - 当前回合数
    - 玩家类型标识（人类玩家/AI玩家）
  
  - **资源详情卡片**
    - 所有资源类型及当前数值（金币、能量等）
    - 资源变化趋势图（折线图，显示本局游戏各回合资源变化）
    - 资源获取/消耗记录列表（最近10条）
      - 每条记录显示：回合数、资源类型、变化量（+/-）、原因说明、时间
    - 资源统计：总获取量、总消耗量、净变化
  
  - **属性详情卡片**
    - 所有状态属性及当前数值（生命值、攻击力、防御力等）
    - 属性变化历史列表（按回合显示属性变化）
    - 属性变化趋势图（可选）
  
  - **决策历史卡片**
    - 本局所有决策列表（按回合分组，可展开/收起）
    - 每项决策显示：
      - 回合数
      - 决策内容（文字指令）
      - 提交时间
      - 决策结果（成功/失败/部分成功）
      - AI推演剧情（可展开查看完整剧情）
      - 决策效果（资源变化、属性变化等）
    - 决策统计信息：
      - 总决策数
      - 平均决策时长（从回合开始到提交的平均时间）
      - 决策成功率（成功决策数/总决策数）
      - 决策类型分布（攻击型/防御型/合作型等）
  
  - **关系记录卡片**
    - **合作记录标签页**
      - 发起的合作申请列表
        - 显示：目标玩家、合作类型、合作内容、状态（待回复/已接受/已拒绝/谈判中）、时间
      - 接收的合作申请列表
        - 显示：发起玩家、合作类型、合作内容、状态、时间
        - 可查看合作详情和谈判历史
    - **交易记录标签页**
      - 发起的交易请求列表
        - 显示：目标玩家、交易资源、请求资源、状态（待确认/已完成/已拒绝/已过期）、时间
      - 接收的交易请求列表
        - 显示：发起玩家、交易详情、状态、时间
    - **竞争记录标签页**
      - 与其他玩家的对抗记录
        - 显示：对手玩家、对抗类型、结果、回合数、时间
  
  - **高光时刻记载簿卡片**（成就系统）
    - **成就列表展示**
      - 已解锁成就列表
        - 成就卡片显示：
          - 成就图标（醒目标识）
          - 成就名称（如"百万富翁"）
          - 成就描述（如"累计获得1000金币"）
          - 解锁时间（回合数和时间）
          - 成就类型标签（资源/策略/社交/竞争/特殊）
        - 成就按解锁时间倒序排列
        - 重要成就高亮显示（如"登顶者"）
      - 未解锁成就列表（可选，显示进度）
        - 成就卡片显示：
          - 成就图标（灰色）
          - 成就名称
          - 成就描述
          - 进度条（当前进度/目标进度）
          - 进度百分比
        - 点击查看详细进度信息
    - **成就统计信息**
      - 总成就数/已解锁数
      - 成就完成率
      - 成就分类统计（各类别成就数量）
    - **成就筛选功能**
      - 按类型筛选（资源/策略/社交/竞争/特殊）
      - 按状态筛选（已解锁/未解锁/全部）
      - 搜索功能（按成就名称搜索）
    - **成就详情查看**
      - 点击成就卡片查看详情
      - 显示成就解锁条件
      - 显示解锁时的游戏状态快照（可选）
      - 显示成就稀有度（普通/稀有/史诗/传说）

- **群体面板内容**（选中"群体面板"标签时显示）
  - **玩家对比图表区域**
    - **资源对比图表**
      - 柱状图：显示所有玩家的资源对比
      - 可切换不同资源类型（金币、能量等）
      - 图表支持交互：悬停显示详细数值、点击切换资源类型
      - 响应式设计，适配不同屏幕尺寸
    - **属性对比图表**
      - 雷达图：显示所有玩家的属性对比
      - 可切换不同属性组合
      - 图表支持交互：悬停显示详细数值
      - 不同玩家用不同颜色标识
  
  - **排名趋势图区域**
    - 折线图：显示所有玩家在本局游戏中的排名变化趋势
    - X轴：回合数（1, 2, 3, ...）
    - Y轴：排名（1, 2, 3, ...，数值越小排名越靠前）
    - 不同玩家用不同颜色线条
    - 图表支持交互：
      - 悬停显示：玩家名称、当前回合排名
      - 点击图例可显示/隐藏特定玩家的趋势线
      - 支持缩放和平移查看历史数据
    - 图表下方显示图例（玩家列表，可点击切换显示）
  
  - **决策状态统计区域**
    - **决策提交率统计**
      - 饼图：显示已提交/未提交的决策比例
      - 显示具体数值和百分比
    - **各玩家决策提交时间分布**
      - 柱状图：显示各玩家在不同时间段的决策提交情况
      - 时间分段：0-60秒、60-120秒、120-180秒等
      - 不同玩家用不同颜色柱状图
    - **决策内容关键词云图**（可选）
      - 词云图：显示本局游戏中决策内容的关键词
      - 词的大小表示出现频率
      - 支持点击查看包含该关键词的决策列表
  
  - **玩家列表详情区域**
    - 所有玩家卡片列表（可展开/收起查看详细信息）
    - 每个玩家卡片显示：
      - 玩家头像、昵称、玩家索引
      - 当前排名（带排名变化箭头）
      - 主要资源数值（金币、能量等，显示前3-5项）
      - 决策状态（已提交/未提交，决策阶段显示）
      - 玩家类型标识（人类玩家/AI玩家）
    - 点击展开查看玩家详细信息：
      - 完整资源列表
      - 完整属性列表
      - 最近3条决策记录
      - 快速操作按钮（发起合作、发起交易等）
  
  - **大事纪记载簿区域**
    - **大事纪时间线视图**
      - 按回合顺序展示所有大事纪
      - 时间线样式：左侧时间轴，右侧事件卡片
      - 每个大事纪卡片显示：
        - 回合数（醒目标识）
        - 事件类型图标（交易/合作/排名/事件/决策/淘汰）
        - 事件标题（如"重大交易达成"）
        - 事件描述（简要说明）
        - 涉及玩家（头像+昵称）
        - 重要性标识（低/中/高，高重要性事件高亮显示）
        - 发生时间
      - 点击事件卡片查看详情：
        - 完整事件描述
        - 相关玩家信息
        - 事件影响说明
        - 相关决策/操作记录
    - **大事纪筛选功能**
      - 按类型筛选（交易/合作/排名/事件/决策/淘汰/全部）
      - 按重要性筛选（高/中/低/全部）
      - 按回合范围筛选（选择起始和结束回合）
      - 按玩家筛选（选择特定玩家相关的事件）
      - 搜索功能（按事件标题或描述搜索）
    - **大事纪统计信息**
      - 总事件数
      - 各类型事件数量统计
      - 重要事件数量
      - 最近事件时间
    - **大事纪展示方式**
      - 默认：时间线视图（按时间顺序）
      - 可选：卡片网格视图（按重要性分组）
      - 响应式设计，适配不同屏幕尺寸

- **响应式设计**
  - PC端：多列布局，图表和列表并排显示
  - 平板端：单列布局，图表和列表上下排列
  - 手机端：单列布局，图表简化显示，列表可折叠

- **性能优化**
  - 图表数据缓存，避免重复计算
  - 使用虚拟滚动处理长列表
  - 定时刷新时保持用户当前查看位置和展开状态

#### 2.2.9 游戏历史页 (`/history`)
- **返回按钮**（左上角）
  - 返回主页
  - 返回按钮样式：图标+文字，固定在左上角

- **帮助按钮**（右上角）
  - 点击后显示游戏说明/帮助内容
- **顶部工具栏**
  - 批量选择复选框（全选/取消全选）
  - 批量删除按钮（选中记录后显示）
  - 刷新按钮
  - 统计信息显示（总游戏数、胜率等）

- **筛选与排序区域**
  - **时间范围筛选**
    - 开始日期选择器
    - 结束日期选择器
    - 快捷选择（今天/本周/本月/全部）
  - **游戏模式筛选**
    - 下拉选择（全部/竞争/合作/自由）
  - **结果筛选**
    - 单选按钮组（全部/胜利/失败/平局）
  - **排序选择**
    - 下拉选择（时间降序/时间升序/时长降序/时长升序）
  - **搜索框**（可选）
    - 房间名称搜索
  - **重置筛选按钮**

- **历史记录列表**
  - **记录卡片/列表项**
    - 复选框（批量选择）
    - 游戏时间（开始时间）
    - 房间名称
    - 游戏模式标签
    - 参与玩家列表（头像+昵称，最多显示3个，超出显示"+N"）
    - 游戏结果（胜利/失败/平局，带图标和颜色）
    - 游戏时长（格式化显示，如"1小时30分钟"）
    - 总回合数
    - 最终排名（如"第1名"）
    - **操作按钮组**
      - 查看详情按钮
      - 删除按钮（带确认对话框）
      - 更多操作（下拉菜单）
  - **空状态**
    - 无记录提示
    - 筛选提示（如有筛选条件）
  - **加载状态**
    - 骨架屏加载

- **分页组件**
  - 页码导航
  - 每页数量选择（10/20/50/100）
  - 总记录数显示
  - 跳转到指定页

- **详情弹窗/页面**
  - **基本信息**
    - 房间名称
    - 游戏模式
    - 开始/结束时间
    - 游戏时长
    - 总回合数
    - 最终排名列表
  - **游戏总结**
    - 总结文本展示
    - 获胜者信息
  - **回合详情**
    - 回合列表（可展开/收起）
    - 每回合显示：
      - 回合数
      - 玩家决策列表
      - AI推演剧情
      - 推演结果
      - 游戏状态快照（可展开查看）
  - **玩家操作历史**
    - 所有玩家操作时间线
    - 操作内容展示
    - 操作结果展示
  - **临时事件/规则**
    - 临时事件列表
    - 临时规则列表
  - **关闭按钮**

- **删除确认对话框**
  - 单个删除确认
    - 提示信息："确定要删除这条游戏记录吗？此操作不可恢复。"
    - 取消/确认按钮
  - 批量删除确认
    - 提示信息："确定要删除选中的 {count} 条游戏记录吗？此操作不可恢复。"
    - 取消/确认按钮

- **统计面板**（可选，侧边栏或顶部）
  - 总游戏数
  - 胜率（胜利数/总游戏数）
  - 平均游戏时长
  - 最常玩的游戏模式
  - 最近游戏时间

#### 2.2.9 个人中心 (`/profile`)
- **返回按钮**（左上角）
  - 返回主页
  - 返回按钮样式：图标+文字，固定在左上角

- **帮助按钮**（右上角）
  - 点击后显示游戏说明/帮助内容

- **个人信息页** (`/profile/info`)
  - 头像上传
  - 昵称编辑
  - 个人简介编辑
  - 等级和经验值显示
  - 成就展示
  - 统计数据（总游戏数、胜率等）
  - **策略分析标签页**
    - 策略列表（按类型分类）
    - 策略使用统计图表
    - 策略成功率对比
    - 策略效果分析
    - 推荐策略展示
    - 策略详情查看

- **设置页** (`/profile/settings`)
  - 账号设置
  - 通知设置
  - 游戏设置（音效、动画等）
  - 隐私设置
  - 主题设置（深色/浅色模式）

## 3. 核心功能模块设计

### 3.0 首页模块

#### 3.0.1 首页展示
**功能要求**：
- **游戏名称显示**：在页面加载时调用`systemAPI.getGameInfo()`获取游戏信息，显示游戏名称《凡墙皆是门》
- 游戏名称作为页面主标题，醒目显示（大号字体，居中或顶部）
- 可配合Logo设计，提升品牌识别度
- 显示游戏副标题/简介：AI文字交互式多人竞争博弈游戏
- 游戏介绍/特色展示区域
- 快速开始按钮（未登录用户跳转到登录页，已登录用户跳转到主页）
- 游戏规则/玩法说明（可选，可展开/收起）
- 最新动态/公告展示（可选）
- **"进入编辑模式"按钮**（仅管理员或特定权限用户可见）
  - 点击后进入帮助内容编辑模式
  - 可以编辑游戏说明/帮助内容
  - 编辑完成后保存，所有玩家和主持人看到的帮助内容会更新

**API调用**：
```typescript
// 首页组件加载时调用
useEffect(() => {
  systemAPI.getGameInfo().then((response) => {
    setGameName(response.data.game_name); // "凡墙皆是门"
    setGameDescription(response.data.description);
  });
}, []);
```

**UI要求**：
- 响应式设计，适配PC、平板、手机
- 游戏名称在不同设备上都有良好的显示效果
- 支持深色/浅色主题

#### 3.0.2 帮助内容编辑模式
**功能要求**：
- **编辑权限检查**：仅管理员或特定权限用户可进入编辑模式
- **富文本编辑器**：支持格式化文本、列表、链接等
- **实时预览**：编辑时实时预览效果
- **保存功能**：保存后更新所有用户看到的帮助内容
- **版本管理**：保存编辑历史，可回退到之前版本
- **退出编辑模式**：返回正常首页视图

**API调用**：
```typescript
// 获取帮助内容
const getHelpContent = () => helpAPI.getHelpContent();

// 更新帮助内容（仅管理员）
const updateHelpContent = (content: string) => 
  helpAPI.updateHelpContent({ content });
```

### 3.1 用户认证模块

#### 3.1.1 登录功能
```typescript
// 登录状态管理
interface AuthState {
  isAuthenticated: boolean;
  user: User | null;
  token: string | null;
  loading: boolean;
  error: string | null;
}

// 登录API调用
async function login(username: string, password: string) {
  // 调用后端API
  // 存储Token到localStorage
  // 更新全局状态
}
```

**功能要求**：
- 表单验证（用户名/密码非空）
- 错误提示（用户名或密码错误）
- 登录成功后跳转到主页
- Token自动保存和刷新
- 记住我功能（Token持久化）

#### 3.1.2 注册功能
**功能要求**：
- 实时表单验证
  - 用户名：长度3-20，只能包含字母数字下划线
  - 邮箱：格式验证
  - 密码：至少8位，包含字母和数字
  - 确认密码：与密码一致
- 用户名/邮箱唯一性检查（实时）
- 注册成功后自动登录
- 错误提示（用户名已存在、邮箱已注册等）

#### 3.1.3 Token管理
**功能要求**：
- Token存储在localStorage或cookie
- 请求拦截器自动添加Token
- Token过期自动刷新
- Token失效时跳转登录页
- 退出登录清除Token

### 3.2 房间管理模块

#### 3.2.1 房间列表
**功能要求**：
- 自动刷新房间列表（每5秒）
- 房间状态实时更新（WebSocket）
- 筛选和搜索功能
- 分页加载
- 加入房间（需要密码的房间弹出密码输入框）
- 房间状态颜色标识（等待中-绿色，游戏中-红色）

#### 3.2.2 创建房间
**功能要求**：
- 表单验证
- 创建成功后自动跳转到房间等待页
- 错误提示（房间名重复等）

#### 3.2.3 房间等待
**功能要求**：
- 实时显示玩家加入/离开（WebSocket）
- 准备状态切换
- 初始化状态显示（未配置/配置中/已完成）
- 主持人权限检查（显示/隐藏主持人功能按钮）
- 离开房间确认提示
- 房间设置修改（仅主持人）

#### 3.2.4 主持人初始化设定
**功能要求**：
- **API配置模块**
  - 提供商选择（DeepSeek/OpenAI/自定义）
  - 默认配置自动填充
  - 配置表单验证
  - API连接测试功能
  - 配置自动保存（每步保存）

- **游戏规则配置模块**
  - 规则文本编辑器（支持Markdown）
  - 规则模板管理（保存/加载）
  - 规则预览功能
  - 规则验证（格式检查）

- **玩家位数配置模块**
  - 数字输入验证
  - 实时计算AI玩家数量
  - 配置合理性检查
  - 配置预览

- **配置管理**
  - 分步保存配置
  - 配置完整性验证
  - 完成初始化确认
  - 配置锁定（游戏开始后不可修改）

### 3.3 游戏核心模块

#### 3.3.1 游戏状态管理
```typescript
interface GameState {
  sessionId: string;
  currentRound: number;
  totalRounds: number;
  gameStatus: 'initializing' | 'playing' | 'paused' | 'finished';
  players: Player[];
  currentPlayer: Player;
  gameState: GameStateData;
  narrative: Narrative[];
  actions: Action[];
  countdown: number;
}
```

**功能要求**：
- 游戏状态实时同步（WebSocket）
- 状态变化动画效果
- 游戏状态持久化（刷新页面可恢复）
- 状态版本控制（防止冲突）

#### 3.3.2 决策选项生成与选择
**功能要求**：
- **选项生成时机**：每回合开始时，系统自动为所有玩家生成3个个性化决策选项
- **选项生成方式**：使用AI批量生成，基于当前游戏状态为每个玩家生成最相关的选项
- **选项加载**：
  - 回合开始时显示"正在生成选项..."加载状态
  - 选项生成完成后自动显示
  - 如果生成失败，显示"选项生成失败，请使用自由输入"
- **选项展示**：
  - 每个选项显示：选项文本、预期效果提示、选项类别标签
  - 选项支持多选（复选框）
  - 已选选项高亮显示
  - 显示已选择选项数量
- **选项刷新**：
  - 提供"刷新选项"按钮（每回合限制刷新1次）
  - 刷新时显示加载状态
  - 刷新后选项更新
- **选项与自由输入结合**：
  - 玩家可以选择选项，同时在输入框中补充详细说明
  - 选项和自定义文本可以组合提交
  - 提交格式：包含选项ID数组和自定义文本

**API调用**：
```typescript
// 获取当前回合的决策选项
const getDecisionOptions = async (sessionId: string, round: number) => {
  const response = await gameAPI.getDecisionOptions(sessionId, round);
  return response.data; // 返回当前玩家的3个选项
};

// 刷新决策选项
const refreshDecisionOptions = async (sessionId: string, round: number) => {
  const response = await gameAPI.refreshDecisionOptions(sessionId, round);
  return response.data;
};
```

**UI交互**：
- 选项加载动画（骨架屏）
- 选项悬停效果（显示更多详情）
- 选项选择反馈（选中/取消选中动画）
- 选项组合提示（多选时显示组合说明）

#### 3.3.2.1 决策输入与提交
**功能要求**：
- **决策输入框**（支持自由输入）
  - 文字输入框（支持多行，最大长度限制）
  - 输入提示/建议（可选）
  - 可与选项组合使用（选择选项后，在输入框中补充说明）
  - 字符计数显示
- **提交功能**：
  - 提交按钮（防重复点击，已提交后禁用）
  - 提交条件：至少选择1个选项或输入自定义文本
  - 提交格式：包含选项ID数组和自定义文本
  - 提交后显示"已提交"状态，显示提交的选项和文本
- **决策历史记录**（最近10条）
- **快捷键**：Ctrl+Enter提交
- **决策时限**：
  - 决策时限倒计时显示
  - 超时警告提示（剩余30秒）
  - 超时自动处理（根据配置策略）

**API调用**：
```typescript
// 提交决策（包含选项和自定义文本）
const submitDecision = async (sessionId: string, decision: {
  selected_option_ids?: string[];
  custom_text?: string;
  round: number;
}) => {
  const response = await gameAPI.submitDecision(sessionId, decision);
  return response.data;
};
```

#### 3.3.2.2 公开声明功能
**功能要求**：
- **公开声明按钮**（决策阶段显示）
  - 位置：操作输入区，在提交按钮附近
  - 样式：醒目的按钮，图标+文字"公开声明"
  - 点击后弹出公开声明编辑弹窗
- **公开声明编辑**
  - 文字输入框（支持多行，最大长度限制，如500字）
  - 字符计数显示（已输入/最大长度）
  - 发送按钮（发送给所有玩家）
  - 取消按钮
  - 发送前确认（防止误操作）
- **公开声明显示**
  - 所有玩家实时接收公开声明（WebSocket推送）
  - 声明列表显示在底部面板的公开声明区域
  - 按时间倒序排列（最新在最上方）
  - 每个声明卡片显示：
    - 发布者信息（头像、昵称、玩家索引）
    - 声明内容（完整显示）
    - 发布时间（相对时间，如"2分钟前"）
    - 声明标识（醒目标识，区别于普通消息）
  - 新声明提示（收到新声明时高亮显示，3秒后恢复正常）
  - 声明滚动查看（支持滚动查看历史声明）
  - 声明数量统计（显示本回合公开声明总数）
- **公开声明限制**
  - 仅在决策阶段可以发布公开声明
  - 每回合可发布多次公开声明（无次数限制，或可配置限制）
  - 声明内容长度限制（如500字）
  - 声明内容过滤（防止不当内容）

**API调用**：
```typescript
// 发布公开声明
const publishPublicStatement = (sessionId: string, round: number, content: string) =>
  publicStatementAPI.publishStatement(sessionId, round, { content });
```

#### 3.3.2.1 决策状态显示
**功能要求**：
- 实时显示所有玩家决策状态（已提交/未提交）
- 决策进度统计（已提交数/总数）
- 决策状态实时更新（WebSocket）
- 未提交玩家高亮提醒
- 决策提交时间显示

#### 3.3.3 AI剧情展示
**功能要求**：
- 打字机效果展示剧情文本
- 剧情文本样式区分（场景描述/事件/结果）
- 剧情滚动查看（自动滚动到底部）
- 剧情高亮显示（重要事件）
- 剧情播放速度控制（可选）

#### 3.3.4 玩家状态展示
**功能要求**：
- 实时更新玩家资源
- 资源变化动画（增加/减少）
- 玩家排名实时更新
- 排名变化提示
- 玩家状态可视化（进度条、图标等）

#### 3.3.5 回合管理
**功能要求**：
- 回合阶段显示（决策/审核/推演/结果）
- 决策倒计时显示（决策阶段）
- 回合切换动画
- 回合开始/结束提示
- 回合内操作限制（每回合只能提交一次决策）
- 阶段切换通知

#### 3.3.6 主持人审核功能
**功能要求**：
- **决策审核**
  - 查看所有玩家决策列表
  - 决策详情查看
  - 批量审核决策
  - 决策状态标记（待审核/已审核）
  
- **临时事件/规则管理**
  - 添加临时事件（单回合/多回合）
  - 多回合事件进度设置（初始进度、目标进度）
  - 添加临时规则（单回合/多回合）
  - 设置规则优先级
  - 查看已添加的事件/规则列表
  - 删除事件/规则
  - **多回合事件进度管理**
    - 查看所有活跃的多回合事件
    - 查看事件进度详情
    - 手动更新事件进度（可选）
    - 查看进度历史记录
  
- **提交推演**
  - 整合所有决策和临时事件/规则
  - **自动包含本轮合作事件**（重要）
    - 系统自动收集所有状态为"原始"或"已修改"的合作事件
    - 合作事件作为决策的一部分，与玩家决策一起提交给AI推演
    - 在推演Prompt中清晰标注合作事件信息，包括合作双方、合作内容、合作条件等
  - 自动包含多回合事件进度信息（系统自动处理）
  - 配置预览（显示决策、事件、规则、合作事件的数量和摘要）
  - 提交给AI推演
  - 推演进度显示

#### 3.3.7 多回合事件进度跟踪
**功能要求**：
- **事件进度显示**
  - 实时显示所有活跃的多回合事件
  - 进度条可视化（当前/目标）
  - 进度百分比显示
  - 事件状态指示（进行中/已完成/已失败）
  - 进度历史时间线（可展开查看）
  
- **事件进度更新**
  - 每回合自动更新（系统根据AI推演结果更新）
  - 进度更新通知（WebSocket实时推送）
  - 进度变化动画效果
  - 事件完成/失败提示
  
- **事件线程保护**
  - 确保事件进度不丢失
  - 每回合推演前自动提醒AI事件进度
  - 事件超时检测和提示

### 3.4 历史记录管理模块

#### 3.4.1 历史记录查询
**功能要求**：
- 分页加载历史记录列表
- 多条件筛选（时间范围、游戏模式、结果）
- 排序功能（按时间、时长等）
- 搜索功能（房间名称）
- 自动刷新（可选）
- 加载状态显示

#### 3.4.2 历史记录详情
**功能要求**：
- 详情弹窗/页面展示
- 基本信息展示
- 回合详情展示（可展开/收起）
- 玩家操作历史时间线
- 游戏状态快照查看
- 临时事件/规则展示
- 数据格式化（时间、时长等）

#### 3.4.3 历史记录删除
**功能要求**：
- **单个删除**
  - 删除按钮（每条记录）
  - 确认对话框
  - 删除成功提示
  - 删除失败错误提示
  
- **批量删除**
  - 全选/取消全选功能
  - 批量选择状态管理
  - 批量删除按钮（选中后显示）
  - 批量删除确认对话框
  - 删除进度显示
  - 部分删除失败处理
  
- **删除后处理**
  - 自动刷新列表
  - 删除成功Toast提示
  - 更新统计信息

#### 3.4.4 历史记录统计
**功能要求**：
- 统计数据展示（总游戏数、胜率等）
- 统计数据实时更新
- 统计图表（可选）

### 3.4 帮助功能模块

#### 3.4.1 帮助按钮
**功能要求**：
- **帮助按钮位置**：所有页面的右上角（或导航栏）
- **帮助按钮样式**：问号图标 + "帮助"文字，或仅图标
- **帮助内容显示**：
  - 点击后弹出帮助弹窗或侧边栏
  - 显示游戏说明/帮助内容（从服务器获取）
  - 支持滚动查看长内容
  - 可关闭帮助弹窗
- **帮助内容来源**：通过API从服务器获取，可通过首页编辑模式修改

**API调用**：
```typescript
// 获取帮助内容
const getHelpContent = () => helpAPI.getHelpContent();
```

#### 3.4.2 帮助内容编辑模式
**功能要求**：
- **编辑权限**：仅管理员或特定权限用户可进入
- **进入方式**：首页显示"进入编辑模式"按钮（仅权限用户可见）
- **编辑功能**：
  - 富文本编辑器（支持格式化、列表、链接等）
  - 实时预览
  - 保存/取消按钮
- **保存后效果**：所有玩家和主持人看到的帮助内容立即更新

**API调用**：
```typescript
// 更新帮助内容（仅管理员）
const updateHelpContent = (content: string) => 
  helpAPI.updateHelpContent({ content });
```

### 3.5 通用UI组件

#### 3.5.1 返回按钮
**功能要求**：
- **位置**：所有页面的左上角，固定位置
- **样式**：返回箭头图标 + "返回"文字，或仅图标
- **功能**：
  - 点击返回上一页或指定页面
  - 游戏主界面返回前需确认（防止误操作）
  - 根据页面层级智能返回
- **显示规则**：
  - 首页可隐藏或显示为"返回登录"（如果从登录页跳转）
  - 其他页面均显示返回按钮

**实现示例**：
```typescript
// 返回按钮组件
const BackButton = ({ onClick, text = "返回" }) => {
  return (
    <button className="back-button" onClick={onClick}>
      <ArrowLeftIcon /> {text}
    </button>
  );
};
```

### 3.6 资源交易模块

#### 3.6.1 发起交易
**功能要求**：
- 选择交易对象（其他玩家列表）
- 选择交易资源（资源类型、数量输入）
- 选择请求资源（资源类型、数量输入）
- 交易说明输入（可选）
- 资源充足性验证
- 发起交易按钮
- 交易预览确认

#### 3.6.2 处理交易请求
**功能要求**：
- 交易请求通知（Toast/消息）
- 交易详情查看
- 资源充足性检查
- 接受/拒绝交易按钮
- 交易倒计时显示
- 交易状态实时更新

#### 3.6.3 交易管理
**功能要求**：
- 待处理交易列表
- 我的交易请求列表
- 交易历史记录
- 交易状态显示（待处理/已接受/已拒绝/已过期）
- 交易取消功能

### 3.7 合作申请模块

#### 3.7.1 发起合作申请
**功能要求**：
- 选择合作对象（其他玩家列表）
- 合作内容编辑（富文本编辑器，支持详细描述）
- 合作类型选择（资源合作/行动合作/策略合作等）
- 合作条件/要求输入
- 预期收益说明
- 发起合作申请按钮
- 合作内容预览
- 内容验证（不能为空）

**API调用**：
```typescript
// 发起合作申请
const requestCooperation = (sessionId: string, data: CooperationRequestData) =>
  cooperationAPI.requestCooperation(sessionId, data);
```

#### 3.7.2 处理合作申请（接收方）
**功能要求**：
- 合作申请请求通知（Toast/消息）
- 合作申请详情查看（完整显示合作内容）
- **三种处理方式**：
  - **接受**：直接接受合作申请，合作立即生效
  - **拒绝**：完全拒绝合作申请，申请结束
  - **谈判**：进入谈判模式，重新编辑合作内容发回对方
- 合作申请倒计时显示
- 合作申请状态实时更新
- 谈判历史记录显示（如果进入谈判）

**API调用**：
```typescript
// 接受合作申请
const acceptCooperation = (sessionId: string, cooperationId: string) =>
  cooperationAPI.acceptCooperation(sessionId, cooperationId);

// 拒绝合作申请
const rejectCooperation = (sessionId: string, cooperationId: string) =>
  cooperationAPI.rejectCooperation(sessionId, cooperationId);

// 发送谈判内容
const negotiateCooperation = (sessionId: string, cooperationId: string, data: NegotiationData) =>
  cooperationAPI.negotiateCooperation(sessionId, cooperationId, data);
```

#### 3.7.3 合作申请谈判
**功能要求**：
- **谈判模式**：接收方选择"谈判"后进入
- **谈判内容编辑**：
  - 显示原始合作内容（只读）
  - 可编辑所有合作字段（合作内容、条件、要求、收益等）
  - 修改说明输入（说明修改原因）
  - 谈判轮次显示（第X轮谈判）
- **发送谈判内容**：
  - 发送后，原发起方收到谈判内容
  - 发起方可以选择接受/拒绝/继续谈判
- **谈判历史**：
  - 显示完整的谈判时间线
  - 每轮谈判的内容对比
  - 谈判轮次限制（可配置，如最多5轮）
- **谈判状态**：
  - 进行中：双方正在谈判
  - 已接受：任一方接受最终方案
  - 已拒绝：任一方拒绝
  - 已超时：超过谈判时限

**API调用**：
```typescript
// 获取谈判历史
const getNegotiationHistory = (sessionId: string, cooperationId: string) =>
  cooperationAPI.getNegotiationHistory(sessionId, cooperationId);
```

#### 3.7.4 合作申请管理
**功能要求**：
- 待处理合作申请列表（我收到的）
- 我的合作申请列表（我发起的）
- 谈判中的合作申请列表
- 合作申请历史记录
- 合作申请状态显示（待处理/谈判中/已接受/已拒绝/已超时）
- 合作申请详情查看
- 取消合作申请功能（仅发起方，未接受前可取消）

**API调用**：
```typescript
// 获取合作申请列表
const getCooperationList = (sessionId: string) =>
  cooperationAPI.getCooperationList(sessionId);

// 取消合作申请
const cancelCooperation = (sessionId: string, cooperationId: string) =>
  cooperationAPI.cancelCooperation(sessionId, cooperationId);
```

### 3.8 游戏存档模块

#### 3.8.1 保存游戏
**功能要求**：
- 手动保存（保存按钮）
- 自动保存提示（每回合结束）
- 存档名称输入（可选）
- 存档描述输入（可选）
- 保存成功提示
- 存档列表更新

#### 3.8.2 恢复游戏
**功能要求**：
- 存档列表展示
- 存档信息查看（名称、回合、时间）
- 恢复确认对话框（警告提示）
- 恢复权限检查（仅主持人或所有玩家同意）
- 恢复成功提示
- 游戏状态恢复

#### 3.8.3 存档管理
**功能要求**：
- 存档列表（手动/自动存档区分）
- 存档删除功能
- 存档数量限制提示
- 存档详情查看

### 3.9 任务/挑战模块

#### 3.9.1 任务展示
**功能要求**：
- 任务列表展示
- 任务类型标签（收集/战斗/探索/合作）
- 任务进度条显示
- 任务奖励预览
- 任务截止时间倒计时
- 任务状态指示（进行中/已完成/已失败）

#### 3.9.2 任务详情
**功能要求**：
- 任务详情弹窗/展开
- 任务描述展示
- 任务进度详情
- 任务奖励详情
- 参与玩家列表
- 任务完成条件说明

#### 3.9.3 任务通知
**功能要求**：
- 新任务发布通知
- 任务进度更新通知
- 任务完成通知
- 任务失败通知

### 3.10 面板器模块

#### 3.10.1 面板器页面入口
**功能要求**：
- 在游戏主界面左侧面板顶部添加"面板器"按钮
- 按钮样式：图标+文字"面板器"，醒目标识
- 点击后跳转到面板器页面（`/game/:sessionId/panel`）
- 按钮状态：游戏进行中时可用

**路由设计**：
- 新增路由：`/game/:sessionId/panel`
- 从游戏主界面跳转到面板器页面
- 面板器页面支持返回游戏主界面

#### 3.10.2 个人面板功能
**功能要求**：
- **基本信息展示**
  - 调用 `gameAPI.getPlayerDetails(sessionId, playerIndex)` 获取玩家详细信息
  - 显示玩家头像、昵称、等级、当前排名、排名变化
  - 显示当前回合数、玩家类型（人类/AI）

- **资源详情展示**
  - 显示所有资源类型及当前数值
  - 资源变化趋势图（折线图，使用图表库如ECharts/Recharts）
  - 资源获取/消耗记录列表（最近10条）
  - 资源统计信息

- **属性详情展示**
  - 显示所有状态属性及当前数值
  - 属性变化历史列表

- **决策历史展示**
  - 本局所有决策列表（按回合分组）
  - 每项决策显示完整信息（回合、内容、时间、结果、剧情等）
  - 决策统计信息（总数、成功率、平均时长等）

- **关系记录展示**
  - 合作记录（发起/接收）
  - 交易记录（发起/接收）
  - 竞争记录

- **高光时刻记载簿（成就系统）**
  - **成就列表展示**
    - 已解锁成就列表（按解锁时间倒序）
    - 未解锁成就列表（显示进度，可选）
    - 成就卡片显示：图标、名称、描述、解锁时间、类型标签
    - 重要成就高亮显示
  - **成就统计**
    - 总成就数/已解锁数
    - 成就完成率
    - 成就分类统计
  - **成就筛选**
    - 按类型筛选（资源/策略/社交/竞争/特殊）
    - 按状态筛选（已解锁/未解锁/全部）
    - 搜索功能
  - **成就详情查看**
    - 点击成就卡片查看详情
    - 显示解锁条件、解锁时的游戏状态（可选）

**API调用**：
```typescript
// 获取玩家详细信息（包含成就信息）
const getPlayerDetails = async (sessionId: string, playerIndex: number) => {
  const response = await gameAPI.getPlayerDetails(sessionId, playerIndex);
  return response.data; // 包含achievements字段
};

// 获取玩家成就列表
const getPlayerAchievements = async (sessionId: string, playerIndex: number) => {
  const response = await gameAPI.getPlayerAchievements(sessionId, playerIndex);
  return response.data;
};
```

#### 3.10.3 群体面板功能
**功能要求**：
- **玩家对比图表**
  - 调用 `gameAPI.getGameStatistics(sessionId)` 获取统计数据
  - 资源对比柱状图（可切换不同资源类型）
  - 属性对比雷达图（可切换不同属性组合）
  - 图表支持交互（悬停显示详情、点击切换类型）

- **排名趋势图**
  - 折线图显示所有玩家的排名变化趋势
  - X轴：回合数，Y轴：排名
  - 不同玩家用不同颜色线条
  - 支持图例点击显示/隐藏特定玩家

- **决策状态统计**
  - 决策提交率统计（饼图）
  - 各玩家决策提交时间分布（柱状图）
  - 决策内容关键词云图（可选）

- **玩家列表详情**
  - 所有玩家卡片列表
  - 每个玩家显示基本信息、排名、资源、决策状态
  - 可展开查看详细信息

- **大事纪记载簿**
  - **大事纪时间线视图**
    - 按回合顺序展示所有大事纪
    - 时间线样式：左侧时间轴，右侧事件卡片
    - 每个大事纪卡片显示：回合数、事件类型图标、事件标题、事件描述、涉及玩家、重要性标识、发生时间
    - 点击事件卡片查看详情：完整事件描述、相关玩家信息、事件影响说明、相关决策/操作记录
  - **大事纪筛选功能**
    - 按类型筛选（交易/合作/排名/事件/决策/淘汰/全部）
    - 按重要性筛选（高/中/低/全部）
    - 按回合范围筛选
    - 按玩家筛选
    - 搜索功能
  - **大事纪统计信息**
    - 总事件数
    - 各类型事件数量统计
    - 重要事件数量
    - 最近事件时间
  - **大事纪展示方式**
    - 默认：时间线视图（按时间顺序）
    - 可选：卡片网格视图（按重要性分组）
    - 响应式设计，适配不同屏幕尺寸

**API调用**：
```typescript
// 获取游戏统计数据（包含大事纪）
const getGameStatistics = async (sessionId: string) => {
  const response = await gameAPI.getGameStatistics(sessionId);
  return response.data; // 包含milestones字段
};

// 获取大事纪列表
const getMilestones = async (sessionId: string, filters?: {
  type?: string;
  importance?: string;
  round_start?: number;
  round_end?: number;
  player_index?: number;
}) => {
  const response = await gameAPI.getMilestones(sessionId, filters);
  return response.data;
};
```

#### 3.10.4 定时刷新机制
**功能要求**：
- 使用 `setInterval` 每5秒自动刷新一次数据
- 组件卸载时清除定时器
- 显示最后更新时间（格式：最后更新：HH:MM:SS）
- 手动刷新按钮（点击立即刷新）
- 刷新时显示加载动画，但不阻塞用户操作
- 刷新时保持用户当前查看位置和展开状态

**实现示例**：
```typescript
useEffect(() => {
  // 立即加载一次
  loadData();
  
  // 设置定时刷新
  const interval = setInterval(() => {
    loadData();
  }, 5000); // 5秒刷新一次
  
  // 清理定时器
  return () => clearInterval(interval);
}, [sessionId]);
```

#### 3.10.5 图表库集成
**技术选型**：
- 推荐使用 ECharts（功能强大，支持多种图表类型）
- 或使用 Recharts（React友好，组件化设计）
- 确保图表响应式设计，适配不同屏幕尺寸

**图表要求**：
- 所有图表支持响应式布局
- 图表支持交互（悬停显示详情、缩放、平移等）
- 图表数据更新时平滑过渡动画
- 移动端图表简化显示，保证可读性

#### 3.10.6 性能优化
**优化策略**：
- 使用 React.memo 优化组件渲染
- 图表数据缓存，避免重复计算
- 使用虚拟滚动处理长列表
- 定时刷新时保持用户当前查看位置
- 数据量大时考虑分页或懒加载

### 3.8 策略分析模块

#### 3.8.1 策略列表
**功能要求**：
- 策略分类展示（攻击型/防御型/合作型/混合型）
- 策略使用统计
- 策略成功率显示
- 策略平均收益显示
- 策略最后使用时间

#### 3.8.2 策略分析
**功能要求**：
- 策略详情查看
- 策略使用历史
- 成功案例展示
- 失败案例展示
- 适用场景分析
- 改进建议展示

#### 3.8.3 策略推荐
**功能要求**：
- 基于历史数据的策略推荐
- 推荐理由说明
- 策略对比分析
- 策略效果预测

### 3.4 实时通信模块

#### 3.4.1 WebSocket连接管理
```typescript
class WebSocketManager {
  connect(token: string): void;
  disconnect(): void;
  send(message: Message): void;
  on(event: string, callback: Function): void;
  reconnect(): void;
}
```

**功能要求**：
- 自动建立WebSocket连接
- 连接状态指示（连接中/已连接/已断开）
- 自动重连机制（断线后每3秒重连，最多重试5次）
- 心跳检测（每30秒发送ping）
- 消息队列（断线期间缓存消息）
- **断线重连状态恢复**（必须采纳）
  - 重连后从服务器获取最新游戏状态
  - 恢复游戏界面到断线前的状态
  - 处理断线期间错过的消息

#### 3.4.1.1 前端Hooks层封装（建议采纳）
**架构建议**：将UI逻辑与实时通信逻辑解耦，使用React Hooks封装

**目录结构**：
```
frontend/src/hooks/
├── useSocket.ts      # Socket连接管理Hook
├── useGameLoop.ts    # 游戏循环逻辑Hook
├── useRoom.ts        # 房间相关逻辑Hook
└── useGameState.ts   # 游戏状态管理Hook
```

**实现示例**：
```typescript
// useSocket.ts
export const useSocket = (token: string) => {
  const [connected, setConnected] = useState(false);
  const [socket, setSocket] = useState<Socket | null>(null);
  
  useEffect(() => {
    const ws = wsService.connect(token);
    setSocket(ws);
    
    ws.on('connect', () => setConnected(true));
    ws.on('disconnect', () => setConnected(false));
    
    return () => ws.disconnect();
  }, [token]);
  
  return { socket, connected };
};

// useGameLoop.ts
export const useGameLoop = (sessionId: string) => {
  const { socket } = useSocket();
  const [gameState, setGameState] = useState<GameState | null>(null);
  
  useEffect(() => {
    if (!socket) return;
    
    socket.on('game_state_update', (data) => {
      setGameState(data.game_state);
    });
    
    return () => {
      socket.off('game_state_update');
    };
  }, [socket, sessionId]);
  
  return { gameState };
};
```

**优势**：
- 逻辑复用：多个组件可共享Socket连接和游戏状态
- 易于测试：Hooks可独立测试
- 代码组织：UI组件专注于展示，逻辑在Hooks中

#### 3.4.2 消息处理
**消息类型处理**：
- `game_state_update`：更新游戏状态
- `decision_submitted`：玩家决策提交通知
- `decision_status_update`：决策状态更新
- `decision_deadline_update`：决策时限倒计时更新
- `round_stage_changed`：回合阶段切换通知
- `inference_started`：推演开始通知
- `inference_completed`：推演完成通知
- `decision_options_ready`：决策选项生成完成通知（新增）
  - 更新决策选项列表
  - 显示选项加载完成提示
  - 允许玩家开始选择选项
- `achievement_unlocked`：成就解锁通知（新增）
  - 显示成就解锁动画和提示
  - 更新玩家成就列表
  - 推送给所有玩家（增加游戏趣味性）
- `milestone_recorded`：大事纪记录通知（新增）
  - 显示大事纪记录提示
  - 更新大事纪时间线
  - 重要事件高亮显示
- `public_statement`：公开声明通知
- `action_result`：显示操作结果
- `narrative`：展示AI剧情
- `chat_message`：聊天消息
- `trade_request`：交易请求通知
- `trade_status_update`：交易状态更新
- `cooperation_request`：合作申请请求通知
- `cooperation_status_update`：合作申请状态更新
- `cooperation_negotiation`：合作申请谈判通知
- `task_update`：任务更新通知
- `multi_round_event_progress`：多回合事件进度更新
- `multi_round_event_completed`：多回合事件完成/失败通知

> **实现进度（第四阶段 - 最小实时子系统）**  
> - 当前前端实现针对房间系统，已接入的最小消息集：  
>   - `player_joined` / `player_left`：Rooms 页面订阅并在有人加入/离开时自动刷新列表。  
>   - `game_state_update`：WaitingRoom 页面订阅，用于展示当前房间在线玩家数量与基础状态。  
>   - `system_message`：在 Rooms / WaitingRoom 页面以提示的形式展示系统通知。  
>   - `error`：在 Rooms / WaitingRoom 页面统一展示错误提示。  
> - 具体集成点：  
>   - `frontend/src/pages/Rooms.tsx`：在登录后建立 WebSocket 连接，订阅上游最小消息集，驱动房间列表刷新与系统提示。  
>   - `frontend/src/pages/WaitingRoom.tsx`：进入房间时发送 `join_room` / `sync_state`，离开时发送 `leave_room`，并基于 `game_state_update` 渲染人数与状态。  
> - 其余与游戏回合/AI 推演/任务等相关的复杂消息类型，保留在后续阶段实现。
- `player_joined/left`：更新玩家列表
- `error`：显示错误提示
- `system_message`：显示系统消息

**功能要求**：
- 消息类型路由（不同消息类型调用不同处理函数）
- 消息去重（相同消息ID不重复处理）
- 消息顺序保证（使用消息序列号）
- **Socket.io Acknowledgments机制**（建议采纳）
  - 关键消息使用acknowledgments确认接收
  - 实现消息重传机制（未确认的消息）
  - 确保消息可靠传递
- 消息持久化（重要消息保存到本地）
- 决策状态实时更新（自动刷新决策列表）
- 倒计时实时更新（每秒更新一次）

### 3.5 UI/UX交互设计

#### 3.5.1 加载状态
- 页面加载骨架屏
- 按钮加载状态（禁用+加载图标）
- 数据加载占位符
- 全局加载遮罩（全屏操作）

#### 3.5.2 错误处理
- 网络错误提示（重试按钮）
- 表单错误提示（字段级错误）
- 操作错误提示（Toast通知）
- 404/500错误页面

#### 3.5.3 动画效果
- 页面切换动画
- 状态变化动画（淡入淡出）
- 列表更新动画（新增/删除项）
- 资源变化动画（数字滚动）
- 排名变化动画（位置移动）

#### 3.5.4 反馈机制
- 操作成功提示（Toast）
- 操作失败提示（Toast）
- 确认对话框（重要操作）
- 进度指示（长时间操作）

## 4. 组件设计

### 4.1 通用组件

#### 4.1.1 Button组件
```typescript
interface ButtonProps {
  type: 'primary' | 'secondary' | 'danger';
  size: 'small' | 'medium' | 'large';
  loading?: boolean;
  disabled?: boolean;
  onClick: () => void;
  children: React.ReactNode;
}
```

#### 4.1.2 Input组件
```typescript
interface InputProps {
  type: 'text' | 'password' | 'email';
  placeholder?: string;
  value: string;
  onChange: (value: string) => void;
  error?: string;
  disabled?: boolean;
}
```

#### 4.1.3 Modal组件
```typescript
interface ModalProps {
  visible: boolean;
  title: string;
  onClose: () => void;
  children: React.ReactNode;
  footer?: React.ReactNode;
}
```

#### 4.1.4 Toast通知组件
- 成功/错误/警告/信息四种类型
- 自动消失（3秒）或手动关闭
- 多个Toast堆叠显示

#### 4.1.5 Loading组件
- 全屏加载遮罩
- 按钮内加载图标
- 骨架屏加载

### 4.2 游戏专用组件

#### 4.2.0 组件拆分优化（建议采纳）
**架构建议**：将博弈面板（GameBoard）与聊天/状态栏（Sidebar）分离，避免频繁Socket更新导致整页重绘

**组件结构**：
```typescript
// GameBoard.tsx - 游戏主面板（独立更新）
const GameBoard = React.memo(({ gameState }: { gameState: GameState }) => {
  // 仅接收游戏状态更新
  return <div>游戏主面板内容</div>;
});

// Sidebar.tsx - 侧边栏（独立更新）
const Sidebar = React.memo(({ players, chat }: { players: Player[], chat: Message[] }) => {
  // 仅接收玩家列表和聊天消息更新
  return <div>侧边栏内容</div>;
});

// GamePage.tsx - 主页面（组合组件）
const GamePage = () => {
  const { gameState } = useGameLoop(sessionId);
  const { players, chat } = useRoom(sessionId);
  
  return (
    <div>
      <GameBoard gameState={gameState} />
      <Sidebar players={players} chat={chat} />
    </div>
  );
};
```

**优化策略**：
- 使用React.memo避免不必要的重渲染
- 状态隔离：每个组件只订阅需要的数据
- 选择性更新：Socket消息只更新相关组件

#### 4.2.1 玩家卡片组件
- 显示玩家头像、昵称、等级
- 显示玩家资源（金币、能量等）
- 显示玩家状态（生命值、攻击力等）
- 高亮当前玩家
- **性能优化**：使用React.memo，仅在玩家数据变化时重渲染

#### 4.2.2 剧情展示组件
- 打字机效果
- 文本样式区分
- 自动滚动
- 历史记录查看
- **性能优化**：使用虚拟滚动处理长文本

#### 4.2.3 排名面板组件
- 排名列表
- 排名变化动画
- 玩家高亮
- **性能优化**：使用React.memo，仅在排名变化时重渲染

#### 4.2.4 资源显示组件
- 资源图标+数值
- 资源变化动画
- 资源不足警告

#### 4.2.5 倒计时组件
- 圆形进度条
- 数字倒计时
- 时间到提示

#### 4.2.6 决策倒计时组件
- 圆形进度条（带颜色变化）
- 剩余时间显示（MM:SS格式）
- 警告状态（剩余30秒变红）
- 超时提示
- 暂停/继续功能（可选）

#### 4.2.7 决策状态组件
- 决策状态列表
- 已提交/未提交图标
- 提交时间显示
- 进度统计（已提交/总数）
- 实时更新动画

#### 4.2.8 主持人审核组件
- **决策审核列表组件**
  - 决策卡片列表
  - 决策详情展示
  - 审核状态标记
  - 批量操作按钮

- **临时事件/规则添加组件**
  - 类型选择（单回合/多回合）
  - 内容输入框
  - 有效回合数设置
  - 多回合事件进度设置（初始进度、目标进度）
  - 优先级设置（规则）
  - 添加/删除按钮
  - 列表展示

- **多回合事件进度管理组件**（仅主持人）
  - 活跃事件列表
  - 事件进度详情查看
  - 手动更新进度按钮
  - 进度历史时间线

- **本轮合作事件管理组件**（仅主持人，重要）
  - **合作事件列表组件**
    - 合作事件卡片列表
    - 每个卡片显示：
      - 合作双方信息（发起方和接收方头像、昵称）
      - 合作类型标签
      - 合作内容预览（可展开查看完整内容）
      - 合作条件/要求
      - 预期收益说明
      - 达成时间
      - 谈判轮次（如果经过谈判）
      - 状态标签（原始/已修改/已删除）
  - **合作事件编辑组件**
    - 编辑弹窗/侧边栏
    - 富文本编辑器（编辑合作内容）
    - 合作条件/要求编辑框
    - 预期收益说明编辑框
    - 修改说明输入框（可选）
    - 保存/取消按钮
    - 编辑前后对比视图（可选）
  - **合作事件操作组件**
    - 编辑按钮
    - 删除按钮（标记为不参与推演）
    - 恢复按钮（恢复已删除的合作事件）
    - 状态指示器（原始/已修改/已删除）
  - **合作事件统计组件**
    - 合作事件总数显示
    - 已修改数量显示
    - 将参与推演的数量显示
    - 统计卡片样式

- **提交推演组件**
  - 配置摘要显示
  - 活跃多回合事件提醒（自动包含进度信息）
  - 统计信息
  - 提交按钮
  - 确认对话框

#### 4.2.8.1 多回合事件进度组件（所有玩家可见）
- **事件进度列表组件**
  - 活跃事件卡片列表
  - 事件内容展示
  - 进度条可视化
  - 进度百分比显示
  - 事件状态标签（进行中/已完成/已失败）
  - 最后更新回合显示

- **事件进度详情组件**
  - 事件完整描述
  - 进度条（当前/目标）
  - 进度历史时间线（可展开）
  - 每回合进度变化记录
  - 进度描述展示

- **事件进度更新动画**
  - 进度条动画效果
  - 进度变化提示
  - 事件完成/失败动画

#### 4.2.9 历史记录组件
- **历史记录列表组件**
  - 记录卡片/列表项
  - 复选框（批量选择）
  - 游戏信息展示
  - 操作按钮组
  - 空状态显示
  - 加载状态（骨架屏）

- **历史记录筛选组件**
  - 时间范围选择器
  - 游戏模式下拉选择
  - 结果筛选单选组
  - 排序下拉选择
  - 搜索框
  - 重置按钮

- **历史记录详情组件**
  - 基本信息展示
  - 回合详情列表（可展开/收起）
  - 玩家操作时间线
  - 游戏状态快照查看器
  - 临时事件/规则展示

- **删除确认对话框组件**
  - 单个删除确认
  - 批量删除确认
  - 删除进度显示

- **历史记录统计组件**
  - 统计数据卡片
  - 统计图表（可选）

#### 4.2.10 资源交易组件
- **交易发起组件**
  - 玩家选择器
  - 资源选择器（类型+数量）
  - 交易说明输入框
  - 交易预览卡片
  - 发起按钮

- **交易列表组件**
  - 待处理交易列表
  - 我的交易列表
  - 交易状态标签
  - 交易操作按钮（接受/拒绝/取消）

- **交易详情组件**
  - 交易双方信息
  - 交易资源详情
  - 交易倒计时
  - 交易状态显示

#### 4.2.11 合作申请组件
- **合作申请发起组件**
  - 选择合作对象下拉框
  - 合作类型选择器（资源合作/行动合作/策略合作等）
  - 富文本编辑器（合作内容编辑）
  - 合作条件/要求输入框
  - 预期收益说明输入框
  - 合作内容预览卡片
  - 发起按钮

- **合作申请列表组件**
  - 待处理合作申请列表（我收到的）
  - 我的合作申请列表（我发起的）
  - 谈判中的合作申请列表
  - 合作申请状态标签（待处理/谈判中/已接受/已拒绝/已超时）
  - 合作申请操作按钮（接受/拒绝/谈判/取消）

- **合作申请详情组件**
  - 合作发起者信息
  - 合作内容详情（完整显示）
  - 合作类型标签
  - 合作条件/要求
  - 预期收益说明
  - 操作按钮（接受/拒绝/谈判）
  - 合作申请倒计时
  - 合作申请状态显示

- **合作申请谈判组件**
  - 原始合作内容显示（只读）
  - 富文本编辑器（编辑谈判内容）
  - 修改说明输入框
  - 谈判轮次显示（第X轮谈判）
  - 谈判历史时间线
  - 发送谈判内容按钮
  - 谈判内容对比视图（原始 vs 当前）

#### 4.2.12 帮助组件
- **帮助按钮组件**
  - 问号图标 + "帮助"文字
  - 点击后显示帮助弹窗/侧边栏
  - 固定在页面右上角

- **帮助内容显示组件**
  - 帮助内容展示（支持富文本）
  - 滚动查看长内容
  - 关闭按钮
  - 响应式设计

- **帮助内容编辑组件**（仅管理员）
  - 富文本编辑器
  - 实时预览
  - 保存/取消按钮
  - 编辑历史记录（可选）

#### 4.2.13 公开声明组件
- **公开声明按钮组件**
  - 醒目的按钮样式（图标+文字"公开声明"）
  - 仅在决策阶段显示
  - 点击后弹出编辑弹窗

- **公开声明编辑组件**
  - 文字输入框（支持多行，最大长度500字）
  - 字符计数显示（已输入/最大长度）
  - 发送按钮
  - 取消按钮
  - 发送前确认对话框

- **公开声明列表组件**
  - 声明卡片列表（按时间倒序）
  - 每个声明卡片显示：
    - 发布者信息（头像、昵称、玩家索引）
    - 声明内容（完整显示）
    - 发布时间（相对时间）
    - 声明标识（醒目标识）
  - 新声明高亮提示（3秒后恢复正常）
  - 滚动查看功能
  - 声明数量统计

- **公开声明显示区域**
  - 固定在底部面板
  - 仅在决策阶段显示
  - 响应式设计

#### 4.2.14 游戏存档组件
- **存档列表组件**
  - 存档卡片列表
  - 存档信息展示（名称、回合、时间）
  - 自动/手动存档标识
  - 操作按钮（恢复/删除）

- **保存游戏组件**
  - 存档名称输入
  - 存档描述输入
  - 保存按钮
  - 保存成功提示

#### 4.2.15 任务/挑战组件
- **任务列表组件**
  - 任务卡片列表
  - 任务类型标签
  - 任务进度条
  - 任务奖励展示
  - 任务状态指示

- **任务详情组件**
  - 任务描述展示
  - 任务进度详情
  - 任务奖励详情
  - 参与玩家列表
  - 完成条件说明

#### 4.2.16 策略分析组件
- **策略列表组件**
  - 策略分类标签
  - 策略卡片列表
  - 策略统计信息
  - 策略筛选功能

- **策略详情组件**
  - 策略基本信息
  - 使用历史图表
  - 成功/失败案例
  - 适用场景分析
  - 改进建议展示

#### 4.2.17 主持人配置组件
- **API配置表单组件**
  - 提供商选择下拉框
  - 端点URL输入框
  - 请求方法选择
  - 请求头编辑器（键值对）
  - 请求体模板编辑器（代码编辑器）
  - 网络权限配置面板

- **游戏规则编辑器组件**
  - Markdown编辑器
  - 规则预览面板
  - 模板选择器

- **玩家配置组件**
  - 数字输入框（带验证）
  - 配置预览卡片
  - 自动计算显示

## 5. 状态管理设计

### 5.1 全局状态结构

```typescript
interface AppState {
  // 用户认证状态
  auth: {
    isAuthenticated: boolean;
    user: User | null;
    token: string | null;
  };
  
  // 房间状态
  rooms: {
    list: Room[];
    currentRoom: Room | null;
    loading: boolean;
  };
  
  // 主持人配置状态
  hostConfig: {
    roomId: string | null;
    apiConfig: ApiConfig | null;
    gameRules: string | null;
    playerConfig: PlayerConfig | null;
    decisionTimeLimit: number; // 决策时限（分钟）
    currentStep: 1 | 2 | 3;
    initializationCompleted: boolean;
    loading: boolean;
    error: string | null;
  };
  
  // 决策状态
  decisions: {
    currentRound: number;
    roundStatus: 'decision' | 'review' | 'inference' | 'result';
    decisionDeadline: string | null;
    timeRemaining: number; // 剩余秒数
    decisions: Decision[];
    submittedCount: number;
    totalPlayers: number;
    loading: boolean;
  };
  
  // 审核状态（仅主持人）
  review: {
    decisions: Decision[];
    temporaryEvents: TemporaryEvent[];
    temporaryRules: TemporaryRule[];
    loading: boolean;
  };
  
  // 多回合事件状态
  multiRoundEvents: {
    activeEvents: MultiRoundEvent[];
    loading: boolean;
  };
  
  // 游戏状态
  game: {
    currentSession: GameSession | null;
    gameState: GameState | null;
    loading: boolean;
    error: string | null;
  };
  
  // WebSocket连接状态
  websocket: {
    connected: boolean;
    reconnecting: boolean;
    messages: Message[];
  };
  
  // UI状态
  ui: {
    theme: 'light' | 'dark';
    sidebarOpen: boolean;
    notifications: Notification[];
  };
  
  // 历史记录状态
  history: {
    games: GameHistory[];
    selectedIds: string[];
    filters: HistoryFilters;
    pagination: {
      page: number;
      limit: number;
      total: number;
    };
    statistics: HistoryStatistics | null;
    loading: boolean;
    error: string | null;
  };
  
  // 资源交易状态
  trade: {
    pendingTrades: Trade[];
    myTrades: Trade[];
    loading: boolean;
  };
  
  // 合作申请状态
  cooperation: {
    pendingCooperations: Cooperation[];
    myCooperations: Cooperation[];
    negotiatingCooperations: Cooperation[];
    negotiationHistory: NegotiationHistory[];
    loading: boolean;
  };
  
  // 帮助内容状态
  help: {
    content: string;
    isEditing: boolean;
    loading: boolean;
  };
  
  // 公开声明状态
  publicStatements: {
    statements: PublicStatement[];
    currentRound: number;
    loading: boolean;
  };
  
  // 游戏存档状态
  saves: {
    saves: GameSave[];
    loading: boolean;
  };
  
  // 任务状态
  tasks: {
    tasks: Task[];
    loading: boolean;
  };
  
  // 策略分析状态
  strategies: {
    strategies: Strategy[];
    statistics: StrategyStatistics | null;
    loading: boolean;
  };
}
```

### 5.2 状态管理方案

#### 5.2.1 Redux Toolkit方案
- **Store结构**：
  - `authSlice`：用户认证
  - `roomsSlice`：房间管理
  - `hostConfigSlice`：主持人配置
  - `gameSlice`：游戏状态
  - `historySlice`：历史记录管理
  - `tradeSlice`：资源交易
  - `cooperationSlice`：合作申请
  - `helpSlice`：帮助内容
  - `publicStatementSlice`：公开声明
  - `saveSlice`：游戏存档
  - `taskSlice`：任务/挑战
  - `strategySlice`：策略分析
  - `multiRoundEventSlice`：多回合事件进度
  - `websocketSlice`：WebSocket连接
  - `uiSlice`：UI状态

- **异步操作**：使用`createAsyncThunk`
- **状态持久化**：使用`redux-persist`

#### 5.2.2 Zustand方案（轻量级）
- 多个独立的store
- 简单易用的API
- 内置持久化支持

### 5.3 状态同步策略

- **服务器状态优先**：WebSocket消息更新覆盖本地状态
- **乐观更新**：用户操作立即更新UI，等待服务器确认
- **状态版本控制**：使用版本号防止状态冲突
- **状态持久化**：关键状态保存到localStorage

## 6. API集成设计

### 6.1 HTTP API客户端

```typescript
// API客户端配置
const apiClient = axios.create({
  baseURL: process.env.REACT_APP_API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// 请求拦截器（添加Token）
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 响应拦截器（处理错误）
apiClient.interceptors.response.use(
  (response) => response.data,
  (error) => {
    if (error.response?.status === 401) {
      // Token过期，跳转登录
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

### 6.2 API服务封装

```typescript
// 系统API
export const systemAPI = {
  getGameInfo: () => apiClient.get('/api/system/info'),
};

// 用户API
export const userAPI = {
  login: (username: string, password: string) =>
    apiClient.post('/api/auth/login', { username, password }),
  register: (data: RegisterData) =>
    apiClient.post('/api/auth/register', data),
  getUserInfo: () => apiClient.get('/api/user/info'),
  updateUserInfo: (data: UserInfo) =>
    apiClient.put('/api/user/info', data),
};

// 房间API
export const roomAPI = {
  getRoomList: (params: RoomListParams) =>
    apiClient.get('/api/rooms/list', { params }),
  createRoom: (data: CreateRoomData) =>
    apiClient.post('/api/rooms/create', data),
  joinRoom: (roomId: string, password?: string) =>
    apiClient.post(`/api/rooms/${roomId}/join`, { password }),
  leaveRoom: (roomId: string) =>
    apiClient.post(`/api/rooms/${roomId}/leave`),
};

// 主持人配置API
export const hostConfigAPI = {
  getHostConfig: (roomId: string) =>
    apiClient.get(`/api/rooms/${roomId}/host-config`),
  saveApiConfig: (roomId: string, apiConfig: ApiConfigData) =>
    apiClient.post(`/api/rooms/${roomId}/host-config/api`, apiConfig),
  saveGameRules: (roomId: string, gameRules: string) =>
    apiClient.post(`/api/rooms/${roomId}/host-config/rules`, { game_rules: gameRules }),
  savePlayerConfig: (roomId: string, playerConfig: PlayerConfigData) =>
    apiClient.post(`/api/rooms/${roomId}/host-config/players`, playerConfig),
  completeInitialization: (roomId: string, validate?: boolean) =>
    apiClient.post(`/api/rooms/${roomId}/host-config/complete`, { validate }),
  validateConfig: (roomId: string) =>
    apiClient.post(`/api/rooms/${roomId}/host-config/validate`),
};

// 游戏API
export const gameAPI = {
  startGame: (roomId: string) =>
    apiClient.post(`/api/game/${roomId}/start`),
  submitDecision: (sessionId: string, decision: DecisionData) =>
    apiClient.post(`/api/game/${sessionId}/decision`, decision),
  // 决策选项API
  getDecisionOptions: (sessionId: string, round: number) =>
    apiClient.get(`/api/game/${sessionId}/round/${round}/decision-options`),
  refreshDecisionOptions: (sessionId: string, round: number) =>
    apiClient.post(`/api/game/${sessionId}/round/${round}/decision-options/refresh`),
  // 公开声明API
  publishPublicStatement: (sessionId: string, round: number, data: { content: string }) =>
    apiClient.post(`/api/game/${sessionId}/round/${round}/public-statement`, data),
  getPublicStatements: (sessionId: string, round: number) =>
    apiClient.get(`/api/game/${sessionId}/round/${round}/public-statements`),
  getDecisionStatus: (sessionId: string, round: number) =>
    apiClient.get(`/api/game/${sessionId}/round/${round}/decisions`),
  getDecisionsForReview: (sessionId: string, round: number) =>
    apiClient.get(`/api/game/${sessionId}/round/${round}/decisions/review`),
  submitToAI: (sessionId: string, round: number, data: SubmitToAIData) =>
    apiClient.post(`/api/game/${sessionId}/round/${round}/submit-to-ai`, data),
  // 注意：data中可包含cooperation_ids数组，不传则自动包含所有状态为"原始"或"已修改"的合作事件
  // 合作事件管理API（仅主持人）
  getRoundCooperations: (sessionId: string, round: number) =>
    apiClient.get(`/api/game/${sessionId}/round/${round}/cooperations`),
  updateCooperation: (sessionId: string, round: number, cooperationId: string, data: UpdateCooperationData) =>
    apiClient.put(`/api/game/${sessionId}/round/${round}/cooperations/${cooperationId}`, data),
  toggleDeleteCooperation: (sessionId: string, round: number, cooperationId: string, delete: boolean) =>
    apiClient.post(`/api/game/${sessionId}/round/${round}/cooperations/${cooperationId}/toggle-delete`, { delete }),
  addTemporaryEvent: (sessionId: string, round: number, event: TemporaryEventData) =>
    apiClient.post(`/api/game/${sessionId}/round/${round}/temporary-event`, event),
  updateEventProgress: (sessionId: string, eventId: string, progressData: EventProgressData) =>
    apiClient.put(`/api/game/${sessionId}/events/${eventId}/progress`, progressData),
  getActiveEvents: (sessionId: string) =>
    apiClient.get(`/api/game/${sessionId}/events/active`),
  addTemporaryRule: (sessionId: string, round: number, rule: TemporaryRuleData) =>
    apiClient.post(`/api/game/${sessionId}/round/${round}/temporary-rule`, rule),
  getInferenceResult: (sessionId: string, round: number) =>
    apiClient.get(`/api/game/${sessionId}/round/${round}/inference-result`),
  getGameState: (sessionId: string) =>
    apiClient.get(`/api/game/${sessionId}/state`),
  // 面板器API
  getPlayerDetails: (sessionId: string, playerIndex: number) =>
    apiClient.get(`/api/game/${sessionId}/player/${playerIndex}/details`),
  getPlayerAchievements: (sessionId: string, playerIndex: number) =>
    apiClient.get(`/api/game/${sessionId}/player/${playerIndex}/achievements`),
  getGameStatistics: (sessionId: string) =>
    apiClient.get(`/api/game/${sessionId}/statistics`),
  getMilestones: (sessionId: string, filters?: MilestoneFilters) =>
    apiClient.get(`/api/game/${sessionId}/milestones`, { params: filters }),
  getGameHistory: (params: HistoryParams) =>
    apiClient.get('/api/game/history', { params }),
  getGameHistoryDetail: (historyId: string) =>
    apiClient.get(`/api/game/history/${historyId}`),
  deleteGameHistory: (historyId: string) =>
    apiClient.delete(`/api/game/history/${historyId}`),
  batchDeleteGameHistory: (historyIds: string[]) =>
    apiClient.delete('/api/game/history/batch', { data: { history_ids: historyIds } }),
  getGameHistoryStatistics: (params?: StatisticsParams) =>
    apiClient.get('/api/game/history/statistics', { params }),
  // 资源交易API
  requestTrade: (sessionId: string, tradeData: TradeRequestData) =>
    apiClient.post(`/api/game/${sessionId}/trade/request`, tradeData),
  acceptTrade: (sessionId: string, tradeId: string) =>
    apiClient.post(`/api/game/${sessionId}/trade/${tradeId}/accept`),
  rejectTrade: (sessionId: string, tradeId: string) =>
    apiClient.post(`/api/game/${sessionId}/trade/${tradeId}/reject`),
  getTradeList: (sessionId: string) =>
    apiClient.get(`/api/game/${sessionId}/trade/list`),
  // 合作申请API
  requestCooperation: (sessionId: string, data: CooperationRequestData) =>
    apiClient.post(`/api/game/${sessionId}/cooperation/request`, data),
  acceptCooperation: (sessionId: string, cooperationId: string) =>
    apiClient.post(`/api/game/${sessionId}/cooperation/${cooperationId}/accept`),
  rejectCooperation: (sessionId: string, cooperationId: string) =>
    apiClient.post(`/api/game/${sessionId}/cooperation/${cooperationId}/reject`),
  negotiateCooperation: (sessionId: string, cooperationId: string, data: NegotiationData) =>
    apiClient.post(`/api/game/${sessionId}/cooperation/${cooperationId}/negotiate`, data),
  getCooperationList: (sessionId: string) =>
    apiClient.get(`/api/game/${sessionId}/cooperation/list`),
  getNegotiationHistory: (sessionId: string, cooperationId: string) =>
    apiClient.get(`/api/game/${sessionId}/cooperation/${cooperationId}/negotiation-history`),
  cancelCooperation: (sessionId: string, cooperationId: string) =>
    apiClient.post(`/api/game/${sessionId}/cooperation/${cooperationId}/cancel`),
  // 合作事件管理API（仅主持人）
  getRoundCooperations: (sessionId: string, round: number) =>
    apiClient.get(`/api/game/${sessionId}/round/${round}/cooperations`),
  updateCooperation: (sessionId: string, round: number, cooperationId: string, data: UpdateCooperationData) =>
    apiClient.put(`/api/game/${sessionId}/round/${round}/cooperations/${cooperationId}`, data),
  toggleDeleteCooperation: (sessionId: string, round: number, cooperationId: string, delete: boolean) =>
    apiClient.post(`/api/game/${sessionId}/round/${round}/cooperations/${cooperationId}/toggle-delete`, { delete }),
  // 帮助内容API
  getHelpContent: () => apiClient.get('/api/system/help'),
  updateHelpContent: (data: { content: string }) =>
    apiClient.put('/api/system/help', data),
  // 游戏存档API
  saveGame: (sessionId: string, saveData?: SaveGameData) =>
    apiClient.post(`/api/game/${sessionId}/save`, saveData),
  getGameSaves: (sessionId: string) =>
    apiClient.get(`/api/game/${sessionId}/saves`),
  restoreGame: (sessionId: string, saveId: string) =>
    apiClient.post(`/api/game/${sessionId}/restore/${saveId}`),
  deleteGameSave: (sessionId: string, saveId: string) =>
    apiClient.delete(`/api/game/${sessionId}/saves/${saveId}`),
  // 任务/挑战API
  getTasks: (sessionId: string) =>
    apiClient.get(`/api/game/${sessionId}/tasks`),
  getTaskDetail: (sessionId: string, taskId: string) =>
    apiClient.get(`/api/game/${sessionId}/tasks/${taskId}`),
  // 多回合事件进度API
  addTemporaryEvent: (sessionId: string, round: number, eventData: TemporaryEventData) =>
    apiClient.post(`/api/game/${sessionId}/round/${round}/temporary-event`, eventData),
  updateEventProgress: (sessionId: string, eventId: string, progressData: EventProgressData) =>
    apiClient.put(`/api/game/${sessionId}/events/${eventId}/progress`, progressData),
  getActiveEvents: (sessionId: string) =>
    apiClient.get(`/api/game/${sessionId}/events/active`),
  // 策略分析API
  getUserStrategies: (params?: StrategyParams) =>
    apiClient.get('/api/user/strategies', { params }),
  getStrategyAnalysis: (strategyId: string) =>
    apiClient.get(`/api/user/strategies/${strategyId}/analysis`),
};
```

### 6.3 WebSocket服务封装

```typescript
class WebSocketService {
  private socket: Socket | null = null;
  private reconnectAttempts = 0;
  private maxReconnectAttempts = 5;

  connect(token: string) {
    this.socket = io(process.env.REACT_APP_WS_URL, {
      auth: { token },
      transports: ['websocket'],
    });

    this.socket.on('connect', () => {
      this.reconnectAttempts = 0;
      // 更新连接状态
    });

    this.socket.on('disconnect', () => {
      // 尝试重连
      this.reconnect();
    });

    // 注册消息处理器
    this.registerHandlers();
    // 设置Acknowledgments机制
    this.setupAcknowledgmentHandlers();
  }

  private registerHandlers() {
    this.socket?.on('game_state_update', (data) => {
      // 处理游戏状态更新
    });

    this.socket?.on('action_result', (data) => {
      // 处理操作结果
    });

    this.socket?.on('narrative', (data) => {
      // 处理AI剧情
    });

    this.socket?.on('host_config_updated', (data) => {
      // 处理主持人配置更新
    });

    this.socket?.on('initialization_completed', (data) => {
      // 处理初始化完成通知
    });

    this.socket?.on('decision_submitted', (data) => {
      // 处理决策提交通知
    });

    this.socket?.on('decision_status_update', (data) => {
      // 处理决策状态更新
    });

    this.socket?.on('decision_deadline_update', (data) => {
      // 处理决策时限更新
    });

    this.socket?.on('round_stage_changed', (data) => {
      // 处理回合阶段切换
    });

    this.socket?.on('inference_started', (data) => {
      // 处理推演开始
    });

    this.socket?.on('inference_completed', (data) => {
      // 处理推演完成
    });

    this.socket?.on('chat_message', (data) => {
      // 处理聊天消息
    });

    this.socket?.on('public_statement', (data) => {
      // 处理公开声明通知
      // 更新公开声明列表，显示新声明
    });

    this.socket?.on('trade_request', (data) => {
      // 处理交易请求通知
    });

    this.socket?.on('trade_status_update', (data) => {
      // 处理交易状态更新
    });

    this.socket?.on('cooperation_request', (data) => {
      // 处理合作申请请求通知
    });

    this.socket?.on('cooperation_status_update', (data) => {
      // 处理合作申请状态更新
    });

    this.socket?.on('cooperation_negotiation', (data) => {
      // 处理合作申请谈判内容
    });

    this.socket?.on('task_update', (data) => {
      // 处理任务更新
    });

    this.socket?.on('multi_round_event_progress', (data) => {
      // 处理多回合事件进度更新
    });

    this.socket?.on('multi_round_event_completed', (data) => {
      // 处理多回合事件完成/失败
    });

    this.socket?.on('decision_options_ready', (data) => {
      // 处理决策选项生成完成通知
      // 更新决策选项列表
      // 显示选项加载完成提示
      // 允许玩家开始选择选项
    });

    this.socket?.on('achievement_unlocked', (data) => {
      // 处理成就解锁通知
      // 显示成就解锁动画和提示
      // 更新玩家成就列表
      // 推送给所有玩家（增加游戏趣味性）
    });

    this.socket?.on('milestone_recorded', (data) => {
      // 处理大事纪记录通知
      // 显示大事纪记录提示
      // 更新大事纪时间线
      // 重要事件高亮显示
    });

    // ... 其他消息类型
  }

  send(message: Message) {
    this.socket?.emit('message', message);
  }

  /**
   * 发送带确认的消息（使用Socket.io Acknowledgments）
   * @param event 事件名称
   * @param data 消息数据
   * @param timeout 超时时间（毫秒），默认5000
   * @returns Promise，成功时resolve，失败时reject
   */
  sendWithAck(event: string, data: any, timeout: number = 5000): Promise<any> {
    return new Promise((resolve, reject) => {
      if (!this.socket?.connected) {
        reject(new Error('Socket not connected'));
        return;
      }

      const timer = setTimeout(() => {
        reject(new Error('Message acknowledgment timeout'));
      }, timeout);

      this.socket.emit(event, data, (response: any) => {
        clearTimeout(timer);
        if (response.error) {
          reject(new Error(response.error));
        } else {
          resolve(response);
        }
      });
    });
  }

  /**
   * 接收带确认的消息（使用Socket.io Acknowledgments）
   * 关键消息类型需要确认接收，确保消息可靠传递
   */
  private setupAcknowledgmentHandlers() {
    // 关键消息类型使用acknowledgments确认接收
    const criticalEvents = [
      'game_state_update',
      'round_stage_changed',
      'inference_completed',
      'decision_deadline_update'
    ];

    criticalEvents.forEach(event => {
      this.socket?.on(event, (data: any, ack: Function) => {
        // 处理消息
        this.handleMessage(event, data);
        
        // 确认接收
        if (ack && typeof ack === 'function') {
          ack({ received: true, timestamp: Date.now() });
        }
      });
    });
  }

  private reconnect() {
    if (this.reconnectAttempts < this.maxReconnectAttempts) {
      this.reconnectAttempts++;
      setTimeout(() => {
        this.socket?.connect();
      }, 3000);
    }
  }

  disconnect() {
    this.socket?.disconnect();
  }
}
```

## 7. UI/UX设计要求

### 7.1 设计风格
- **现代简约**：简洁的界面，清晰的层次
- **文字为主**：突出文字内容，减少视觉干扰
- **深色模式**：支持深色/浅色主题切换
- **动画流畅**：适度的动画提升体验

### 7.2 色彩方案

#### 7.2.1 浅色主题
- 主色：蓝色系（#1890ff）
- 背景：白色（#ffffff）
- 文字：深灰色（#262626）
- 次要文字：灰色（#8c8c8c）
- 边框：浅灰色（#d9d9d9）

#### 7.2.2 深色主题
- 主色：蓝色系（#1890ff）
- 背景：深灰色（#141414）
- 文字：浅灰色（#ffffff）
- 次要文字：中灰色（#bfbfbf）
- 边框：深灰色（#434343）

### 7.3 字体规范
- **标题字体**：16-24px，加粗
- **正文字体**：14-16px，常规
- **辅助文字**：12-14px，常规
- **代码字体**：等宽字体（Monaco, Consolas）

### 7.4 间距规范
- **页面边距**：16-24px
- **组件间距**：8-16px
- **内容间距**：4-8px

### 7.5 响应式设计

#### 7.5.1 断点设置
- **移动端**：< 768px
- **平板**：768px - 1024px
- **桌面**：> 1024px

#### 7.5.2 移动端适配
- 游戏主界面：单列布局，面板可折叠
- 房间列表：卡片式布局
- 操作输入：底部固定输入框
- 触摸优化：按钮大小至少44x44px

### 7.6 可访问性
- 键盘导航支持
- 屏幕阅读器支持（ARIA标签）
- 颜色对比度符合WCAG标准
- 焦点状态清晰可见

## 8. 性能优化

### 8.1 代码优化
- **代码分割**：路由级别的代码分割
- **懒加载**：组件和图片懒加载
- **Tree Shaking**：移除未使用的代码
- **压缩优化**：代码和资源压缩

### 8.2 渲染优化
- **虚拟滚动**：长列表使用虚拟滚动
- **React.memo**：避免不必要的组件重渲染
- **useMemo/useCallback**：缓存计算结果和函数
- **防抖节流**：输入和滚动事件优化

### 8.3 网络优化
- **请求合并**：合并多个API请求
- **请求缓存**：缓存静态数据
- **图片优化**：使用WebP格式，懒加载
- **CDN加速**：静态资源使用CDN

### 8.4 状态优化
- **状态归一化**：避免嵌套状态
- **选择性订阅**：只订阅需要的状态
- **状态持久化**：关键状态本地缓存

## 9. 错误处理与边界

### 9.1 错误边界组件
```typescript
class ErrorBoundary extends React.Component {
  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    // 记录错误到日志服务
    logErrorToService(error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return <ErrorFallback />;
    }
    return this.props.children;
  }
}
```

### 9.2 错误类型处理
- **网络错误**：显示重试按钮
- **API错误**：显示错误消息
- **渲染错误**：显示错误边界页面
- **WebSocket错误**：自动重连

### 9.3 错误日志
- 前端错误收集（Sentry等）
- 用户操作日志
- 性能监控

## 10. 测试策略

### 10.1 单元测试
- 工具：Jest + React Testing Library
- 测试范围：工具函数、组件逻辑
- 覆盖率目标：> 80%

### 10.2 集成测试
- 测试范围：API集成、状态管理
- 工具：Jest + MSW (Mock Service Worker)

### 10.3 E2E测试
- 工具：Cypress / Playwright
- 测试场景：完整用户流程
- 关键路径：登录→创建房间→开始游戏→提交操作

### 10.4 性能测试
- Lighthouse性能评分
- 首屏加载时间
- 交互响应时间

## 11. 开发工具与规范

### 11.1 代码规范
- **ESLint**：代码质量检查
- **Prettier**：代码格式化
- **TypeScript**：类型检查
- **Husky**：Git hooks（提交前检查）

### 11.2 开发环境
- **热重载**：开发时自动刷新
- **Source Map**：方便调试
- **代理配置**：开发环境API代理

### 11.3 构建与部署
- **环境变量**：区分开发/测试/生产环境
- **构建优化**：生产环境代码优化
- **部署流程**：CI/CD自动化部署

## 12. 开发计划建议

### 12.1 第一阶段：基础框架（1-2周）
- 项目初始化和技术栈搭建
- 路由和基础布局
- 用户认证（登录/注册）
- 基础组件库搭建

### 12.2 第二阶段：房间系统（1-2周）
- 房间列表页面
- 创建房间功能
- 房间等待页面
- 房间管理功能

### 12.3 第三阶段：游戏核心（2-3周）
- 游戏主界面布局
- WebSocket集成
- 游戏状态管理
- 操作输入和提交
- AI剧情展示

### 12.4 第四阶段：优化完善（1-2周）
- UI/UX优化
- 性能优化
- 错误处理完善
- 响应式适配
- 测试编写

## 13. 技术难点与解决方案

### 13.1 WebSocket实时同步
**难点**：状态同步、消息顺序、断线重连
**解决方案**：
- 使用消息序列号保证顺序
- 实现自动重连机制
- 状态版本控制

### 13.2 游戏状态管理
**难点**：复杂状态、状态同步、性能优化
**解决方案**：
- 状态归一化设计
- 使用Redux/Zustand管理状态
- 选择性更新，避免全量重渲染

### 13.3 AI剧情展示
**难点**：流畅展示、性能优化
**解决方案**：
- 打字机效果使用requestAnimationFrame
- 虚拟滚动处理长文本
- 文本分块渲染

### 13.4 移动端适配
**难点**：小屏幕布局、触摸交互
**解决方案**：
- 响应式布局设计
- 移动端专用组件
- 触摸手势支持

## 14. 附录

### 14.1 技术选型对比

#### 前端框架
- **React**：生态丰富，组件化好，学习曲线适中
- **Vue 3**：易学易用，性能优秀，适合快速开发
- **Next.js**：SSR支持，适合SEO，但复杂度较高

#### 状态管理
- **Redux Toolkit**：功能强大，适合复杂状态
- **Zustand**：轻量级，API简单，适合中小型项目
- **Pinia**：Vue官方推荐，类型支持好

#### UI组件库
- **Ant Design**：组件丰富，文档完善，适合后台系统
- **Material-UI**：Material Design风格，组件齐全
- **Element Plus**：Vue生态，组件丰富

### 14.2 参考资源
- React官方文档
- WebSocket API文档
- 游戏UI设计参考
- 响应式设计最佳实践

---

**文档版本**：v1.0  
**最后更新**：2024年  
**维护者**：开发团队

