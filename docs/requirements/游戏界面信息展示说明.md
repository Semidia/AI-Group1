# 游戏界面信息展示说明

本文档详细说明玩家决策主界面和主持人控制界面的布局和信息展示。

---

> 进度备注  
> - 后端阶段1/2/3 已通过自动化测试（基础搭建、认证、房间基础流）。  
> - 前端界面联调：登录/注册/忘记密码已可对接；房间列表/创建/等待页需接入 `/api/rooms/*` 并订阅 `player_joined/left/system_message`。  
> - 已知：后端未授权返回 500（期望 401），待后端修复，前端保持全局401跳转。

## 一、玩家决策主界面 (`/game/:sessionId`)

### 界面布局结构

```
┌─────────────────────────────────────────────────────────────────┐
│  [返回]  游戏状态栏  [帮助]                                      │
│  第5回合 | 决策阶段 | ⏱ 03:45 | 进行中 | [退出游戏]            │
├──────────┬──────────────────────────────┬───────────────────────┤
│          │                              │                       │
│ 左侧面板 │        中间面板              │      右侧面板         │
│          │                              │                       │
│ [面板器] │  剧情展示区                  │  排名面板             │
│          │  ┌──────────────────────┐   │  1. 玩家1 ⬆          │
│ 当前玩家 │  │ AI生成的剧情文本      │   │  2. 玩家2 ⬇          │
│ ┌──────┐ │  │ (打字机效果)          │   │  3. 玩家3 →          │
│ │头像  │ │  │                      │   │                       │
│ │昵称  │ │  │ 场景描述...          │   │  资源面板             │
│ │等级  │ │  │                      │   │  全局资源统计         │
│ │      │ │  │ 事件提示...          │   │                       │
│ │资源  │ │  └──────────────────────┘   │  决策状态面板         │
│ │金币  │ │                              │  已提交: 3/4          │
│ │能量  │ │  操作输入区                  │  ✓ 玩家1              │
│ │      │ │  ┌──────────────────────┐   │  ✓ 玩家2              │
│ │属性  │ │  │ 决策选项区域          │   │  ⏳ 玩家3              │
│ │生命  │ │  │ ☐ 选项1: 攻击敌人A   │   │  ⏳ 玩家4              │
│ │攻击  │ │  │   [攻击] 可能造成15点 │   │                       │
│ │      │ │  │ ☑ 选项2: 与玩家2合作 │   │  任务/目标面板         │
│ │状态  │ │  │   [合作] 可能获得资源 │   │  📋 收集100金币        │
│ │✓已提交│ │  │ ☐ 选项3: 探索新区域  │   │  进度: 60/100         │
│ └──────┘ │  │   [探索] 可能发现资源 │   │                       │
│          │  │ [刷新选项] (1/1)      │   │  资源交易面板         │
│ 其他玩家 │  │ 已选择: 1个选项       │   │  💰 待处理交易: 1     │
│ ┌──────┐ │  └──────────────────────┘   │                       │
│ │玩家2 │ │                              │  合作申请面板         │
│ │✓已提交│ │  ┌──────────────────────┐   │  🤝 待处理合作: 1     │
│ └──────┘ │  │ 决策输入框            │   │                       │
│ ┌──────┐ │  │ [可输入详细指令...]   │   │  多回合事件进度       │
│ │玩家3 │ │  │                      │   │  📊 地震事件           │
│ │⏳待提交│ │  │ 字符数: 0/500        │   │  进度: 50/100 (50%)   │
│ └──────┘ │  └──────────────────────┘   │                       │
│          │                              │                       │
│          │  [提交决策] [公开声明]       │                       │
│          │                              │                       │
│          │  已提交提示:                 │                       │
│          │  ✓ 已选择: 选项2            │                       │
│          │  ✓ 自定义文本: "..."        │                       │
│          │  ⏰ 提交时间: 12:00:00       │                       │
│          │                              │                       │
│          │  操作历史记录 [展开/收起]    │                       │
│          │                              │                       │
├──────────┴──────────────────────────────┴───────────────────────┤
│  底部面板：消息/通知                                               │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │ 公开声明区域                                                │ │
│  │ 📢 玩家1: "我宣布将全力支持玩家2的行动！"  [2分钟前]        │ │
│  │ 📢 玩家2: "感谢玩家1的支持！"  [1分钟前]                    │ │
│  │                                                              │ │
│  │ 系统消息                                                    │ │
│  │ ℹ️ 玩家3提交了决策                                           │ │
│  │ ⚠️ 决策时限剩余30秒                                          │ │
│  │                                                              │ │
│  │ 多回合事件进度更新                                           │ │
│  │ 📊 地震事件进度更新: 50% → 60%                              │ │
│  └───────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

### 1. 顶部游戏状态栏

**显示信息：**
- **当前回合数**：第X回合
- **回合阶段**：决策阶段 / 审核阶段 / 推演阶段 / 结果阶段
- **决策倒计时**（决策阶段显示）：
  - 圆形进度条
  - 剩余时间（MM:SS格式，如 03:45）
  - 警告提示（剩余30秒时变红）
  - 超时提示
- **游戏状态**：进行中 / 暂停 / 已结束
- **退出游戏按钮**

---

### 2. 左侧面板 - 玩家信息

#### 2.1 面板器按钮（顶部）
- **位置**：左侧面板顶部
- **功能**：点击跳转到面板器页面，查看详细统计信息
- **状态**：游戏进行中时可用

#### 2.2 当前玩家信息（高亮显示）
**显示内容：**
- **基本信息**
  - 玩家头像
  - 玩家昵称
  - 玩家等级
- **资源信息**
  - 金币：XXX
  - 能量：XXX
  - 其他资源...
- **状态属性**
  - 生命值：XXX/XXX
  - 攻击力：XXX
  - 防御力：XXX
  - 其他属性...
- **决策状态指示**（决策阶段显示）
  - ✓ 已提交（绿色对勾）
  - ⚠ 未提交（红色警告）
  - 提交时间：XX:XX:XX

#### 2.3 其他玩家列表
**每个玩家显示：**
- 玩家头像和昵称
- 资源概览（主要资源数值）
- **决策状态指示器**（决策阶段显示）
  - ✓ 已提交（绿色对勾图标）
  - ⏳ 未提交（灰色待提交图标）
  - 悬停显示提交时间

---

### 3. 中间面板 - 游戏主区域

#### 3.1 剧情展示区
**显示内容：**
- **AI生成的剧情文本**
  - 打字机效果展示
  - 场景描述
  - 事件提示
  - 历史剧情滚动查看（可滚动查看之前的剧情）

#### 3.2 操作输入区（决策阶段显示）

##### 3.2.1 决策选项区域
**显示内容：**
- **选项列表**（AI生成，每回合3个选项，支持多选）
  - ☐/☑ 选项1：攻击敌人A
    - 标签：[攻击]
    - 预期效果：可能造成15点伤害
  - ☐/☑ 选项2：与玩家2合作
    - 标签：[合作]
    - 预期效果：可能获得资源支持
  - ☐/☑ 选项3：探索新区域
    - 标签：[探索]
    - 预期效果：可能发现隐藏资源
- **选项加载状态**：生成中显示骨架屏
- **选项刷新按钮**：每回合限制刷新1次
- **选项说明**："AI为您推荐的决策选项，可多选组合"
- **选择提示**：
  - 已选择X个选项
  - 多选组合说明："多个选项将组合执行，主持人可调整"

##### 3.2.2 决策输入框
**显示内容：**
- **自由输入框**（支持多行）
  - 占位符："可输入详细指令，或补充说明已选选项"
  - 字符计数：0/500
  - 支持与选项组合使用

##### 3.2.3 提交按钮
**状态显示：**
- 未选择选项且未输入文本：禁用
- 已选择选项或已输入文本：可用
- 提交时：显示加载状态
- 已提交后：禁用，显示"已提交"提示

##### 3.2.4 已提交提示（提交后显示）
**显示内容：**
- ✓ 已选择的选项列表（如有）
- ✓ 提交的自定义文本（如有）
- ⏰ 提交时间：XX:XX:XX

##### 3.2.5 公开声明按钮
- 点击后弹出公开声明编辑弹窗
- 可输入声明内容（最大500字）
- 发送给所有玩家

##### 3.2.6 操作历史记录
- 可展开/收起
- 显示最近10条决策记录

---

### 4. 右侧面板 - 游戏信息

#### 4.1 排名面板
**显示内容：**
- 实时排名列表（按排名排序）
  - 1. 玩家1 ⬆（排名上升）
  - 2. 玩家2 ⬇（排名下降）
  - 3. 玩家3 →（排名不变）
- 排名变化动画

#### 4.2 资源面板
**显示内容：**
- 全局资源统计
- 资源变化趋势图

#### 4.3 决策状态面板（决策阶段显示）
**显示内容：**
- **决策进度**：已提交 3/4
- **各玩家决策状态列表**
  - ✓ 玩家1（已提交）
  - ✓ 玩家2（已提交）
  - ⏳ 玩家3（待提交）
  - ⏳ 玩家4（待提交）
- **未提交玩家提醒**

#### 4.4 任务/目标面板
**显示内容：**
- **当前任务列表**
  - 任务标题和描述
  - 任务类型标签（收集/战斗/探索/合作）
  - 任务进度条（当前/目标）
  - 任务奖励显示
  - 任务截止时间
  - 任务状态（进行中/已完成/已失败）
- 任务详情查看（点击展开）

#### 4.5 资源交易面板（可选，可折叠）
**显示内容：**
- 交易请求列表
- 发起交易按钮
- 待处理交易通知（数量）
- 交易历史记录

#### 4.6 合作申请面板（可选，可折叠）
**显示内容：**
- 合作申请请求列表
- 发起合作申请按钮
- 待处理合作申请通知（数量）
- 合作申请历史记录
- 谈判中的合作申请（显示谈判轮次）

#### 4.7 多回合事件进度面板（所有玩家可见）
**显示内容：**
- **活跃的多回合事件列表**
  - 事件内容描述
  - 进度条（当前进度/目标进度）
  - 进度百分比显示（如 50%）
  - 事件状态（进行中/已完成/已失败）
  - 进度历史时间线（可展开查看）
  - 最后更新回合数
- 事件完成/失败提示
- 自动刷新（实时更新）

#### 4.8 游戏存档面板（可选，可折叠）
**显示内容：**
- 存档列表
- 保存游戏按钮
- 恢复游戏按钮（仅主持人可见）

---

### 5. 底部面板 - 消息/通知

#### 5.1 公开声明区域（决策阶段显示）
**显示内容：**
- **公开声明列表**（按时间倒序）
  - 📢 玩家1："我宣布将全力支持玩家2的行动！" [2分钟前]
  - 📢 玩家2："感谢玩家1的支持！" [1分钟前]
  - 发布者信息（头像、昵称、玩家索引）
  - 声明标识（醒目标识为公开声明）
- **新声明提示**：收到新声明时高亮显示
- **声明数量统计**：本回合公开声明总数

#### 5.2 系统消息滚动
**显示内容：**
- ℹ️ 玩家3提交了决策
- ⚠️ 决策时限剩余30秒
- ✅ 任务"收集100金币"已完成
- 📊 多回合事件进度更新：地震事件 50% → 60%
- 🎉 玩家1解锁成就"百万富翁"
- 📝 大事纪：玩家1与玩家2达成重大交易

---

## 二、主持人控制界面（审核阶段）

### 界面布局结构

```
┌─────────────────────────────────────────────────────────────────┐
│  [返回]  游戏状态栏  [帮助]                                      │
│  第5回合 | 审核阶段 | 进行中 | [退出游戏]                        │
├──────────┬──────────────────────────────┬───────────────────────┤
│          │                              │                       │
│ 左侧面板 │        中间面板              │      右侧面板         │
│          │    (审核区域)                │                       │
│ [面板器] │                              │  临时事件/规则面板     │
│          │  决策列表区域                │  ┌─────────────────┐ │
│ 当前玩家 │  ┌────────────────────────┐ │  │ 临时事件列表     │ │
│ (主持人) │  │ 玩家1的决策            │ │  │ • 事件1          │ │
│          │  │ ┌──────────────────┐ │ │  │ • 事件2          │ │
│ 其他玩家 │  │ │ 已选选项:         │ │ │  │ [添加事件]        │ │
│          │  │ │ ☑ 选项2: 与玩家2  │ │ │  │                  │ │
│          │  │ │   合作 [合作]     │ │ │  │ 临时规则列表     │ │
│          │  │ │                    │ │ │  │ • 规则1          │ │
│          │  │ │ 组合建议:          │ │ │  │ [添加规则]        │ │
│          │  │ │ "与玩家2合作探索" │ │ │  └─────────────────┘ │
│          │  │ │ ✓ 合理             │ │ │                       │
│          │  │ └──────────────────┘ │ │ │  本轮合作事件区域   │
│          │  │                       │ │ │  ┌─────────────────┐ │
│          │  │ 自定义文本:           │ │ │  │ 合作事件1        │ │
│          │  │ "我要与玩家2合作探索 │ │ │  │ 玩家1 ↔ 玩家2    │ │
│          │  │  新区域，找到资源后  │ │ │  │ [编辑] [删除]     │ │
│          │  │  再攻击敌人A"        │ │ │  └─────────────────┘ │
│          │  │                       │ │ │                       │
│          │  │ [编辑决策] [查看详情] │ │ │  多回合事件进度管理 │
│          │  │ ⏰ 提交时间: 12:00:00 │ │ │  ┌─────────────────┐ │
│          │  │ ✓ 已审核              │ │ │  │ 地震事件         │ │
│          │  └────────────────────────┘ │ │  │ 进度: 50/100      │ │
│          │                              │ │  │ [更新进度]       │ │
│          │  ┌────────────────────────┐ │ │  └─────────────────┘ │
│          │  │ 玩家2的决策            │ │ │                       │
│          │  │ ...                   │ │ │                       │
│          │  └────────────────────────┘ │ │                       │
│          │                              │ │                       │
│          │  临时事件添加区域            │ │                       │
│          │  ┌────────────────────────┐ │ │                       │
│          │  │ 事件类型: [单回合▼]    │ │ │                       │
│          │  │ 事件内容: [输入框]     │ │ │                       │
│          │  │ [添加事件]              │ │ │                       │
│          │  └────────────────────────┘ │ │                       │
│          │                              │ │                       │
│          │  临时规则添加区域            │ │                       │
│          │  ┌────────────────────────┐ │ │                       │
│          │  │ 规则类型: [单回合▼]    │ │ │                       │
│          │  │ 规则内容: [输入框]     │ │ │                       │
│          │  │ 优先级: [高▼]          │ │ │                       │
│          │  │ [添加规则]              │ │ │                       │
│          │  └────────────────────────┘ │ │                       │
│          │                              │ │                       │
│          │  [批量审核] [提交给AI推演]  │ │                       │
│          │                              │ │                       │
└──────────┴──────────────────────────────┴───────────────────────┘
```

---

### 1. 顶部游戏状态栏（与玩家界面相同）

**显示信息：**
- 当前回合数
- 回合阶段：**审核阶段**
- 游戏状态
- 退出游戏按钮

---

### 2. 中间面板 - 审核区域（仅主持人可见）

#### 2.1 决策列表区域

**每个玩家决策卡片显示：**

##### 玩家信息
- 玩家头像、昵称、玩家索引

##### 决策选项显示（如果玩家选择了选项）
- **已选选项列表**
  - ☑ 选项2：与玩家2合作
    - 选项ID：uuid2
    - 选项类别标签：[合作]
- **选项组合建议**
  - AI生成的组合说明："与玩家2合作探索新区域"
- **组合有效性标识**
  - ✓ 合理（绿色）
  - ⚠ 警告（黄色，需要关注）
  - ✗ 冲突（红色，可能有问题）

##### 自定义文本显示（如果玩家输入了自定义文本）
- 文本内容完整显示
- 字符数统计：XX/500

##### 决策编辑功能（主持人可编辑）
- **[编辑决策] 按钮**
  - 点击进入编辑模式
  - 编辑界面功能：
    - 可修改/删除已选选项
    - 可添加新选项（从选项库选择）
    - 可修改自定义文本
    - 可查看选项组合建议
    - 修改说明输入（可选）
    - [保存修改] [取消编辑]
- **修改记录显示**（如果已修改）
  - 显示修改历史
  - 修改原因
  - 修改时间

##### 其他信息
- ⏰ 提交时间：XX:XX:XX
- 审核状态：待审核 / 已审核
- [审核] 按钮（批量审核）

#### 2.2 临时事件添加区域

**显示内容：**
- **事件类型选择**：单回合 / 多回合
- **事件内容输入框**
- **有效回合数设置**（多回合事件时显示）
- **多回合事件进度设置**（多回合事件时显示）
  - 初始进度值设置（可选，默认0）
  - 目标进度值设置（默认100）
  - 进度描述输入（可选）
- **[添加事件] 按钮**
- **已添加事件列表**（可删除）

#### 2.3 临时规则添加区域

**显示内容：**
- **规则类型选择**：单回合 / 多回合
- **规则内容输入框**
- **有效回合数设置**（多回合规则时显示）
- **优先级设置**：高 / 中 / 低
- **[添加规则] 按钮**
- **已添加规则列表**（可删除）

#### 2.4 本轮合作事件区域

**显示内容：**
- **达成的合作事件列表**
  - 每个合作事件卡片显示：
    - 合作双方信息（发起方和接收方）
    - 合作类型标签（资源合作/行动合作/策略合作等）
    - 合作内容（完整显示）
    - 合作条件/要求
    - 预期收益说明
    - 达成时间
    - 谈判轮次（如果经过谈判）
- **合作事件编辑功能**
  - [编辑] 按钮：修改合作内容、条件、要求、预期收益等
  - [删除] 按钮：标记为不参与推演
  - 修改说明输入
  - 修改记录显示

#### 2.5 多回合事件进度管理

**显示内容：**
- **活跃的多回合事件列表**
  - 每个事件显示：
    - 事件内容描述
    - 进度条（当前进度/目标进度）
    - 进度百分比
    - 事件状态（进行中/已完成/已失败）
  - [手动更新进度] 按钮（可选）
  - 进度更新历史查看

#### 2.6 操作按钮区域

**显示内容：**
- **[批量审核] 按钮**：批量标记决策为已审核
- **[提交给AI推演] 按钮**：
  - 提交时包含：
    - 所有玩家决策（含选项和自定义文本）
    - 临时事件/规则
    - 本轮合作事件
    - 活跃的多回合事件及其进度
  - 确认对话框
  - 提交后显示处理状态

---

### 3. 右侧面板 - 游戏信息（与玩家界面相同）

**显示内容：**
- 排名面板
- 资源面板
- 任务/目标面板
- 资源交易面板
- 合作申请面板
- **临时事件/规则面板**（仅主持人可见）
  - 当前回合临时事件列表
  - 当前回合临时规则列表
  - 多回合规则列表
  - [添加] 按钮
- 多回合事件进度面板
- 游戏存档面板

---

### 4. 底部面板 - 消息/通知（与玩家界面相同）

**显示内容：**
- 公开声明区域
- 系统消息滚动
- 玩家操作通知
- 决策提交通知
- 交易请求通知
- 任务完成通知
- 多回合事件进度更新通知
- 重要事件提示

---

## 三、界面信息对比总结

### 玩家界面 vs 主持人界面

| 区域 | 玩家界面 | 主持人界面 |
|------|---------|-----------|
| **顶部状态栏** | 相同 | 相同 |
| **左侧面板** | 玩家信息列表 | 玩家信息列表（主持人高亮） |
| **中间面板** | 剧情展示 + 操作输入区 | 审核区域（决策列表 + 事件/规则管理） |
| **右侧面板** | 游戏信息（不含临时事件/规则） | 游戏信息（含临时事件/规则面板） |
| **底部面板** | 消息/通知 | 消息/通知 |

### 关键区别

1. **决策阶段**
   - **玩家**：看到决策选项和输入框，可以提交决策
   - **主持人**：看到所有玩家的决策状态，但无法提交决策（主持人不参与游戏）

2. **审核阶段**
   - **玩家**：看到"审核阶段"提示，等待推演结果
   - **主持人**：看到所有玩家决策详情，可以编辑决策、添加事件/规则、提交给AI推演

3. **推演阶段**
   - **玩家**：看到"推演中"提示，等待结果
   - **主持人**：看到推演进度，等待完成

4. **结果阶段**
   - **玩家**：看到推演结果和剧情
   - **主持人**：看到推演结果和剧情（相同）

---

## 四、特殊功能说明

### 1. 决策选项系统

**玩家视角：**
- 每回合开始时，AI自动生成3个个性化选项
- 选项显示：文本、预期效果、类别标签
- 支持多选（0-3个选项）
- 可与自定义文本组合使用
- 每回合可刷新1次

**主持人视角：**
- 看到玩家选择的选项
- 看到选项组合建议
- 看到组合有效性标识
- 可以编辑玩家的选项和文本

### 2. 成就系统

**玩家视角：**
- 在面板器的个人面板中查看
- 显示已解锁成就列表
- 显示未解锁成就进度（可选）
- 成就解锁时收到通知

**主持人视角：**
- 可以看到所有玩家的成就解锁情况
- 在面板器的群体面板中查看统计

### 3. 大事纪系统

**玩家视角：**
- 在面板器的群体面板中查看
- 时间线视图展示所有大事纪
- 支持筛选和搜索

**主持人视角：**
- 在面板器的群体面板中查看
- 可以看到所有大事纪
- 系统自动记录，主持人可标记重要性

---

## 五、界面状态流转

### 决策阶段 → 审核阶段
- **玩家**：提交决策后，等待所有玩家提交或时限到达
- **主持人**：所有玩家提交后，自动进入审核界面

### 审核阶段 → 推演阶段
- **玩家**：看到"推演中"提示
- **主持人**：点击"提交给AI推演"后，进入推演阶段

### 推演阶段 → 结果阶段
- **玩家**：收到推演结果和剧情
- **主持人**：收到推演结果和剧情（相同）

### 结果阶段 → 下一回合决策阶段
- **玩家**：自动进入下一回合，收到新的决策选项
- **主持人**：自动进入下一回合，等待玩家提交决策

---

## 六、数据实时更新

### WebSocket推送的消息类型

**所有玩家接收：**
- 游戏状态更新
- 玩家决策提交通知
- 决策状态更新
- 公开声明
- 交易请求/状态更新
- 合作申请/状态更新
- 任务更新
- 多回合事件进度更新
- 成就解锁通知
- 大事纪记录通知
- AI剧情推送
- 推演结果

**仅主持人接收：**
- 决策审核相关通知
- 临时事件/规则相关通知

---

## 七、界面响应式设计

### PC端
- 三栏布局：左侧面板 + 中间面板 + 右侧面板
- 所有信息完整显示

### 平板端
- 两栏布局：左侧面板 + 中间/右侧面板（可切换）
- 部分面板可折叠

### 手机端
- 单栏布局：面板可切换显示
- 重要信息优先显示
- 图表简化显示

---

## 八、组件拆分优化说明（架构建议）

### 8.1 组件拆分架构

为了优化渲染性能，避免频繁的Socket更新导致整个页面重绘，建议将游戏主界面拆分为以下独立组件：

#### 8.1.1 GameBoard组件（游戏主面板）
**包含区域**：
- 剧情展示区
- 操作输入区（决策选项区域、决策输入框、提交按钮等）

**特点**：
- 独立的状态管理
- 仅在游戏状态、决策状态变化时更新
- 使用React.memo优化渲染

#### 8.1.2 Sidebar组件（侧边栏）
**包含区域**：
- 左侧面板（玩家信息）
- 右侧面板（游戏信息：排名、资源、决策状态、任务等）

**特点**：
- 独立的状态管理
- 仅在相关数据变化时更新
- 使用React.memo优化渲染
- 支持折叠/展开

#### 8.1.3 状态隔离策略
- **GameBoard状态**：游戏状态、决策状态、剧情内容
- **Sidebar状态**：玩家信息、排名、资源、任务等
- **共享状态**：通过Context或状态管理库（Zustand）共享必要数据
- **Socket更新**：根据消息类型，仅更新相关组件，避免整页重绘

#### 8.1.4 性能优化
- 使用React.memo包装组件，避免不必要的重渲染
- 使用useMemo和useCallback优化计算和函数
- Socket消息处理时，仅更新相关组件的状态
- 实现虚拟滚动（如玩家列表、历史记录等长列表）

---

**文档版本**：v1.1  
**最后更新**：2024年  
**维护者**：开发团队

