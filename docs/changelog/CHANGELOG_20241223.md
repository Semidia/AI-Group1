# ä»£ç ä¿®æ”¹è¯´æ˜ - 2024å¹´12æœˆ23æ—¥

## ç›®å½•
- [æ¦‚è¿°](#æ¦‚è¿°)
æœ¬æ¬¡æ›´æ–°é‡ç‚¹ï¼š
1. å¯åŠ¨è„šæœ¬å…¨è‹±æ–‡åŒ–ï¼Œä¿®å¤ Prisma è¿ç§»å¡é¡¿ï¼ˆéäº¤äº’æ‰§è¡Œï¼‰ã€‚
2. ç®¡ç†å‘˜ç”¨æˆ·åç»Ÿä¸€ä¸ºè‹±æ–‡ `developer`ï¼Œå…¼å®¹æ—§å€¼ã€‚
3. AI æ¨æ¼”ç»“æœå¯è§æ€§ä¼˜åŒ–ï¼šä¸»æŒäºº/ç©å®¶ç«¯è‡ªåŠ¨è·³è½¬ç»“æœé¡µå¹¶æä¾›æ˜¾å¼å…¥å£ã€‚
4. å›åˆæ¨è¿›äº¤äº’ä¼˜åŒ–ï¼šç»“æœé˜¶æ®µå±•ç¤ºå…¥å£ï¼Œä¸»æŒäººæœ‰â€œè¿›å…¥ä¸‹ä¸€å›åˆâ€æŒ‰é’®ï¼›å‰ç«¯ API è§£åŒ…ä¿®å¤é¿å…æ‹¿ç©ºæ•°æ®ã€‚

- [ä¸€ã€å¯åŠ¨è„šæœ¬å›½é™…åŒ–æ”¹é€ ](#ä¸€å¯åŠ¨è„šæœ¬å›½é™…åŒ–æ”¹é€ )
  - [1.1 tools/run-dev.ps1](#11-toolsrun-devps1)
  - [1.2 run-dev.bat](#12-run-devbat)
  - [1.3 rebuild/production/backend/scripts/setup-env.ps1](#13-rebuildproductionbackendscriptsetup-envps1)
- [äºŒã€Prisma è¿ç§»äº¤äº’é—®é¢˜ä¿®å¤](#äºŒprisma-è¿ç§»äº¤äº’é—®é¢˜ä¿®å¤)
  - [2.1 tools/run-dev.ps1 - éäº¤äº’å¼è¿ç§»](#21-toolsrun-devps1---éäº¤äº’å¼è¿ç§»)
- [ä¸‰ã€ç®¡ç†å‘˜ç”¨æˆ·åç»Ÿä¸€ä¸ºè‹±æ–‡](#ä¸‰ç®¡ç†å‘˜ç”¨æˆ·åç»Ÿä¸€ä¸ºè‹±æ–‡)
  - [3.1 åç«¯ä»£ç ä¿®æ”¹](#31-åç«¯ä»£ç ä¿®æ”¹)
  - [3.2 å‰ç«¯ä»£ç ä¿®æ”¹](#32-å‰ç«¯ä»£ç ä¿®æ”¹)
  - [3.3 æµ‹è¯•è„šæœ¬ä¿®æ”¹](#33-æµ‹è¯•è„šæœ¬ä¿®æ”¹)
  - [3.4 é…ç½®æ–‡ä»¶](#34-é…ç½®æ–‡ä»¶)
- [å››ã€ä¿®æ”¹æ–‡ä»¶æ¸…å•](#å››ä¿®æ”¹æ–‡ä»¶æ¸…å•)
- [æ–°å¢ï¼šAI æ¨æ¼”ç»“æœå¯è§æ€§ & å›åˆæ¨è¿›äº¤äº’](#æ–°å¢ai-æ¨æ¼”ç»“æœå¯è§æ€§--å›åˆæ¨è¿›äº¤äº’)
  - [4.1 ç©å®¶ç«¯ï¼ˆæˆ˜åœºé¡µï¼‰è‡ªåŠ¨è·³ç»“æœé¡µ + æ˜¾å¼å…¥å£](#41-ç©å®¶ç«¯æˆ˜åœºé¡µè‡ªåŠ¨è·³ç»“æœé¡µ--æ˜¾å¼å…¥å£)
  - [4.2 ä¸»æŒäººå®¡æ ¸é¡µè‡ªåŠ¨è·³è½¬ç»“æœ/è¿›åº¦](#42-ä¸»æŒäººå®¡æ ¸é¡µè‡ªåŠ¨è·³è½¬ç»“æœè¿›åº¦)
  - [4.3 å‰ç«¯ API å“åº”è§£åŒ…ä¿®å¤](#43-å‰ç«¯-api-å“åº”è§£åŒ…ä¿®å¤)
- [äº”ã€å…¼å®¹æ€§è¯´æ˜](#äº”å…¼å®¹æ€§è¯´æ˜)
  - [5.1 å‘åå…¼å®¹](#51-å‘åå…¼å®¹)
  - [5.2 ç¯å¢ƒå˜é‡](#52-ç¯å¢ƒå˜é‡)
- [å…­ã€ä½¿ç”¨è¯´æ˜](#å…­ä½¿ç”¨è¯´æ˜)
  - [6.1 æ›´æ–°ç°æœ‰ç¯å¢ƒ](#61-æ›´æ–°ç°æœ‰ç¯å¢ƒ)
  - [6.2 å¯åŠ¨é¡¹ç›®](#62-å¯åŠ¨é¡¹ç›®)
  - [6.3 éªŒè¯é…ç½®](#63-éªŒè¯é…ç½®)
- [ä¸ƒã€æŠ€æœ¯ç»†èŠ‚](#ä¸ƒæŠ€æœ¯ç»†èŠ‚)
  - [7.1 Prisma è¿ç§»æ”¹è¿›](#71-prisma-è¿ç§»æ”¹è¿›)
  - [7.2 æ–‡ä»¶ç¼–ç ](#72-æ–‡ä»¶ç¼–ç )
  - [7.3 æ•°æ®åº“æ¸…ç†](#73-æ•°æ®åº“æ¸…ç†)
- [å…«ã€æµ‹è¯•å»ºè®®](#å…«æµ‹è¯•å»ºè®®)
- [ä¹ã€æ³¨æ„äº‹é¡¹](#ä¹æ³¨æ„äº‹é¡¹)
- [åã€DeepSeek API é›†æˆä¸åŠŸèƒ½å¢å¼ºï¼ˆ2024å¹´12æœˆ23æ—¥æ›´æ–°ï¼‰](#ådeepseek-api-é›†æˆä¸åŠŸèƒ½å¢å¼º2024å¹´12æœˆ23æ—¥æ›´æ–°)
  - [10.1 Welcome Room é»˜è®¤é…ç½®æ›´æ–°](#101-welcome-room-é»˜è®¤é…ç½®æ›´æ–°)
  - [10.2 AI API è¿æ¥æµ‹è¯•åŠŸèƒ½](#102-ai-api-è¿æ¥æµ‹è¯•åŠŸèƒ½)
  - [10.3 æˆ¿é—´ç®¡ç†åŠŸèƒ½å¢å¼º](#103-æˆ¿é—´ç®¡ç†åŠŸèƒ½å¢å¼º)
  - [10.4 å‰ç«¯ç•Œé¢ä¿®å¤](#104-å‰ç«¯ç•Œé¢ä¿®å¤)
  - [10.5 API é”™è¯¯å¤„ç†æ”¹è¿›](#105-api-é”™è¯¯å¤„ç†æ”¹è¿›)
  - [10.6 å¯åŠ¨è„šæœ¬ä¿®å¤](#106-å¯åŠ¨è„šæœ¬ä¿®å¤)
- [åä¸€ã€ä¿®æ”¹æ–‡ä»¶æ¸…å•ï¼ˆæœ¬æ¬¡æ›´æ–°ï¼‰](#åä¸€ä¿®æ”¹æ–‡ä»¶æ¸…å•æœ¬æ¬¡æ›´æ–°)
  - [åç«¯ä»£ç ](#åç«¯ä»£ç )
  - [å‰ç«¯ä»£ç ](#å‰ç«¯ä»£ç )
  - [è„šæœ¬æ–‡ä»¶](#è„šæœ¬æ–‡ä»¶)
- [åäºŒã€ä½¿ç”¨è¯´æ˜ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰](#åäºŒä½¿ç”¨è¯´æ˜æ–°å¢åŠŸèƒ½)
  - [12.1 æµ‹è¯• DeepSeek API è¿æ¥](#121-æµ‹è¯•-deepseek-api-è¿æ¥)
  - [12.2 ç»ˆæ­¢è¿›è¡Œä¸­çš„æ¸¸æˆ](#122-ç»ˆæ­¢è¿›è¡Œä¸­çš„æ¸¸æˆ)
  - [12.3 æ£€æŸ¥ API è¿æ¥çŠ¶æ€](#123-æ£€æŸ¥-api-è¿æ¥çŠ¶æ€)

## æ¦‚è¿°



---

## æ–°å¢ï¼šAI æ¨æ¼”ç»“æœå¯è§æ€§ & å›åˆæ¨è¿›äº¤äº’

### 4.1 ç©å®¶ç«¯ï¼ˆæˆ˜åœºé¡µï¼‰è‡ªåŠ¨è·³ç»“æœé¡µ + æ˜¾å¼å…¥å£
**æ–‡ä»¶ï¼š** `rebuild/production/frontend/src/pages/GameSession.tsx`
- åœ¨æ”¶åˆ° `game_state_update` ä¸” `roundStatus === 'result'` æ—¶ï¼Œè‡ªåŠ¨å¯¼èˆªåˆ°æœ¬å›åˆç»“æœé¡µ `/game/{sessionId}/round/{currentRound}/inference`ã€‚
- åœ¨æˆ˜åœºé¡µé¡¶éƒ¨å¢åŠ â€œæŸ¥çœ‹æœ¬å›åˆç»“æœâ€æŒ‰é’®ï¼ˆä»…åœ¨ `roundStatus === 'result'` æ—¶æ˜¾ç¤ºï¼‰ï¼Œç©å®¶å¯æ‰‹åŠ¨è¿›å…¥ç»“æœé¡µã€‚

### 4.2 ä¸»æŒäººå®¡æ ¸é¡µè‡ªåŠ¨è·³è½¬ç»“æœ/è¿›åº¦
**æ–‡ä»¶ï¼š** `rebuild/production/frontend/src/pages/HostReview.tsx`
- æäº¤â€œæäº¤ç»™ AI æ¨æ¼”â€æˆåŠŸåï¼Œè‡ªåŠ¨è·³åˆ°å½“å‰å›åˆçš„ç»“æœ/è¿›åº¦é¡µã€‚
- æ”¶åˆ° `inference_started`ã€`inference_completed` äº‹ä»¶æ—¶ï¼Œè‡ªåŠ¨å¯¼èˆªåˆ°ç»“æœé¡µï¼Œå¹¶æç¤ºçŠ¶æ€ã€‚
- ä¿ç•™åŸæœ‰çš„é˜¶æ®µ/äº‹ä»¶ç›‘å¬åˆ·æ–°é€»è¾‘ã€‚

### 4.3 å‰ç«¯ API å“åº”è§£åŒ…ä¿®å¤
**æ–‡ä»¶ï¼š** `rebuild/production/frontend/src/services/game.ts`
- `getRoundDecisions`ã€`nextRound` æ”¹ä¸ºæŒ‰ `{ code, data }` ç»“æ„è§£åŒ…ï¼Œé¿å…æ‹¿ç©º `response.data.data`ã€‚
- å…¶ä»–æ¥å£è¡Œä¸ºä¸å˜ã€‚

**å½±å“ä¸ä½¿ç”¨ï¼š**
- æ¨æ¼”å®Œæˆåï¼Œä¸»æŒäºº/ç©å®¶éƒ½èƒ½ç¬¬ä¸€æ—¶é—´çœ‹åˆ°ç»“æœé¡µï¼Œä¸å†â€œå¡åœ¨å®¡æ ¸â€æˆ–éœ€è¦æ‰‹åŠ¨æ•² URLã€‚
- ä¸»æŒäººä»éœ€åœ¨ç»“æœé˜¶æ®µç‚¹å‡»â€œè¿›å…¥ä¸‹ä¸€å›åˆâ€æ¨è¿›å›åˆï¼ˆè®¾è®¡ä¿æŒä¸è‡ªåŠ¨åŠ  1ï¼‰ã€‚

---

## ä¸€ã€å¯åŠ¨è„šæœ¬å›½é™…åŒ–æ”¹é€ 

### 1.1 `tools/run-dev.ps1`
**ä¿®æ”¹å†…å®¹ï¼š**
- å°†æ‰€æœ‰ä¸­æ–‡æ³¨é‡Šæ”¹ä¸ºè‹±æ–‡
- å°†æ‰€æœ‰è¾“å‡ºæ¶ˆæ¯æ”¹ä¸ºè‹±æ–‡
- ç§»é™¤äº†æ‰€æœ‰ Emoji è¡¨æƒ…ç¬¦å·ï¼ˆğŸš¨ã€âœ… ç­‰ï¼‰
- æ”¹è¿›äº† Docker å®¹å™¨å¯åŠ¨å’Œæ•°æ®åº“å°±ç»ªæ£€æµ‹é€»è¾‘
- æ·»åŠ äº†æ›´è¯¦ç»†çš„æ­¥éª¤åˆ’åˆ†ï¼ˆ1/7 åˆ° 7/7ï¼‰
- æ·»åŠ äº†å®Œæ•´çš„æµ‹è¯•è´¦å·ä¿¡æ¯æ˜¾ç¤º

**ä¸»è¦æ”¹è¿›ï¼š**
- æ·»åŠ äº† Node.js ç¯å¢ƒæ£€æŸ¥
- æ”¹è¿›äº† Docker æœåŠ¡å¯åŠ¨é€»è¾‘ï¼ˆæ”¯æŒ `docker compose` å’Œ `docker-compose`ï¼‰
- ä½¿ç”¨ `npm run check:db` ç­‰å¾…æ•°æ®åº“å°±ç»ªï¼ˆæœ€å¤š 60 ç§’ï¼‰
- åˆ†ç¦»äº† seed æ­¥éª¤ï¼Œä¾¿äºæŸ¥çœ‹è¿›åº¦
- æ·»åŠ äº†é»˜è®¤æµ‹è¯•è´¦å·ä¿¡æ¯æ˜¾ç¤º

### 1.2 `run-dev.bat`
**ä¿®æ”¹å†…å®¹ï¼š**
- ç®€åŒ–äº†æ‰¹å¤„ç†æ–‡ä»¶
- ç›´æ¥è°ƒç”¨ PowerShell è„šæœ¬ï¼Œè‡ªåŠ¨ç»•è¿‡æ‰§è¡Œç­–ç•¥
- ç§»é™¤äº†ä¸­æ–‡æ ‡é¢˜å’Œæ¶ˆæ¯

### 1.3 `rebuild/production/backend/scripts/setup-env.ps1`
**ä¿®æ”¹å†…å®¹ï¼š**
- å°†æ‰€æœ‰ä¸­æ–‡æ³¨é‡Šæ”¹ä¸ºè‹±æ–‡
- å°†æ‰€æœ‰è¾“å‡ºæ¶ˆæ¯æ”¹ä¸ºè‹±æ–‡
- ç§»é™¤äº†æ‰€æœ‰ Emoji è¡¨æƒ…ç¬¦å·ï¼ˆâœ“ã€âš  ç­‰ï¼‰
- æ”¹è¿›äº† `.env` æ–‡ä»¶å†™å…¥é€»è¾‘ï¼Œç¡®ä¿æ­£ç¡®çš„ç¼–ç å’Œæ¢è¡Œç¬¦
- æ·»åŠ äº† `.env` æ–‡ä»¶æ ¼å¼éªŒè¯

**æŠ€æœ¯æ”¹è¿›ï¼š**
- ä½¿ç”¨ UTF-8 without BOM ç¼–ç å†™å…¥æ–‡ä»¶
- è§„èŒƒåŒ–æ¢è¡Œç¬¦ä¸º CRLFï¼ˆWindows å…¼å®¹ï¼‰
- æ·»åŠ äº†æ–‡ä»¶æ ¼å¼éªŒè¯å’Œè­¦å‘Š

---

## äºŒã€Prisma è¿ç§»äº¤äº’é—®é¢˜ä¿®å¤

### 2.1 `tools/run-dev.ps1` - éäº¤äº’å¼è¿ç§»
**é—®é¢˜ï¼š**
- `prisma migrate dev` å‘½ä»¤åœ¨æ‰¹å¤„ç†è„šæœ¬ä¸­ä¼šæç¤ºç”¨æˆ·è¾“å…¥è¿ç§»åç§°ï¼ˆy/Nï¼‰ï¼Œå¯¼è‡´è„šæœ¬å¡ä½

**è§£å†³æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ `--name` å‚æ•°è‡ªåŠ¨ç”Ÿæˆè¿ç§»åç§°ï¼ˆæ—¶é—´æˆ³æ ¼å¼ï¼‰
- æ·»åŠ  `--skip-seed` å’Œ `--skip-generate` é¿å…é¢å¤–äº¤äº’
- æ·»åŠ å›é€€æœºåˆ¶ï¼šå¦‚æœ `migrate dev` å¤±è´¥ï¼Œè‡ªåŠ¨ä½¿ç”¨ `migrate deploy`

**ä¿®æ”¹ä½ç½®ï¼š**
```powershell
# ç¬¬ 219-229 è¡Œ
Write-Host "Running: Prisma migration (non-interactive)..." -ForegroundColor Yellow
$migrationName = "auto_migration_$(Get-Date -Format 'yyyyMMdd_HHmmss')"
npx prisma migrate dev --name $migrationName --skip-seed --skip-generate

if ($LASTEXITCODE -ne 0) {
    Write-Host "No new migrations needed, applying existing migrations..." -ForegroundColor DarkGray
    npx prisma migrate deploy
}
```

---

## ä¸‰ã€ç®¡ç†å‘˜ç”¨æˆ·åç»Ÿä¸€ä¸ºè‹±æ–‡

### 3.1 åç«¯ä»£ç ä¿®æ”¹

#### `rebuild/production/backend/src/routes/admin.ts`
**ä¿®æ”¹å‰ï¼š**
```typescript
const adminUsername = process.env.ADMIN_USERNAME || 'å¼€å‘è€…è´¦å·';
```

**ä¿®æ”¹åï¼š**
```typescript
const adminUsername = process.env.ADMIN_USERNAME || 'developer';
```

**å…¼å®¹æ€§ï¼š**
- ä¿ç•™äº†å¯¹ `'å¼€å‘è€…è´¦å·'` çš„æ”¯æŒï¼ˆç”¨äºæ—§æ•°æ®å…¼å®¹ï¼‰
- æ”¯æŒåˆ—è¡¨ï¼šç¯å¢ƒå˜é‡å€¼ã€`'developer'`ã€`'å¼€å‘è€…è´¦å·'`

### 3.2 å‰ç«¯ä»£ç ä¿®æ”¹

#### `rebuild/production/frontend/src/components/UserRegistryPanel.tsx`
**ä¿®æ”¹å‰ï¼š**
```typescript
const adminUsername = import.meta.env.VITE_ADMIN_USERNAME || 'å¼€å‘è€…è´¦å·';
```

**ä¿®æ”¹åï¼š**
```typescript
const adminUsername = import.meta.env.VITE_ADMIN_USERNAME || 'developer';
```

#### `rebuild/production/frontend/src/components/OnlineRoomsPanel.tsx`
**ä¿®æ”¹å‰ï¼š**
```typescript
const adminUsername = import.meta.env.VITE_ADMIN_USERNAME || 'å¼€å‘è€…è´¦å·';
```

**ä¿®æ”¹åï¼š**
```typescript
const adminUsername = import.meta.env.VITE_ADMIN_USERNAME || 'developer';
```

### 3.3 æµ‹è¯•è„šæœ¬ä¿®æ”¹

#### `rebuild/test-phases/phase6-tests/test-phase6.ps1`
**ä¿®æ”¹å†…å®¹ï¼š**
- ç§»é™¤äº† UTF-8 å­—èŠ‚æ•°ç»„çš„å¤æ‚é€»è¾‘
- é»˜è®¤å€¼ä»ä¸­æ–‡ `'å¼€å‘è€…è´¦å·'` æ”¹ä¸º `'developer'`
- ç®€åŒ–äº†ä»£ç é€»è¾‘

**ä¿®æ”¹å‰ï¼š**
```powershell
$usernameBytes = [byte[]](0xE5,0xBC,0x80,0xE5,0x8F,0x91,0xE8,0x80,0x85,0xE8,0xB4,0xA6,0xE5,0x8F,0xB7)
$adminUsername = [System.Text.Encoding]::UTF8.GetString($usernameBytes)
```

**ä¿®æ”¹åï¼š**
```powershell
$adminUsername = 'developer'
```

#### `rebuild/test-phases/common-tests/test-phase1-6.ps1`
**ä¿®æ”¹å†…å®¹ï¼š**
- ç§»é™¤äº† UTF-8 å­—èŠ‚æ•°ç»„çš„å¤æ‚é€»è¾‘
- é»˜è®¤å€¼ä»ä¸­æ–‡æ”¹ä¸º `'developer'`

### 3.4 é…ç½®æ–‡ä»¶

#### `rebuild/production/backend/scripts/setup-env.ps1`
**çŠ¶æ€ï¼š**
- å·²ç»æ˜¯ `ADMIN_USERNAME="developer"`ï¼Œæ— éœ€ä¿®æ”¹

---

## å››ã€ä¿®æ”¹æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒè„šæœ¬æ–‡ä»¶
1. âœ… `tools/run-dev.ps1` - å¯åŠ¨è„šæœ¬ï¼ˆå›½é™…åŒ– + è¿ç§»ä¿®å¤ï¼‰
2. âœ… `run-dev.bat` - æ‰¹å¤„ç†å¯åŠ¨å™¨ï¼ˆç®€åŒ–ï¼‰
3. âœ… `rebuild/production/backend/scripts/setup-env.ps1` - ç¯å¢ƒé…ç½®è„šæœ¬ï¼ˆå›½é™…åŒ–ï¼‰

### åç«¯ä»£ç 
4. âœ… `rebuild/production/backend/src/routes/admin.ts` - ç®¡ç†å‘˜è·¯ç”±ï¼ˆç”¨æˆ·åç»Ÿä¸€ï¼‰
5. âœ… `rebuild/production/backend/src/server.ts` - æœåŠ¡å™¨å¯åŠ¨ï¼ˆå·²ä¸ºè‹±æ–‡ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
6. âœ… `rebuild/production/backend/scripts/seed.ts` - ç§å­æ•°æ®è„šæœ¬ï¼ˆå·²ä¸ºè‹±æ–‡ï¼Œæ— éœ€ä¿®æ”¹ï¼‰

### å‰ç«¯ä»£ç 
7. âœ… `rebuild/production/frontend/src/components/UserRegistryPanel.tsx` - ç”¨æˆ·æ³¨å†Œé¢æ¿ï¼ˆç”¨æˆ·åç»Ÿä¸€ï¼‰
8. âœ… `rebuild/production/frontend/src/components/OnlineRoomsPanel.tsx` - åœ¨çº¿æˆ¿é—´é¢æ¿ï¼ˆç”¨æˆ·åç»Ÿä¸€ï¼‰

### æµ‹è¯•è„šæœ¬
9. âœ… `rebuild/test-phases/phase6-tests/test-phase6.ps1` - ç¬¬å…­é˜¶æ®µæµ‹è¯•ï¼ˆç”¨æˆ·åç»Ÿä¸€ï¼‰
10. âœ… `rebuild/test-phases/common-tests/test-phase1-6.ps1` - è”åˆæµ‹è¯•è„šæœ¬ï¼ˆç”¨æˆ·åç»Ÿä¸€ï¼‰

---

## äº”ã€å…¼å®¹æ€§è¯´æ˜

### 5.1 å‘åå…¼å®¹
- ä»£ç ä¸­ä»ä¿ç•™å¯¹ `'å¼€å‘è€…è´¦å·'` çš„æ”¯æŒï¼ˆåœ¨å…¼å®¹æ€§åˆ—è¡¨ä¸­ï¼‰
- è¿™æ˜¯ä¸ºäº†æ”¯æŒå¯èƒ½å­˜åœ¨çš„æ—§æ•°æ®
- æ–°çš„é»˜è®¤å€¼ç»Ÿä¸€ä¸ºè‹±æ–‡ `'developer'`

### 5.2 ç¯å¢ƒå˜é‡
- `.env` æ–‡ä»¶ä¸­çš„ `ADMIN_USERNAME` åº”è®¾ç½®ä¸º `"developer"`
- å¦‚æœæœªè®¾ç½®ï¼Œä»£ç ä¼šä½¿ç”¨é»˜è®¤å€¼ `'developer'`
- å¦‚æœè®¾ç½®ä¸ºå…¶ä»–å€¼ï¼ˆå¦‚ `"å¼€å‘è€…è´¦å·"`ï¼‰ï¼Œç³»ç»Ÿä»ä¼šè¯†åˆ«ï¼Œä½†å»ºè®®ç»Ÿä¸€ä¸º `"developer"`

---

## å…­ã€ä½¿ç”¨è¯´æ˜

### 6.1 æ›´æ–°ç°æœ‰ç¯å¢ƒ
å¦‚æœç°æœ‰ `.env` æ–‡ä»¶ä¸­çš„ `ADMIN_USERNAME` æ˜¯ä¸­æ–‡ï¼Œéœ€è¦æ›´æ–°ï¼š

```powershell
cd rebuild\production\backend
# æ–¹æ³•1ï¼šæ‰‹åŠ¨ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå°† ADMIN_USERNAME æ”¹ä¸º "developer"
# æ–¹æ³•2ï¼šé‡æ–°ç”Ÿæˆ .env æ–‡ä»¶
Remove-Item .env -Force
powershell -ExecutionPolicy Bypass -File .\scripts\setup-env.ps1
```

### 6.2 å¯åŠ¨é¡¹ç›®
```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•
.\run-dev.bat
```

### 6.3 éªŒè¯é…ç½®
å¯åŠ¨åï¼Œä½¿ç”¨ä»¥ä¸‹è´¦å·ç™»å½•éªŒè¯ï¼š
- **å¼€å‘è€…è´¦å·**: `developer` / `000000`

---

## ä¸ƒã€æŠ€æœ¯ç»†èŠ‚

### 7.1 Prisma è¿ç§»æ”¹è¿›
- **é—®é¢˜**: `prisma migrate dev` åœ¨æ‰¹å¤„ç†ä¸­ä¼šå¡ä½ç­‰å¾…ç”¨æˆ·è¾“å…¥
- **è§£å†³**: ä½¿ç”¨ `--name` å‚æ•°è‡ªåŠ¨ç”Ÿæˆè¿ç§»åç§°
- **æ ¼å¼**: `auto_migration_YYYYMMDD_HHmmss`

### 7.2 æ–‡ä»¶ç¼–ç 
- æ‰€æœ‰ PowerShell è„šæœ¬ä½¿ç”¨ UTF-8 without BOM ç¼–ç 
- `.env` æ–‡ä»¶ä½¿ç”¨ UTF-8 without BOM ç¼–ç 
- æ¢è¡Œç¬¦ç»Ÿä¸€ä¸º CRLFï¼ˆWindows å…¼å®¹ï¼‰

### 7.3 æ•°æ®åº“æ¸…ç†
- å¯åŠ¨è„šæœ¬**ä¸åŒ…å«**è‡ªåŠ¨æ¸…ç†æ•°æ®åº“çš„åŠŸèƒ½
- å¦‚éœ€æ¸…ç†ï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œï¼š
  ```powershell
  docker-compose down
  Remove-Item -Recurse -Force .\data\postgres
  docker-compose up -d postgres
  ```

---

## å…«ã€æµ‹è¯•å»ºè®®

1. **éªŒè¯å¯åŠ¨è„šæœ¬**ï¼šè¿è¡Œ `run-dev.bat`ï¼Œç¡®ä¿æ‰€æœ‰æ­¥éª¤æ­£å¸¸å®Œæˆ
2. **éªŒè¯æ•°æ®åº“è¿ç§»**ï¼šç¡®ä¿è¿ç§»è¿‡ç¨‹ä¸ä¼šå¡ä½
3. **éªŒè¯ç®¡ç†å‘˜ç™»å½•**ï¼šä½¿ç”¨ `developer / 000000` ç™»å½•
4. **éªŒè¯æƒé™**ï¼šç¡®è®¤ç®¡ç†å‘˜æƒé™æ­£å¸¸å·¥ä½œ

---

## ä¹ã€æ³¨æ„äº‹é¡¹

1. âš ï¸ å¦‚æœç°æœ‰æ•°æ®åº“ä¸­æœ‰ä½¿ç”¨ `'å¼€å‘è€…è´¦å·'` ä½œä¸ºç”¨æˆ·åçš„æ•°æ®ï¼Œç³»ç»Ÿä»ä¼šè¯†åˆ«ï¼ˆå…¼å®¹æ€§æ”¯æŒï¼‰
2. âš ï¸ æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·å°†ä½¿ç”¨ `'developer'` ä½œä¸ºç”¨æˆ·å
3. âš ï¸ å¦‚æœ `.env` æ–‡ä»¶ä¸­ `ADMIN_USERNAME` æ˜¯ä¸­æ–‡ï¼Œå»ºè®®æ›´æ–°ä¸º `"developer"`
4. âœ… æ‰€æœ‰ä»£ç å’Œé…ç½®å·²ç»Ÿä¸€ä¸ºè‹±æ–‡ï¼Œç¬¦åˆé¡¹ç›®è§„èŒƒ

---

---

## åã€DeepSeek API é›†æˆä¸åŠŸèƒ½å¢å¼ºï¼ˆ2024å¹´12æœˆ23æ—¥æ›´æ–°ï¼‰

### 10.1 Welcome Room é»˜è®¤é…ç½®æ›´æ–°

#### `rebuild/production/backend/scripts/seed.ts`
**ä¿®æ”¹å†…å®¹ï¼š**
- å°† Welcome Room çš„é»˜è®¤ AI API é…ç½®ä» OpenAI æ”¹ä¸º DeepSeek
- æ›´æ–°äº† API ç«¯ç‚¹ã€Headers å’Œ Body æ¨¡æ¿é…ç½®

**ä¿®æ”¹è¯¦æƒ…ï¼š**
- **æœåŠ¡æä¾›å•†**: `openai` â†’ `deepseek`
- **API Endpoint**: `https://api.openai.com/v1/chat/completions` â†’ `https://api.deepseek.com/v1/chat/completions`
- **Headers**: æ·»åŠ äº† `Content-Type: application/json`
- **Body æ¨¡æ¿**: 
  - æ¨¡å‹ä» `gpt-3.5-turbo` æ”¹ä¸º `deepseek-chat`
  - æ·»åŠ äº† `max_tokens: 2000` å‚æ•°
  - ä½¿ç”¨ `{{prompt}}` å ä½ç¬¦æ›¿æ¢æœºåˆ¶

### 10.2 AI API è¿æ¥æµ‹è¯•åŠŸèƒ½

#### æ–°å¢åç«¯æµ‹è¯•ç«¯ç‚¹
**æ–‡ä»¶**: `rebuild/production/backend/src/routes/test.ts`
**æ–°å¢ç«¯ç‚¹**: `POST /api/test/ai`

**åŠŸèƒ½ï¼š**
- æ”¯æŒé€šè¿‡æˆ¿é—´IDæµ‹è¯• API é…ç½®
- æ”¯æŒç›´æ¥æä¾› API é…ç½®è¿›è¡Œæµ‹è¯•
- è¯¦ç»†çš„é”™è¯¯åˆ†æå’Œæç¤ºï¼ˆ401ã€404ã€è¿æ¥å¤±è´¥ã€è¶…æ—¶ç­‰ï¼‰
- è¿”å›è¿æ¥çŠ¶æ€ã€å“åº”æ—¶é—´ã€é”™è¯¯ç±»å‹ç­‰ä¿¡æ¯

**ä½¿ç”¨æ–¹å¼ï¼š**
```json
// æ–¹å¼1: ä½¿ç”¨æˆ¿é—´ID
POST /api/test/ai
{
  "roomId": "æˆ¿é—´ID"
}

// æ–¹å¼2: ç›´æ¥æä¾›é…ç½®
POST /api/test/ai
{
  "apiProvider": "deepseek",
  "apiEndpoint": "https://api.deepseek.com/v1/chat/completions",
  "apiHeaders": {
    "Authorization": "Bearer YOUR_API_KEY"
  }
}
```

#### æ–°å¢æµ‹è¯•è„šæœ¬
**æ–‡ä»¶**: `rebuild/production/backend/scripts/test-deepseek-api.ps1`

**åŠŸèƒ½ï¼š**
- ä¸€é”®æµ‹è¯• DeepSeek API è¿æ¥
- æ”¯æŒé€šè¿‡æˆ¿é—´IDæˆ–ç›´æ¥æä¾›API Keyæµ‹è¯•
- è¯¦ç»†çš„é”™è¯¯è¯Šæ–­å’Œæç¤º
- å…¨è‹±æ–‡è¾“å‡ºï¼Œé¿å…ç¼–ç é—®é¢˜

**ä½¿ç”¨æ–¹å¼ï¼š**
```powershell
# ä½¿ç”¨ API Key æµ‹è¯•
.\test-deepseek-api.ps1 -ApiKey "ä½ çš„APIå¯†é’¥"

# ä½¿ç”¨æˆ¿é—´IDæµ‹è¯•
.\test-deepseek-api.ps1 -RoomId "æˆ¿é—´ID"
```

### 10.3 æˆ¿é—´ç®¡ç†åŠŸèƒ½å¢å¼º

#### æ–°å¢"ç»ˆæ­¢æ¸¸æˆ"åŠŸèƒ½
**åç«¯æ–‡ä»¶**: `rebuild/production/backend/src/routes/rooms.ts`
**æ–°å¢ç«¯ç‚¹**: `POST /api/rooms/:roomId/kill-game`

**åŠŸèƒ½ï¼š**
- ä»…æˆ¿ä¸»å¯æ“ä½œ
- ä»…å¯¹è¿›è¡Œä¸­çš„æˆ¿é—´ï¼ˆ`status === 'playing'`ï¼‰ç”Ÿæ•ˆ
- ç»ˆæ­¢æ¸¸æˆä¼šè¯ï¼Œå°†æˆ¿é—´çŠ¶æ€æ”¹å› `waiting`
- æ¸…ç† Redis ä¸­çš„æ¨æ¼”ä»»åŠ¡å’Œç»“æœ
- é€šè¿‡ WebSocket å¹¿æ’­æ¸¸æˆç»ˆæ­¢é€šçŸ¥

**å‰ç«¯æ–‡ä»¶**: 
- `rebuild/production/frontend/src/components/RoomCard.tsx` - æ·»åŠ "ç»ˆæ­¢æ¸¸æˆ"æŒ‰é’®
- `rebuild/production/frontend/src/pages/Rooms.tsx` - æ·»åŠ å¤„ç†å‡½æ•°
- `rebuild/production/frontend/src/services/rooms.ts` - æ·»åŠ  API è°ƒç”¨æ–¹æ³•

**UI æ”¹è¿›ï¼š**
- åœ¨æˆ¿é—´å¡ç‰‡ä¸Šï¼Œå½“æˆ¿é—´çŠ¶æ€ä¸º"è¿›è¡Œä¸­"ä¸”å½“å‰ç”¨æˆ·æ˜¯æˆ¿ä¸»æ—¶ï¼Œæ˜¾ç¤ºçº¢è‰²çš„"ç»ˆæ­¢æ¸¸æˆ"æŒ‰é’®
- éè¿›è¡Œä¸­çŠ¶æ€æ—¶ï¼Œæ˜¾ç¤º"å…³é—­"æŒ‰é’®

### 10.4 å‰ç«¯ç•Œé¢ä¿®å¤

#### ç§»é™¤ç¡¬ç¼–ç çš„å¤§äº‹çºªæ•°æ®
**æ–‡ä»¶**: `rebuild/production/frontend/src/pages/GameSession.tsx`

**ä¿®æ”¹å†…å®¹ï¼š**
- ç§»é™¤äº†ç¡¬ç¼–ç çš„ç¤ºä¾‹äº‹ä»¶ï¼ˆ"ç©å®¶1å‘èµ·äº†å…¨å‘˜èµ„æºç½®æ¢åè®®"ã€"AIç”Ÿæˆäº†ç¬¬ä¸€ä¸ªçªå‘äº‹ä»¶ï¼šç”µç£è„‰å†²"ï¼‰
- æ”¹ä¸ºæ˜¾ç¤º"æš‚æ— å¤§äº‹çºªè®°å½•"çš„ç©ºçŠ¶æ€
- é¿å…ç”¨æˆ·çœ‹åˆ°è™šå‡çš„æ¸¸æˆæ•°æ®

### 10.5 API é”™è¯¯å¤„ç†æ”¹è¿›

#### åç«¯é”™è¯¯å¤„ç†å¢å¼º
**æ–‡ä»¶**: `rebuild/production/backend/src/services/aiService.ts`

**æ”¹è¿›å†…å®¹ï¼š**
- è¯¦ç»†çš„é”™è¯¯ç±»å‹è¯†åˆ«ï¼ˆ401è®¤è¯å¤±è´¥ã€404ç«¯ç‚¹ä¸å­˜åœ¨ã€è¿æ¥å¤±è´¥ã€è¶…æ—¶ç­‰ï¼‰
- æ›´å‹å¥½çš„é”™è¯¯æ¶ˆæ¯æç¤º
- è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ï¼ˆåŒ…å« endpointã€é”™è¯¯ç ã€çŠ¶æ€ç ï¼‰

**æ–‡ä»¶**: `rebuild/production/backend/src/routes/game.ts`

**æ”¹è¿›å†…å®¹ï¼š**
- æ”¹è¿› `inference_failed` äº‹ä»¶ï¼ŒåŒ…å«æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- é’ˆå¯¹ä¸åŒé”™è¯¯ç±»å‹æä¾›å…·ä½“çš„è§£å†³å»ºè®®

#### å‰ç«¯é”™è¯¯æç¤ºå¢å¼º
**æ–‡ä»¶**: `rebuild/production/frontend/src/hooks/useMessageRouter.ts`

**æ–°å¢åŠŸèƒ½ï¼š**
- æ·»åŠ  `inference_failed` äº‹ä»¶ç›‘å¬
- æ˜¾ç¤ºæ¨æ¼”å¤±è´¥çš„é”™è¯¯æ¶ˆæ¯
- é’ˆå¯¹ API è¿æ¥é”™è¯¯æä¾›é…ç½®æ£€æŸ¥æç¤º

**æ–‡ä»¶**: `rebuild/production/frontend/src/pages/InferenceResult.tsx`

**æ”¹è¿›å†…å®¹ï¼š**
- æ·»åŠ æ¨æ¼”å¤±è´¥çŠ¶æ€çš„æ˜¾ç¤º
- æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®
- å½“ API è¿æ¥å¤±è´¥æ—¶ï¼Œæç¤ºæ£€æŸ¥ API é…ç½®

### 10.6 å¯åŠ¨è„šæœ¬ä¿®å¤

#### `run-dev.bat` æ”¹è¿›
**æ–‡ä»¶**: `run-dev.bat`

**æ”¹è¿›å†…å®¹ï¼š**
- æ·»åŠ äº†è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è¾“å‡º
- æ”¹è¿›äº† PowerShell è„šæœ¬æ‰§è¡Œæ–¹å¼
- æ·»åŠ äº†æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥
- æ›´å‹å¥½çš„é”™è¯¯æç¤ºä¿¡æ¯

**æ–°å¢æ–‡ä»¶**: `run-dev-simple.bat`
- ç®€åŒ–ç‰ˆæœ¬çš„å¯åŠ¨è„šæœ¬ï¼Œä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ

---

## åä¸€ã€ä¿®æ”¹æ–‡ä»¶æ¸…å•ï¼ˆæœ¬æ¬¡æ›´æ–°ï¼‰

### åç«¯ä»£ç 
1. âœ… `rebuild/production/backend/scripts/seed.ts` - Welcome Room é»˜è®¤é…ç½®æ”¹ä¸º DeepSeek
2. âœ… `rebuild/production/backend/src/routes/test.ts` - æ–°å¢ AI API æµ‹è¯•ç«¯ç‚¹
3. âœ… `rebuild/production/backend/src/routes/rooms.ts` - æ–°å¢ç»ˆæ­¢æ¸¸æˆåŠŸèƒ½
4. âœ… `rebuild/production/backend/src/services/aiService.ts` - æ”¹è¿›é”™è¯¯å¤„ç†
5. âœ… `rebuild/production/backend/src/routes/game.ts` - æ”¹è¿›é”™è¯¯å¹¿æ’­

### å‰ç«¯ä»£ç 
6. âœ… `rebuild/production/frontend/src/components/RoomCard.tsx` - æ·»åŠ ç»ˆæ­¢æ¸¸æˆæŒ‰é’®
7. âœ… `rebuild/production/frontend/src/pages/Rooms.tsx` - æ·»åŠ ç»ˆæ­¢æ¸¸æˆå¤„ç†
8. âœ… `rebuild/production/frontend/src/services/rooms.ts` - æ·»åŠ  killGame API æ–¹æ³•
9. âœ… `rebuild/production/frontend/src/pages/GameSession.tsx` - ç§»é™¤ç¡¬ç¼–ç å¤§äº‹çºª
10. âœ… `rebuild/production/frontend/src/pages/InferenceResult.tsx` - æ·»åŠ å¤±è´¥çŠ¶æ€æ˜¾ç¤º
11. âœ… `rebuild/production/frontend/src/hooks/useMessageRouter.ts` - æ·»åŠ å¤±è´¥äº‹ä»¶ç›‘å¬

### è„šæœ¬æ–‡ä»¶
12. âœ… `rebuild/production/backend/scripts/test-deepseek-api.ps1` - DeepSeek API æµ‹è¯•è„šæœ¬ï¼ˆæ–°å»ºï¼‰
13. âœ… `rebuild/production/backend/scripts/README-test-deepseek.md` - æµ‹è¯•è„šæœ¬è¯´æ˜æ–‡æ¡£ï¼ˆæ–°å»ºï¼‰
14. âœ… `run-dev.bat` - å¯åŠ¨è„šæœ¬é”™è¯¯å¤„ç†æ”¹è¿›
15. âœ… `run-dev-simple.bat` - ç®€åŒ–ç‰ˆå¯åŠ¨è„šæœ¬ï¼ˆæ–°å»ºï¼‰

---

## åäºŒã€ä½¿ç”¨è¯´æ˜ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰

### 12.1 æµ‹è¯• DeepSeek API è¿æ¥

```powershell
cd rebuild\production\backend\scripts
.\test-deepseek-api.ps1 -ApiKey "ä½ çš„DeepSeek_APIå¯†é’¥"
```

### 12.2 ç»ˆæ­¢è¿›è¡Œä¸­çš„æ¸¸æˆ

åœ¨æˆ¿é—´å¡ç‰‡è§†å›¾ç•Œé¢ï¼š
1. æ‰¾åˆ°çŠ¶æ€ä¸º"è¿›è¡Œä¸­"çš„æˆ¿é—´
2. å¦‚æœå½“å‰ç”¨æˆ·æ˜¯æˆ¿ä¸»ï¼Œä¼šæ˜¾ç¤º"ç»ˆæ­¢æ¸¸æˆ"æŒ‰é’®
3. ç‚¹å‡»æŒ‰é’®å³å¯å¼ºåˆ¶ç»ˆæ­¢æ¸¸æˆï¼Œæˆ¿é—´çŠ¶æ€æ”¹å›"ç­‰å¾…ä¸­"

### 12.3 æ£€æŸ¥ API è¿æ¥çŠ¶æ€

å¦‚æœæ¨æ¼”å¤±è´¥ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š
- **APIå¯†é’¥æ— æ•ˆ**: æç¤ºæ£€æŸ¥ Authorization å¤´é…ç½®
- **APIç«¯ç‚¹ä¸å­˜åœ¨**: æç¤ºæ£€æŸ¥ endpoint é…ç½®
- **è¿æ¥å¤±è´¥**: æç¤ºæ£€æŸ¥ç½‘ç»œå’Œ endpoint åœ°å€
- **è¶…æ—¶**: æç¤ºæ£€æŸ¥ç½‘ç»œè¿æ¥é€Ÿåº¦

---

**ä¿®æ”¹æ—¥æœŸ**: 2024å¹´12æœˆ23æ—¥  
**ä¿®æ”¹äººå‘˜**: AI Assistant  
**ç‰ˆæœ¬**: v1.1


