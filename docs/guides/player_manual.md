# 🎮 玩家操作手册

欢迎来到 **《凡墙皆是门》**！这是一款基于大语言模型的多人联机商业博弈游戏，你将与其他玩家在动态演变的商业场景中进行竞争与合作。

---

## 📋 目录

1. [快速入门](#1-快速入门)
2. [游戏流程](#2-游戏流程)
3. [界面说明](#3-界面说明)
4. [规则系统](#4-规则系统)
5. [财务系统](#5-财务系统)
6. [决策指南](#6-决策指南)
7. [常见问题](#7-常见问题)

---

## 1. 快速入门

### 1.1 获取游戏地址

游戏地址由主持人提供，通常有两种情况：

**本机访问**（主持人自己）：
- 直接访问 `http://localhost:5173`

**局域网访问**（其他玩家）：
- 主持人运行 `run-dev.bat` 后，控制台会显示局域网地址
- 例如：`http://192.168.1.100:5173`
- 确保你的电脑和主持人在同一局域网内

### 1.2 注册与登录

1. 打开游戏网址（主持人提供的局域网地址，如 `http://192.168.1.100:5173`）。
2. 点击 **"去注册"** 或直接访问注册页面（`/register`）。
3. **极简注册**：仅需输入 **用户名** 和 **密码** 即可完成注册。
   - 用户名：3-50 个字符。
   - 密码：至少 6 个字符。
   - **注意**：为了简化流程，系统不再需要邮箱验证。
4. 注册成功后自动登录，或使用账号密码在登录页面（`/login`）完成登录。

### 1.2 加入房间

1. 登录后进入 **游戏大厅**（`/rooms`）
2. 找到主持人告知的房间，点击 **"加入"**
3. 如有密码，输入主持人提供的密码
4. 进入 **等候大厅**，等待游戏开始

---

## 2. 游戏流程

游戏按 **回合制** 进行，每回合代表 **半年（6个月）**。

### 🔵 决策阶段

**你需要做的**：

1. **查看当前局势**：
   - 左侧显示上一回合的推演结果
   - 顶部状态栏显示你的资金和属性
   - 规则状态栏显示当前生效的卦象和规则修正

2. **提交决策**：
   - 在输入框中描述你的行动计划
   - 可以自由输入，例如：
     - "扩大市场份额，投入 50000 元广告"
     - "研发新产品，提升创新能力"
     - "与主体 B 协商合作"
   - 点击 **"提交决策"**

3. **注意事项**：
   - 决策时限内可以修改
   - 注意查看现金流警告
   - 参考 AI 提供的策略选项

### 🟡 审核阶段

- 主持人审核所有玩家决策
- 此时无法修改，请等待
- 如果主持人修改了你的决策，会看到修改说明

### 🟢 推演阶段

- AI 正在计算结果
- 页面会显示推演进度
- **请稍候，不要刷新页面**

### 🟣 结果阶段

**查看推演结果**：
- 剧情叙述（打字机效果展示）
- 你的资金和属性变化
- 排行榜更新
- 本回合发生的事件
- 下回合策略选项

---

## 3. 界面说明

### 3.1 规则状态栏

位于游戏界面顶部，显示当前生效的规则修正：

| 图标 | 含义 |
|------|------|
| ✨ 绿色标签 | 增益效果（Buff），对你有利 |
| ⚠️ 红色标签 | 减益效果（Debuff），需要注意 |
| ⚖️ 灰色标签 | 中性效果 |
| 🔮 卦象标签 | 当前年度卦象及其影响 |

**点击标签可查看详细说明**。

### 3.2 财务面板

显示你的主体财务状况：

| 项目 | 说明 |
|------|------|
| 现金 | 当前可用资金，低于 0 则破产 |
| 被动收入 | 每回合自动获得的收入（如稳健业务收入） |
| 被动支出 | 每回合自动扣除的支出（如固定成本、薪资） |
| 净现金流 | 被动收入 - 被动支出，正数表示盈利 |

### 3.3 属性面板

| 属性 | 说明 |
|------|------|
| 市场份额 | 你在市场中的占比（0-100%） |
| 品牌声誉 | 品牌知名度和美誉度（0-100） |
| 创新能力 | 研发和创新水平（0-100） |

### 3.4 排行榜

按综合得分排序，显示：
- 排名和排名变化（↑↓）
- 各主体名称和分数
- 你的主体会高亮显示

---

## 4. 规则系统

### 4.1 核心规则（不可违背）

- **现金流原则**：现金 < 0 判定破产，丧失游戏资格
- **决策权原则**：你的指令绝对优先，AI 不会代替你决策
- **公平原则**：系统不会撮合主体间合作

### 4.2 卦象系统

每年（2回合）会随机生成一个周易卦象，影响本年度的游戏：

| 卦象 | 效果示例 |
|------|----------|
| 乾卦 | 扩张性投资收益 +20% |
| 坤卦 | 防守型策略成本 -15% |
| 坎卦 | 现金流波动加剧 |
| 离卦 | 品牌曝光度提升 |
| 困卦 | 所有主动投资收益减半 |

**查看方式**：规则状态栏中的卦象标签

### 4.3 临时规则

主持人可能在游戏中添加临时事件或规则：
- 政策利好：政府补贴
- 市场寒冬：收入降低
- 原材料涨价：成本增加

这些会显示在规则状态栏中，注意查看。

---

## 5. 财务系统

### 5.1 资金计算公式

```
期末现金 = 期初现金 + 被动收入 - 被动支出 + 决策收益 - 决策成本
```

### 5.2 被动收支

**被动收入**（每回合自动获得）：
- 稳健业务收入
- 投资分红
- 租金收入等

**被动支出**（每回合自动扣除）：
- 固定运营成本
- 人员薪资
- 租金等

### 5.3 现金流警告

当你的决策可能导致现金流问题时，系统会显示警告：

| 警告级别 | 含义 |
|----------|------|
| ⚠️ 警告 | 现金流紧张，需要注意 |
| 🚨 危险 | 执行后将无法支付下回合被动支出 |
| ❌ 破产 | 执行后现金 < 0，将立即破产 |

**建议**：保持至少 2 回合的被动支出作为安全垫。

### 5.4 破产机制

**破产条件**：
- 现金余额 < 0
- 无法支付必要支出

**破产后果**：
- 丧失决策权
- 停止游戏资格
- 排行榜标记为破产

---

## 6. 决策指南

### 6.1 决策输入规范

**有效的决策示例**：
- ✅ "投入 30000 元进行市场推广"
- ✅ "研发新产品，预算 50000 元"
- ✅ "降低运营成本，裁员 10%"
- ✅ "与主体 B 协商价格联盟"

**会被拒绝的决策**：
- ❌ 代替其他主体决策
- ❌ 要求系统撮合合作
- ❌ 明显违反游戏公平性

### 6.2 策略选项

每回合 AI 会提供 3 个策略选项，包含：
- 选项标题和描述
- 预期资源变动（expectedDelta）
- 风险等级

**你可以**：
- 选择其中一个选项
- 自由输入自定义决策
- 组合多个行动

### 6.3 决策技巧

1. **关注现金流**：确保有足够资金支付被动支出
2. **查看卦象**：利用有利的卦象效果
3. **观察对手**：根据排行榜调整策略
4. **长期规划**：考虑多回合的连锁影响
5. **风险控制**：避免孤注一掷

---

## 7. 常见问题

### 7.1 无法提交决策

**可能原因**：
- 不在决策阶段
- 决策时限已过
- 网络问题

**解决方案**：
- 检查页面显示的当前阶段
- 刷新页面重试

### 7.2 看不到推演结果

**可能原因**：
- 推演还未完成
- 推演失败

**解决方案**：
- 等待推演完成
- 如果失败，等待主持人处理

### 7.3 现金流警告是什么意思？

这表示你的决策可能导致资金问题：
- **警告**：建议谨慎，但可以执行
- **危险**：强烈建议修改决策
- **破产**：无法执行，请修改

### 7.4 卦象效果在哪里查看？

在游戏界面顶部的规则状态栏中：
- 点击卦象标签查看详情
- 展开状态栏查看所有生效的规则修正

### 7.5 如何查看其他玩家状态？

- 排行榜显示所有主体的分数
- 推演结果中会显示各主体的属性变化
- 叙事中会描述各主体的行动和结果

### 5.7 无法连接到服务器

**可能原因**：
- 不在同一局域网内。
- 主持人的服务未启动。
- 防火墙阻止了连接。
- 服务器地址配置错误。

**解决方案**：
- 确认你和主持人在同一局域网（同一 WiFi 或有线网络）。
- 让主持人确认服务已启动（控制台显示局域网地址）。
- 检查防火墙设置，允许 3000 和 5173 端口。
- 访问"服务器配置"页面手动输入正确的服务器地址。

---

## 📌 游戏技巧

1. **仔细阅读规则**：了解胜利条件和资源系统
2. **关注规则状态栏**：了解当前生效的卦象和规则修正
3. **保持现金流健康**：避免破产风险
4. **利用卦象效果**：在有利时机采取行动
5. **观察对手动向**：制定应对策略
6. **完成成就**：获得永久加成

---

**祝你在博弈中脱颖而出！** 🎮✨
