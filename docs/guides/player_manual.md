# 🎮 玩家操作手册

欢迎来到 **AI 文字交互式游戏**！本作为一款基于大语言模型的多人联机策略游戏，你将与其他玩家和 AI 共同在动态演变的场景中进行竞争或合作。

---

## 📋 目录

1. [快速入门](#1-快速入门)
2. [游戏流程](#2-游戏流程)
3. [主要功能](#3-主要功能)
4. [页面说明](#4-页面说明)
5. [常见问题](#5-常见问题)

---

## 1. 快速入门

### 1.1 获取游戏地址

游戏地址由主持人提供，通常有两种情况：

**本机访问**（主持人自己）：
- 直接访问 `http://localhost:5173`

**局域网访问**（其他玩家）：
- 主持人运行 `run-dev.bat` 后，控制台会显示局域网地址
- 例如：`http://192.168.1.100:5173`
- 确保你的电脑和主持人在同一局域网内

### 1.2 注册与登录

1. 打开游戏网址（主持人提供的局域网地址，如 `http://192.168.1.100:5173`）。
2. 点击 **"去注册"** 或直接访问注册页面（`/register`）。
3. **极简注册**：仅需输入 **用户名** 和 **密码** 即可完成注册。
   - 用户名：3-50 个字符。
   - 密码：至少 6 个字符。
   - **注意**：为了简化流程，系统不再需要邮箱验证。
4. 注册成功后自动登录，或使用账号密码在登录页面（`/login`）完成登录。

### 1.2 加入房间

1. 登录后，你将看到 **游戏大厅**（`/rooms`），列表中展示了当前活跃的房间。
2. 找到主持人告知的房间名称，点击 **"加入"** 按钮。
3. 如果房间设有密码，请输入主持人提供的密码。
4. 加入成功后，你会进入 **等候大厅**（`/rooms/:roomId/wait`），请耐心等待所有玩家到齐及主持人完成配置并开始游戏。

---

## 2. 游戏流程（季度制）

游戏按 **回合制** 进行，默认 **季度一回合（Q1/Q2/Q3/Q4）**，包含四个阶段。系统会根据当前阶段自动跳转到相应页面。

### 🔵 决策阶段 (Decision Phase)

**页面**：`/game/:sessionId`

这是你发挥策略的主要时刻：

1. **查看当前局势**：
   - 左侧显示上一回合的推演结果（剧情叙述、资源变化等）。
   - 顶部状态栏实时显示你的资源（生命值、金币等）。
   - 查看当前回合数和倒计时（如果设置了决策时限）。

2. **提交决策**：
   - 在底部的输入框中描述你的行动计划。
   - 可以自由输入，例如：
     - "联合 Player 2 抬高价格"
     - "秘密通过小路运输物资"
     - "攻击 Player 3 的基地"
   - 点击 **"提交决策"** 按钮提交。
   - 提交后可以修改（在决策时限内）。

3. **发起交易**（可选）：
   - 点击页面上的 **"交易"** 标签页或按钮。
   - 选择目标玩家。
   - 选择要交易的资源类型和数量。
   - 发送交易请求，等待对方响应。

4. **查看任务**（可选）：
   - 点击页面上的 **"任务"** 标签页。
   - 查看当前回合的可用任务。
   - 查看任务进度和奖励。

**阶段结束**：
- 所有玩家提交决策后，或
- 决策时限到达后（根据超时策略，系统可能自动提交或跳过），
- 游戏自动进入审核阶段。

### 🟡 审核阶段 (Review Phase)

**页面**：仍在游戏会话页面（`/game/:sessionId`），但无法修改决策。

- 主持人可能会在该阶段暂停，审查所有玩家提交的决策，确保没有违规操作。
- 此时你无法修改指令，只需等待。
- 如果主持人修改了你的决策，你会看到修改说明。

**阶段结束**：主持人确认并提交给 AI 推演后，游戏进入推演阶段。

### 🟢 推演阶段 (Inference Phase)

**页面**：自动跳转到推演结果页面（`/game/:sessionId/round/:round/inference`）

- AI 正在根据通过的规则和所有玩家的行动计算结果。
- 这是一个复杂的生成过程，可能需要几秒到几十秒。
- 页面会显示推演进度（如果支持）。
- **请稍候，不要刷新页面**。

**阶段结束**：推演完成后，游戏自动进入结果阶段。

### 🟣 结果阶段 (Result Phase)

**页面**：`/game/:sessionId/round/:round/inference`

- **查看推演结果**（结构化展示）：
  - 剧情叙述（打字机效果）。
  - 属性面板（现金/市占/声誉/创新/被动收支/信用等）。
  - 排行榜（评分/市占/信用）。
  - 事件与遮蔽段落（如有）。
  - 财务核算（被动 vs 主动决策成本、余额）。
  - 策略选项（含预期变动 expectedDelta）与自定义输入入口。
  - 风险/机会/效益卡。
  - 分支叙事线索（如有）。
  - 下一回合提示。

- **查看资源变化**：
  - 查看你的资源变化情况（增加/减少）。
  - 了解其他玩家的资源状态。

- **查看活跃事件**：
  - 如果有多回合事件正在进行，可以查看事件进度。

**阶段结束**：主持人点击"进入下一回合"后，游戏进入下一回合的决策阶段，自动跳转回游戏会话页面。

---

## 3. 主要功能

### 3.1 决策提交

- **自由文本输入**：可以输入任何合理的行动描述。
- **修改决策**：在决策阶段和决策时限内，可以修改已提交的决策。
- **查看提交状态**：页面会显示你和其他玩家的提交状态（已提交/未提交）。

### 3.2 交易系统

- **发起交易**：在决策阶段可以向其他玩家发起资源交易请求。
- **响应交易**：
  - 查看收到的交易请求。
  - 选择接受、拒绝或修改交易条件。
  - 交易成功后资源立即生效。

**交易页面**：`/game/:sessionId/trade`

### 3.3 任务系统

- **查看任务**：在决策阶段可以查看当前回合的可用任务。
- **任务类型**：
  - 主线任务（main）：影响游戏进程的关键任务。
  - 挑战任务（challenge）：提供额外奖励的挑战。
- **任务进度**：系统自动跟踪任务进度，完成后自动发放奖励。

**任务页面**：`/game/:sessionId/tasks`

### 3.4 游戏存档

- **保存游戏**：可以手动保存游戏进度。
- **恢复游戏**：可以加载之前保存的存档继续游戏。
- **自动保存**：系统可能在某些关键节点自动保存。

**存档页面**：`/game/:sessionId/saves`

### 3.5 游戏历史

- **查看历史记录**：可以查看你参与过的所有游戏记录。
- **查看详情**：可以查看每局游戏的详细信息和推演结果。
- **统计分析**：可以查看你的游戏统计（胜率、平均分数等）。

**历史页面**：`/game/history`

### 3.6 策略分析

- **创建策略**：可以基于游戏经验创建策略记录。
- **分析策略**：查看策略的胜率和平均表现。
- **优化策略**：根据分析结果优化你的游戏策略。

**策略页面**：`/user/strategies`

---

## 4. 页面说明

### 4.1 游戏会话页面 (`/game/:sessionId`)

**用途**：主要游戏界面，用于提交决策。

**主要内容**：
- 当前回合信息和倒计时。
- 上一回合的推演结果。
- 决策输入框和提交按钮。
- 玩家列表和提交状态。
- 快捷功能入口（交易、任务等）。

### 4.2 推演结果页面 (`/game/:sessionId/round/:round/inference`)

**用途**：查看 AI 推演结果。

**主要内容**：
- 剧情叙述（打字机效果）。
- 每个玩家的结果和资源变化。
- 发生的新事件。
- 下一回合提示。
- 活跃事件进度（如果有）。

### 4.3 决策控制台页面 (`/game/:sessionId/decision-console`)

**用途**：高级视图（金融赛博夜光风）查看季度叙事、财务核算、排行榜、主体对比、风险/机会/效益，以及 AI 策略选项和自定义输入。

**主要内容**：
- 周易卦象（吉/凶/中配色，暂无动画）。
- 财务核算中心：被动收入/支出（灰底锁定）与主动决策成本（高亮）、余额与现金覆盖度、破产预警。
- 排行榜：评分/市占/信用评级，主体数量动态，不固定 ABCD，不在标识符用 emoji。
- 多主体对比卡：现金/市占/声誉/创新/被动收支/信用，配色由 paletteKey 控制。
- 叙事与分支线索：季度节奏，支持 branchingNarratives。
- 风险/机会/效益卡。
- 策略选项 3 条（expectedDelta 展示）+ 自定义指令输入框。

### 4.4 交易页面 (`/game/:sessionId/trade`)

**用途**：发起和响应交易请求。

**主要内容**：
- 发起新交易的表单。
- 待处理的交易列表。
- 交易历史记录。

### 4.4 任务页面 (`/game/:sessionId/tasks`)

**用途**：查看和管理任务。

**主要内容**：
- 可用任务列表。
- 任务详情和进度。
- 任务奖励信息。

### 4.5 游戏存档页面 (`/game/:sessionId/saves`)

**用途**：保存和加载游戏进度。

**主要内容**：
- 存档列表。
- 创建新存档。
- 加载存档。

---

## 5. 常见问题

### 5.1 无法提交决策

**可能原因**：
- 不在决策阶段（可能在审核或推演阶段）。
- 决策时限已过。
- 网络连接问题。

**解决方案**：
- 检查页面显示的当前阶段状态。
- 刷新页面重试。
- 检查网络连接。

### 5.2 看不到推演结果

**可能原因**：
- 推演还未完成（仍在推演阶段）。
- 推演失败（查看错误信息）。
- 页面未自动跳转。

**解决方案**：
- 等待推演完成（查看推演进度）。
- 如果推演失败，等待主持人处理。
- 手动访问推演结果页面：`/game/:sessionId/round/:round/inference`

### 5.3 页面卡住不更新

**可能原因**：
- WebSocket 连接断开。
- 浏览器缓存问题。

**解决方案**：
- 刷新页面。
- 检查浏览器控制台是否有错误。
- 清除浏览器缓存后重试。

### 5.4 无法加入房间

**可能原因**：
- 房间已满。
- 房间密码错误。
- 房间已关闭。

**解决方案**：
- 检查房间状态和当前人数。
- 确认密码是否正确。
- 联系主持人确认房间状态。

### 5.5 交易请求无响应

**可能原因**：
- 对方未在线。
- 交易已过期。
- 对方拒绝了交易。

**解决方案**：
- 检查交易状态。
- 如果交易已过期，需要重新发起。
- 等待对方响应。

### 5.6 任务进度不更新

**可能原因**：
- 任务条件未满足。
- 系统延迟。

**解决方案**：
- 检查任务要求和当前进度。
- 刷新任务页面。
- 联系主持人确认。

### 5.7 无法连接到服务器

**可能原因**：
- 不在同一局域网内。
- 主持人的服务未启动。
- 防火墙阻止了连接。
- 服务器地址配置错误。

**解决方案**：
- 确认你和主持人在同一局域网（同一 WiFi 或有线网络）。
- 让主持人确认服务已启动（控制台显示局域网地址）。
- 检查防火墙设置，允许 3000 和 5173 端口。
- 访问"服务器配置"页面手动输入正确的服务器地址。

---

## 📌 游戏技巧

1. **仔细阅读规则**：在游戏开始前，仔细阅读主持人设置的游戏规则，了解胜利条件和资源系统。

2. **观察其他玩家**：注意其他玩家的资源状态和行动模式，制定应对策略。

3. **合理使用交易**：交易是获取资源的重要手段，但要注意交易时机和条件。

4. **完成任务**：完成任务可以获得额外奖励，但要注意任务难度和时间成本。

5. **保存进度**：重要节点记得保存游戏进度，避免意外丢失。

6. **查看历史**：通过查看游戏历史，分析自己的游戏表现，优化策略。

---

**祝你在博弈中脱颖而出！** 🎮✨
