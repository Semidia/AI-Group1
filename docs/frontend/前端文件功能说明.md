# 前端文件功能说明文档

本文档详细说明前端 `src/` 目录下所有文件（页面组件、通用组件、服务层、Hooks、状态管理、样式等）的功能、特性、状态管理和交互流程。

> **项目路径**: `AI-Group1/rebuild/production/frontend/src/`

---

## 📦 按文件索引（快速导航）

> 下面按照 `src` 目录结构列出所有核心文件，并给出对应说明章节的跳转链接，方便快速查找。

- **入口与整体结构**
  - `src/main.tsx` → [应用入口和路由](#-应用入口和路由)
  - `src/App.tsx` → [应用入口和路由](#-应用入口和路由)
  - `src/App.css` / `src/index.css` / `src/vite-env.d.ts` → [样式与环境声明](#-样式文件)

- **页面 `src/pages/`**
  - 认证相关
    - `Login.tsx` / `Register.tsx` / `ForgotPassword.tsx` / `ResetPassword.tsx` → [认证相关页面](#认证相关页面)
  - 首页与房间
    - `Home.tsx` → [首页](#首页)
    - `Rooms.tsx` / `WaitingRoom.tsx` → [房间管理页面](#房间管理页面)
  - 游戏核心流程
    - `GameSession.tsx` / `GameState.tsx` / `GameHistory.tsx` / `GameSave.tsx` / `InferenceResult.tsx` / `EventProgress.tsx` → [游戏核心页面](#游戏核心页面)
  - 主持人相关
    - `HostSetup.tsx` / `HostReview.tsx` → [主持人专用页面](#主持人专用页面)
  - 功能辅助与分析
    - `StrategyAnalysis.tsx` / `Tasks.tsx` / `Trade.tsx` → [功能辅助页面](#功能辅助页面)
  - 测试与调试
    - `TestWebSocket.tsx` → [测试页面](#测试页面)

- **通用组件 `src/components/`**
  - `GlassCard.tsx` / `OnlineRoomsPanel.tsx` / `ProtectedRoute.tsx` / `RoomCard.tsx` / `UserRegistryPanel.tsx`  
    → [通用组件 Components](#-通用组件-components)

- **服务层 `src/services/`**
  - `api.ts` / `auth.ts` / `rooms.ts` / `game.ts` / `trade.ts` / `strategy.ts` / `admin.ts` / `websocket.ts`  
    → [服务层 Services](#-服务层-services)

- **自定义 Hooks `src/hooks/`**
  - `useSocket.ts` / `useMessageRouter.ts` → [自定义 Hooks](#-自定义-hooks)

- **状态管理 `src/stores/`**
  - `authStore.ts` → [状态管理 Stores](#-状态管理-stores)

- **AI 模型配置 `src/constants/`**
  - `aiModels.ts` → [服务层 Services](#-服务层-services)（与 API 配置关联的模型预设说明）

---

## 📋 目录

1. [认证相关页面](#认证相关页面)
2. [首页](#首页)
3. [房间管理页面](#房间管理页面)
4. [游戏核心页面](#游戏核心页面)
5. [主持人专用页面](#主持人专用页面)
6. [功能辅助页面](#功能辅助页面)
7. [测试页面](#测试页面)
8. [应用入口和路由](#-应用入口和路由)
9. [通用组件 Components](#-通用组件-components)
10. [服务层 Services](#-服务层-services)
11. [自定义 Hooks](#-自定义-hooks)
12. [状态管理 Stores](#-状态管理-stores)
13. [样式与环境声明](#-样式文件)

---

## 🔐 认证相关页面

### `Login.tsx` - 登录页面

**路由**: `/login`

**主要功能**:
- 用户登录认证
- 支持已登录用户显示当前用户信息
- 登录成功后自动跳转到来源页面或首页

**核心特性**:
- 表单验证（用户名、密码必填）
- 错误提示显示
- 登录状态管理（使用 `useAuthStore`）
- 登录成功后自动保存 Token 和用户信息到 localStorage

**组件状态**:
- `loading`: 登录请求加载状态

**主要交互**:
- 表单提交调用 `authAPI.login()`
- 成功后调用 `login()` 更新全局状态
- 跳转到目标页面（从 `location.state.from` 获取）

**UI 元素**:
- 用户名输入框（带图标）
- 密码输入框（隐藏显示）
- 登录按钮
- 顶部品牌栏和导航链接

---

### `Register.tsx` - 注册页面

**路由**: `/register`

**主要功能**:
- 新用户注册
- 注册成功后自动登录

**核心特性**:
- 用户名验证（3-50 个字符）
- 密码验证（至少 6 个字符）
- 确认密码一致性验证
- 注册成功后自动跳转到首页

**组件状态**:
- `loading`: 注册请求加载状态

**表单字段**:
- `username`: 用户名（必填，3-50 字符）
- `password`: 密码（必填，至少 6 字符）
- `confirmPassword`: 确认密码（必填，需与密码一致）

**主要交互**:
- 表单提交调用 `authAPI.register()`
- 成功后自动调用 `login()` 并跳转

**UI 元素**:
- 注册表单（居中卡片样式）
- 返回登录链接

---

### `ForgotPassword.tsx` - 忘记密码页面

**路由**: `/forgot-password`

**主要功能**:
- 显示密码找回功能已关闭的提示

**核心特性**:
- 简化的提示页面
- 引导用户联系管理员

**UI 元素**:
- 提示信息卡片
- 返回登录按钮

**注意**: 当前系统已关闭邮箱找回功能，此页面仅作为占位符。

---

### `ResetPassword.tsx` - 重置密码页面

**路由**: `/reset-password?token=xxx`

**主要功能**:
- 使用重置 Token 修改密码

**核心特性**:
- 从 URL 参数获取重置 Token
- Token 验证（无 Token 则跳转登录）
- 新密码设置（至少 6 个字符）
- 确认密码一致性验证

**组件状态**:
- `loading`: 重置请求加载状态
- `token`: 从 URL 获取的重置令牌

**表单字段**:
- `password`: 新密码（必填，至少 6 字符）
- `confirmPassword`: 确认新密码（必填，需与密码一致）

**主要交互**:
- 从 URL 参数 `token` 获取重置令牌
- 调用 `authAPI.resetPassword()` 重置密码
- 成功后跳转到登录页面

---

## 🏠 首页

### `Home.tsx` - 首页

**路由**: `/`

**主要功能**:
- 游戏介绍和入口导航
- 用户信息显示
- 快速访问功能面板

**核心特性**:
- 品牌展示（"凡墙皆是门"）
- 用户登录状态显示
- 侧边栏面板控制（用户列表、在线房间）
- 快速导航到房间列表

**组件状态**:
- `userPanelOpen`: 用户列表面板开关
- `roomsPanelOpen`: 在线房间面板开关

**使用的子组件**:
- `UserRegistryPanel`: 用户注册表面板（侧边栏）
- `OnlineRoomsPanel`: 在线房间面板（侧边栏）

**主要交互**:
- 点击"开始匹配"跳转到 `/rooms`
- 点击"查看在册用户"打开用户面板
- 点击"在线房间"打开房间面板
- 登录/登出按钮

**UI 布局**:
- 顶部导航栏（品牌 + 用户信息 + 登录按钮）
- 主内容区（标题 + 描述 + 快速入口卡片）

---

## 🏢 房间管理页面

### `Rooms.tsx` - 房间列表页面

**路由**: `/rooms`

**主要功能**:
- 创建新房间
- 浏览房间列表
- 加入/离开房间
- 房间管理（关闭、终止游戏）

**核心特性**:
- 实时房间列表更新（WebSocket 事件监听）
- 房间创建表单
- 房间卡片展示（使用 `RoomCard` 组件）
- WebSocket 连接状态显示

**组件状态**:
- `rooms`: 房间列表数据
- `loading`: 加载状态
- `createLoading`: 创建房间加载状态
- `actionRoomId`: 正在操作的房间 ID（用于按钮禁用）

**WebSocket 事件监听**:
- `player_joined`: 玩家加入房间 → 更新房间人数
- `player_left`: 玩家离开房间 → 更新房间人数
- `system_message`: 系统消息 → 显示提示并刷新列表
- `error`: 错误消息 → 显示错误提示

**主要功能方法**:
- `loadRooms()`: 加载房间列表（默认限制 50 个）
- `handleCreate()`: 创建房间（房间名、最大人数、密码可选）
- `handleJoin()`: 加入房间 → 跳转到等待房间
- `handleLeave()`: 离开房间
- `handleClose()`: 关闭房间（仅房主）
- `handleKillGame()`: 终止游戏（仅房主）

**表单字段**:
- `name`: 房间名称（必填）
- `maxPlayers`: 最大人数（默认 4，范围 2-10）
- `password`: 房间密码（可选）

**UI 布局**:
- 创建房间表单（顶部）
- 房间列表网格（使用 `RoomCard` 组件展示）
- WebSocket 状态标签

---

### `WaitingRoom.tsx` - 等待房间页面

**路由**: `/rooms/:roomId/wait`

**主要功能**:
- 显示房间信息和玩家状态
- 等待游戏开始
- 主持人配置入口
- 自动跳转到游戏页面

**核心特性**:
- 实时房间状态同步（WebSocket）
- 房间详情展示
- 自动检测游戏开始并跳转
- 主持人专用按钮（配置、开始游戏）

**组件状态**:
- `rooms`: 房间列表（用于查找当前房间）
- `loading`: 加载状态
- `realtimeState`: 实时房间状态（玩家列表、状态）

**WebSocket 事件监听**:
- `player_joined`: 玩家加入 → 刷新列表
- `player_left`: 玩家离开 → 刷新列表
- `system_message`: 系统消息 → 显示提示
- `game_state_update`: 游戏状态更新 → 如果状态为 `playing` 且存在 `sessionId`，自动跳转到游戏页面
- `game_started`: 游戏开始 → 自动跳转到游戏页面

**主要交互**:
- 进入页面时自动发送 `join_room` 和 `sync_state` 消息
- 主持人可以点击"主持人配置"跳转到 `/rooms/:roomId/host-setup`
- 游戏开始后自动跳转到 `/game/:sessionId`

**显示的房间信息**:
- 房间名称
- 当前人数 / 最大人数
- 房间状态（waiting/playing/closed）

**UI 布局**:
- 返回房间列表按钮
- 房间信息卡片（描述列表形式）
- 主持人操作按钮（仅房主可见）

---

## 🎮 游戏核心页面

### `GameSession.tsx` - 游戏会话页面（玩家决策页）

**路由**: `/game/:sessionId`

**主要功能**:
- 玩家提交决策的主要界面
- 查看游戏状态和剧情
- 查看其他玩家提交状态
- 显示倒计时和回合信息

**核心特性**:
- 三栏布局（玩家信息 | 剧情和决策输入 | 排行榜和任务）
- 实时倒计时显示（每秒更新）
- 决策文本输入（最大 500 字符）
- 玩家提交状态实时更新
- 主持人自动跳转到游戏状态页面
- 结果阶段自动跳转到推演结果页

**组件状态**:
- `session`: 游戏会话信息
- `decisions`: 当前回合所有玩家决策列表
- `decisionText`: 决策输入文本
- `submitting`: 提交决策加载状态
- `currentTime`: 当前时间（用于倒计时计算）
- `displayNarrative`: 显示的剧情文本（固定显示欢迎信息）

**WebSocket 事件监听**:
- `decision_status_update`: 决策状态更新 → 刷新决策列表
- `game_state_update`: 游戏状态更新 → 更新会话状态
  - 如果 `roundStatus === 'decision'` → 显示回合开始提示
  - 如果 `roundStatus === 'result'` → 自动跳转到推演结果页

**主要功能方法**:
- `loadSession()`: 加载游戏会话信息
  - 如果是主持人，自动跳转到 `/game/:sessionId/state`
- `loadDecisions()`: 加载当前回合的决策列表
- `handleSubmitDecision()`: 提交决策
  - 验证输入不为空
  - 调用 `gameAPI.submitDecision()`
  - 成功后刷新决策列表

**倒计时计算**:
- 使用 `formatRemaining()` 函数格式化剩余时间
- `isTimeout`: 判断是否超时（用于禁用提交按钮）

**UI 布局**:

**左侧栏**:
- 玩家情报卡片
  - 当前用户头像和信息
  - 资源显示（金币、能量）
  - 队友进度列表（显示所有玩家的提交状态）
- 系统控制面板
  - 存档管理按钮
  - 刷新状态按钮

**中间栏**:
- 故事现场卡片
  - 剧情显示区域（灰色背景）
- 决策输入区域
  - 决策输入框（TextArea，10 行）
  - 字符计数显示（0 / 500）
  - 提交按钮（决策阶段可用，超时后禁用）

**右侧栏**:
- 全局排行卡片（静态数据示例）
- 当前挑战卡片（任务列表预览）
- 大事纪卡片

**决策输入框提示文字**:
```typescript
placeholder="作为这片废土的幸存者，你接下来打算怎么做？描述你的精确意图..."
```

**特殊逻辑**:
- 主持人访问此页面会自动重定向到游戏状态页面
- 决策阶段结束后自动跳转到推演结果页面
- 结果阶段显示"查看本回合结果"按钮

---

### `InferenceResult.tsx` - AI 推演结果页面

**路由**: `/game/:sessionId/round/:round/inference`

**主要功能**:
- 显示 AI 推演结果
- 实时显示推演进度
- 打字机效果显示剧情
- 显示玩家结果和事件

**核心特性**:
- 推演进度实时更新（WebSocket）
- 剧情打字机效果（逐字显示）
- 推演失败错误提示
- 推演完成自动显示结果

**组件状态**:
- `result`: 推演结果数据
- `progress`: 推演进度信息
- `narrativeText`: 打字机效果显示的文本
- `typewriterIntervalRef`: 打字机定时器引用

**WebSocket 事件监听**:
- `inference_progress`: 推演进度更新 → 更新进度条
- `inference_completed`: 推演完成 → 重新加载结果并开始打字机效果
- `inference_failed`: 推演失败 → 显示错误信息

**主要功能方法**:
- `loadResult()`: 加载推演结果
  - 如果已完成且有剧情，启动打字机效果
- `startTypewriter()`: 打字机效果（每 20ms 显示一个字符）

**UI 布局**:

**顶部**:
- 返回战场按钮
- 标题："推演视界"
- 推演状态显示（processing 时显示加载动画）

**主内容区（左右分栏）**:

**左侧（16 列）**:
- 核心叙事卡片
  - 大文本区域显示剧情（打字机效果）
  - 推演中显示加载动画和提示
  - 失败显示错误信息
- 先导提示卡片（如果有 `nextRoundHints`）

**右侧（8 列）**:
- 计算进度卡片（仅推演中显示）
  - 进度条
  - 进度消息
- 实体变动卡片
  - 显示每个玩家的结果和资源变化
- 突发事件卡片
  - 显示发生的新事件列表

**结果数据结构**:
```typescript
{
  narrative?: string;           // 剧情叙述
  outcomes?: Array<{            // 玩家结果
    playerIndex: number;
    outcome: string;
    resources?: Record<string, unknown>;
  }>;
  events?: Array<{              // 新事件
    type: string;
    description: string;
  }>;
  nextRoundHints?: string;      // 下一回合提示
}
```

---

## 🎯 主持人专用页面

### `HostSetup.tsx` - 主持人配置页面

**路由**: `/rooms/:roomId/host-setup`

**主要功能**:
- 三步向导式配置流程
- API 配置
- 游戏规则配置
- 玩家配置
- 配置验证和完成

**核心特性**:
- 步骤指示器（Steps 组件）
- 表单数据持久化（每次保存后更新配置状态）
- JSON 格式验证（Headers、Body 模板）
- 配置完成后可以开始游戏

**组件状态**:
- `config`: 主持人配置数据
- `loading`: 加载配置状态
- `saving`: 保存操作状态
- `formApi`, `formRules`, `formPlayers`: 三个表单实例

**步骤流程**:

**Step 1: API 配置**
- `apiProvider`: API 提供商（如 openai、deepseek、custom）
- `apiEndpoint`: API 端点 URL
- `apiHeaders`: Headers JSON（包含 API Key）
- `apiBodyTemplate`: Body 模板 JSON（包含 `{{prompt}}` 占位符）
- 点击"保存 API 配置"后验证配置

**Step 2: 规则与玩家配置**

**规则配置**:
- `gameRules`: 游戏规则文本（Markdown 格式，可选）

**玩家配置**:
- `totalDecisionEntities`: 总决策主体数（必填，>=1）
- `humanPlayerCount`: 人类玩家数（必填，>=0）
- `aiPlayerCount`: AI 玩家数（必填，>=0）
- `decisionTimeLimit`: 决策时限（分钟，必填，>=1）
- `timeoutStrategy`: 超时策略（默认 `auto_submit`）

**Step 3: 验证与完成**
- "标记验证通过"按钮（将 `validationStatus` 设为 `validated`）
- "完成配置"按钮（将 `initializationCompleted` 设为 `true`）
- "开始游戏"按钮（配置完成后显示）

**主要功能方法**:
- `loadConfig()`: 加载现有配置并填充表单
- `handleSaveApi()`: 保存 API 配置（JSON 解析验证）
- `handleSaveRules()`: 保存游戏规则
- `handleSavePlayers()`: 保存玩家配置
- `handleValidate()`: 标记验证通过
- `handleComplete()`: 完成配置
- `handleStartGame()`: 开始游戏 → 跳转到游戏会话页面

**配置快照显示**:
- 页面底部显示当前配置的 JSON 格式快照

**特殊验证**:
- `safeParseJson()`: 安全解析 JSON，失败时抛出错误

---

### `HostReview.tsx` - 主持人审核页面

**路由**: `/game/:sessionId/review`

**主要功能**:
- 查看所有玩家提交的决策
- 编辑玩家决策（可选）
- 添加临时事件
- 添加临时规则
- 提交给 AI 推演

**核心特性**:
- 实时决策列表更新（WebSocket）
- 决策详情展示（选项、文本、修改记录）
- 模态框添加事件/规则
- 提交前确认

**组件状态**:
- `reviewData`: 审核数据（包含回合号和决策列表）
- `loading`: 加载状态
- `eventModalVisible`, `ruleModalVisible`, `submitModalVisible`: 三个模态框开关
- `eventType`, `eventContent`, `eventRounds`: 临时事件表单状态
- `ruleContent`, `ruleRounds`: 临时规则表单状态

**WebSocket 事件监听**:
- `round_stage_changed`: 回合阶段变化 → 重新加载数据
- `stage_changed`: 阶段变化 → 如果变为 `review`，重新加载
- `temporary_event_added`: 临时事件添加 → 重新加载
- `temporary_rule_added`: 临时规则添加 → 重新加载
- `inference_started`: 推演开始 → 跳转到推演结果页
- `inference_completed`: 推演完成 → 跳转到推演结果页

**主要功能方法**:
- `loadReviewData()`: 加载审核数据
  - 自动获取当前回合号（如果没有提供）
- `handleAddEvent()`: 添加临时事件
  - 支持单回合事件和多回合事件
  - 多回合事件需要填写有效回合数
- `handleAddRule()`: 添加临时规则
  - 需要填写规则内容
  - 可以设置有效回合数（默认 1）
- `handleSubmitToAI()`: 提交给 AI 推演
  - 确认后调用 `gameAPI.submitToAI()`
  - 成功后跳转到推演结果页

**显示的决策信息**:
- 玩家索引和用户名
- 决策状态（pending/submitted/reviewed）
- 决策内容（actionText）
- 选项 ID（selectedOptionIds，如有）
- 主持人修改记录（hostModification，如有）
- 提交时间

**临时事件类型**:
- `single_round`: 单回合事件（仅本回合有效）
- `multi_round`: 多回合事件（指定回合数有效）

**UI 布局**:
- 顶部：标题、WebSocket 状态、回合号、超时状态
- 决策列表卡片：显示所有玩家决策
- 操作按钮区域：
  - "添加临时事件"按钮
  - "添加临时规则"按钮
  - "提交给 AI 推演"按钮（无决策时禁用）

**模态框**:
- 添加临时事件模态框：类型选择、有效回合数、事件内容
- 添加临时规则模态框：有效回合数、规则内容
- 提交推演确认模态框：确认提示

---

### `GameState.tsx` - 游戏状态页面（主持人控制台）

**路由**: `/game/:sessionId/state`

**主要功能**:
- 主持人查看游戏整体状态
- 控制游戏流程（进入审核、下一回合）
- 查看回合历史和活跃事件
- 推演结果摘要

**核心特性**:
- 实时状态同步（WebSocket + 定期刷新）
- 主持人权限检查（仅主持人可见此页面）
- 回合进度可视化
- 快速操作按钮

**组件状态**:
- `gameState`: 游戏状态数据
- `history`: 回合历史记录
- `loading`: 加载状态
- `isHost`: 是否是主持人标志

**WebSocket 事件监听**:
- `round_changed`: 回合切换 → 刷新状态和历史
- `stage_changed`: 阶段切换 → 刷新状态并显示提示
- `game_finished`: 游戏结束 → 刷新状态

**定期刷新**:
- 每 5 秒自动刷新游戏状态

**主要功能方法**:
- `loadGameState()`: 加载游戏状态
  - 检查是否是主持人（通过 `hostId` 比较）
- `loadHistory()`: 加载回合历史记录
- `handleNextRound()`: 进入下一回合
  - 仅能在结果阶段执行
  - 如果达到总回合数，游戏结束

**显示的信息**:

**游戏状态概览**:
- WebSocket 连接状态
- 会话 ID
- 当前回合数
- 总回合数（如有）
- 当前阶段（decision/review/inference/result/finished）
- 游戏状态（playing/paused/finished）

**回合进度**:
- 进度条显示（当前回合 / 总回合数）

**决策提交状态**（决策阶段）:
- 提交进度：已提交数 / 总玩家数
- 主持人提示：可以进入审核阶段

**主持人操作卡片**（决策阶段）:
- "进入审核阶段"按钮
  - 点击后调用 `gameAPI.startReview()`
  - 成功后跳转到审核页面

**推演结果摘要**（结果阶段）:
- 显示本轮推演结果的剧情（简短）
- "查看详细结果"链接

**主持人操作**（结果阶段）:
- "进入下一回合"按钮
  - 仅当游戏未结束时显示

**游戏结束提示**:
- 显示游戏结束信息和最终回合数

**回合历史时间线**:
- 使用 Timeline 组件显示所有回合
- 每个回合显示状态图标和完成时间

**活跃事件列表**:
- 显示所有活跃的多回合事件
- 包含事件类型、内容、进度信息

**快速导航按钮**:
- "进入审核阶段"（决策阶段）
- "审核页面"（审核阶段）
- "事件进度"（所有阶段）
- "推演结果"（结果阶段）

**阶段标签映射**:
```typescript
{
  decision: '决策阶段',
  review: '审核阶段',
  inference: '推演阶段',
  result: '结果阶段',
  finished: '已结束'
}
```

---

## 🛠️ 功能辅助页面

### `Trade.tsx` - 交易页面

**路由**: `/game/:sessionId/trade`

**主要功能**:
- 查看交易列表
- 发起交易请求
- 响应交易请求（接受/拒绝）
- 取消交易

**核心特性**:
- 交易列表表格展示
- 实时交易状态更新（WebSocket）
- 交易过期检测
- 权限控制（发起者/接收者）

**组件状态**:
- `trades`: 交易列表
- `loading`: 加载状态
- `requestModalVisible`: 发起交易模态框开关
- `form`: 交易表单

**WebSocket 事件监听**:
- `trade_requested`: 收到交易请求 → 刷新列表并显示提示
- `trade_responded`: 交易响应 → 刷新列表并显示提示
- `trade_cancelled`: 交易取消 → 刷新列表并显示提示

**主要功能方法**:
- `loadTrades()`: 加载交易列表
- `handleRequestTrade()`: 发起交易请求
  - 目标用户 ID
  - 提供的资源（JSON 格式）
  - 请求的资源（JSON 格式）
  - 过期时间（分钟，默认 5）
- `handleRespondTrade()`: 响应交易（accept/reject）
- `handleCancelTrade()`: 取消交易（确认对话框）

**交易状态**:
- `pending`: 待处理（processing 颜色）
- `accepted`: 已接受（success 颜色）
- `rejected`: 已拒绝（error 颜色）
- `expired`: 已过期（default 颜色）
- `cancelled`: 已取消（default 颜色）

**表格列**:
- 发起者
- 目标
- 提供的资源（JSON 显示）
- 请求的资源（JSON 显示）
- 状态（带过期检测）
- 过期时间
- 操作（接受/拒绝/取消按钮）

**权限控制**:
- 接收者可以接受/拒绝待处理的交易
- 发起者可以取消待处理的交易

---

### `Tasks.tsx` - 任务页面

**路由**: `/game/:sessionId/tasks`

**主要功能**:
- 查看任务列表
- 创建新任务
- 查看任务详情
- 查看任务进度

**核心特性**:
- 任务列表展示
- 任务进度可视化（Progress 组件）
- 任务状态标签
- 任务详情模态框

**组件状态**:
- `tasks`: 任务列表
- `loading`: 加载状态
- `createModalVisible`: 创建任务模态框开关
- `detailModalVisible`: 详情模态框开关
- `selectedTask`: 选中的任务详情
- `form`: 创建任务表单

**主要功能方法**:
- `loadTasks()`: 加载任务列表
- `handleCreate()`: 创建任务
  - 标题（必填）
  - 描述（可选）
  - 任务类型（daily/achievement/challenge/event）
  - 难度（easy/normal/hard/expert）
- `handleViewDetail()`: 查看任务详情
- `calculateProgress()`: 计算任务进度百分比

**任务类型**:
- `daily`: 日常任务
- `achievement`: 成就任务
- `challenge`: 挑战任务
- `event`: 事件任务

**任务难度**:
- `easy`: 简单（绿色标签）
- `normal`: 普通（蓝色标签）
- `hard`: 困难（红色标签）
- `expert`: 专家

**任务状态**:
- `active`: 进行中（processing 颜色）
- `completed`: 已完成（success 颜色）
- `expired`: 已过期（error 颜色）
- `cancelled`: 已取消（default 颜色）

**任务进度计算**:
- 基于 `requirements` 和 `userProgress.progress` 计算
- 进度百分比 = (已完成项 / 总需求项) * 100

**UI 布局**:
- 任务列表（List 组件）
  - 任务标题、状态标签、类型标签、难度标签
  - 任务描述
  - 进度条（如果有用户进度）
  - 创建时间
- 创建任务按钮
- 刷新按钮

**详情模态框**:
- 任务标题、描述、类型、难度
- 状态标签
- 进度条（如果有）
- 完成时间（如果有）
- 创建时间、过期时间（如果有）

---

### `GameSave.tsx` - 游戏存档页面

**路由**: `/game/:sessionId/saves`

**主要功能**:
- 查看游戏存档列表
- 创建新存档
- 恢复存档
- 删除存档

**核心特性**:
- 存档列表展示（手动/自动区分）
- 存档详情显示（名称、描述、时间）
- 恢复前确认提示
- 删除前确认提示
- 毛玻璃效果 UI 设计

**组件状态**:
- `saves`: 存档列表
- `loading`: 加载状态
- `saveModalVisible`: 创建存档模态框开关
- `form`: 创建存档表单

**主要功能方法**:
- `loadSaves()`: 加载存档列表
- `handleSave()`: 创建存档
  - 存档名称（可选，最多 100 字符）
  - 详细描述（可选，最多 500 字符）
- `handleRestore()`: 恢复存档
  - 确认对话框
  - 成功后跳转到游戏状态页面
- `handleDelete()`: 删除存档（无需确认，直接删除）

**存档类型**:
- `isAutoSave: true`: 系统自动存档（蓝色图标，processing 标签）
- `isAutoSave: false`: 玩家手动存档（绿色图标，success 标签）

**存档信息显示**:
- 存档名称（未命名归档）
- 存档类型标签
- 详细描述（如果有）
- 创建时间（格式化显示）
- 创建者昵称

**UI 设计**:
- 深色渐变背景
- 毛玻璃效果卡片
- 存档列表项 hover 效果

---

### `GameHistory.tsx` - 游戏历史页面

**路由**: `/game/history`

**主要功能**:
- 查看所有游戏历史记录
- 筛选游戏状态
- 查看游戏详情
- 删除历史记录（单个/批量）

**核心特性**:
- 分页显示历史记录
- 状态筛选（finished/playing/paused）
- 统计信息展示
- 详情模态框
- 批量删除功能

**组件状态**:
- `history`: 历史记录列表
- `loading`: 加载状态
- `pagination`: 分页信息
- `statistics`: 统计信息
- `statusFilter`: 状态筛选值
- `selectedRows`: 选中的记录 ID 列表
- `detailModalVisible`: 详情模态框开关
- `detailData`: 详情数据
- `detailLoading`: 详情加载状态

**主要功能方法**:
- `loadHistory()`: 加载历史记录（分页、筛选）
- `loadStatistics()`: 加载统计信息
- `handleViewDetail()`: 查看游戏详情
- `handleDelete()`: 删除单条记录
- `handleBatchDelete()`: 批量删除记录

**统计信息**:
- 总游戏数
- 已完成数
- 进行中数
- 平均回合数

**表格列**:
- 房间名称
- 主持人
- 回合数（当前 / 总）
- 状态（游戏状态 + 回合状态）
- 创建时间
- 结束时间
- 操作（查看、删除）

**状态筛选选项**:
- `finished`: 已完成
- `playing`: 进行中
- `paused`: 已暂停

**详情模态框显示**:
- 房间名称、主持人
- 回合数
- 游戏状态
- 游戏规则（如果有）
- 回合结果列表（每回合的推演结果）
- 创建时间、结束时间

**状态颜色映射**:
```typescript
// 游戏状态
finished: 'green'
playing: 'blue'
paused: 'orange'

// 回合状态
decision: 'blue'
review: 'orange'
inference: 'purple'
result: 'green'
finished: 'default'
```

---

### `StrategyAnalysis.tsx` - 策略分析页面

**路由**: `/user/strategies`

**主要功能**:
- 查看用户策略列表
- 查看策略分析详情
- 策略数据统计

**核心特性**:
- 策略列表表格展示（按胜率排序）
- 策略分析详情模态框
- 统计数据可视化（Statistic、Progress 组件）

**组件状态**:
- `strategies`: 策略列表
- `loading`: 加载状态
- `analysisModalVisible`: 分析详情模态框开关
- `selectedAnalysis`: 选中的策略分析数据
- `analysisLoading`: 分析加载状态
- `pagination`: 分页信息

**主要功能方法**:
- `loadStrategies()`: 加载策略列表（默认按胜率降序）
- `handleViewAnalysis()`: 查看策略分析详情

**表格列**:
- 策略名称
- 描述
- 胜率（标签颜色：>60% 绿色，>40% 黄色，其他灰色）
- 平均得分
- 总游戏数
- 总胜利数
- 操作（查看分析按钮）

**分析详情模态框显示**:
- 统计数据（4 列）:
  - 胜率（百分比，>60% 绿色）
  - 平均得分
  - 总游戏数
  - 总胜利数
- 胜率进度条
- 策略信息描述列表:
  - 策略名称
  - 描述
  - 总失败数
  - 创建时间
  - 更新时间

**策略数据排序**:
- 默认按 `winRate` 降序排列
- 支持按胜率、平均得分、总游戏数排序

---

### `EventProgress.tsx` - 事件进度页面

**路由**: `/game/:sessionId/events`

**主要功能**:
- 查看活跃的多回合事件
- 查看事件进度
- 实时进度更新

**核心特性**:
- 实时事件列表更新（WebSocket）
- 事件进度可视化（Progress 组件）
- 事件完成状态显示
- 定期刷新（5 秒）

**组件状态**:
- `eventsData`: 活跃事件数据
- `loading`: 加载状态

**WebSocket 事件监听**:
- `event_progress_updated`: 事件进度更新 → 刷新列表
- `event_completed`: 事件完成 → 刷新列表并显示提示

**主要功能方法**:
- `loadActiveEvents()`: 加载活跃事件列表

**定期刷新**:
- 每 5 秒自动刷新事件列表

**显示的事件信息**:
- 事件内容
- 事件类型（single_round/multi_round/rule）
- 完成状态（已完成标签）
- 进度百分比（进度条）
- 回合进度（当前/目标，如果有）
- 有效回合数
- 上次更新回合（如果有）
- 创建者
- 创建时间、更新时间

**事件类型颜色**:
- `single_round`: 蓝色
- `multi_round`: 橙色
- `rule`: 紫色

**进度显示**:
- 进度条显示百分比（0-100%）
- 如果完成，进度条状态为 `success`
- 显示回合进度详情（当前/目标回合）

**UI 布局**:
- 顶部：标题、WebSocket 状态、会话 ID、当前回合
- 事件列表：每个事件一个卡片
  - 卡片标题：事件内容 + 类型标签 + 完成标签
  - 卡片内容：进度条、回合信息、创建者信息、时间信息

**空状态**:
- 如果没有活跃事件，显示提示信息

---

## 🧪 测试页面

### `TestWebSocket.tsx` - WebSocket 测试页面

**路由**: `/test-websocket`

**主要功能**:
- WebSocket 连接测试
- 发送测试消息
- 查看连接日志

**核心特性**:
- 连接状态显示
- 消息日志记录
- 手动重连功能
- 测试消息发送

**组件状态**:
- `connected`: WebSocket 连接状态
- `messages`: 消息日志列表

**主要功能方法**:
- `handleSendTest()`: 发送测试消息
- `handleReconnect()`: 重新连接 WebSocket

**WebSocket 事件监听**:
- `connect`: 连接成功 → 记录日志
- `disconnect`: 断开连接 → 记录日志
- `error`: 错误 → 记录错误日志

**UI 布局**:
- 连接状态标签（绿色/红色）
- 发送测试消息按钮
- 重新连接按钮
- 消息日志列表（滚动列表，最大高度 400px）

**用途**:
- 开发调试时测试 WebSocket 连接
- 验证 WebSocket 服务是否正常工作

---

## 📊 页面路由关系图

```
/ (Home)
├── /login (Login)
├── /register (Register)
├── /forgot-password (ForgotPassword)
├── /reset-password (ResetPassword)
├── /rooms (Rooms)
│   └── /rooms/:roomId/wait (WaitingRoom)
│       └── /rooms/:roomId/host-setup (HostSetup)
├── /game/:sessionId (GameSession)
│   ├── /game/:sessionId/state (GameState) [主持人]
│   ├── /game/:sessionId/review (HostReview) [主持人]
│   ├── /game/:sessionId/round/:round/inference (InferenceResult)
│   ├── /game/:sessionId/trade (Trade)
│   ├── /game/:sessionId/tasks (Tasks)
│   ├── /game/:sessionId/saves (GameSave)
│   └── /game/:sessionId/events (EventProgress)
├── /game/history (GameHistory)
├── /user/strategies (StrategyAnalysis)
└── /test-websocket (TestWebSocket)
```

---

## 🔄 页面跳转流程

### 玩家流程

```
Home → Rooms → WaitingRoom → GameSession
                                    ↓
                           InferenceResult (结果阶段自动跳转)
                                    ↓
                           GameSession (下一回合)
```

### 主持人流程

```
Home → Rooms → WaitingRoom → HostSetup → GameState
                                                    ↓
                                            HostReview (决策阶段结束后)
                                                    ↓
                                            InferenceResult (提交推演后)
                                                    ↓
                                            GameState (查看结果)
                                                    ↓
                                            GameState (进入下一回合)
```

---

## 📝 技术要点总结

### WebSocket 事件使用

所有游戏相关页面都会使用 WebSocket 进行实时通信：

**常用事件**:
- `game_state_update`: 游戏状态更新
- `round_stage_changed`: 回合阶段变化
- `decision_status_update`: 决策状态更新
- `inference_started`: 推演开始
- `inference_completed`: 推演完成
- `inference_failed`: 推演失败
- `player_joined`: 玩家加入
- `player_left`: 玩家离开

### 状态管理

所有页面都使用：
- `useAuthStore`: 用户认证状态（Zustand）
- 本地 `useState`: 页面特定状态
- WebSocket 实时更新

### 路由守卫

通过 `ProtectedRoute` 组件保护需要认证的页面：
- 未认证用户自动跳转到 `/login`
- 已认证用户正常访问

### 权限控制

- **主持人权限**: 通过比较 `user.id` 和 `room.hostId` 或 `session.hostId` 判断
- **玩家权限**: 所有玩家都可以访问游戏相关页面，但某些操作需要特定角色

---

## 🎨 UI 设计特点

1. **统一风格**: 使用 Ant Design 组件库，保持一致的 UI 风格
2. **毛玻璃效果**: 部分页面（如 GameSave、GameSession）使用毛玻璃卡片效果
3. **响应式布局**: 使用 Ant Design 的 Grid 系统（Row/Col）进行布局
4. **实时反馈**: WebSocket 状态标签、加载状态、消息提示
5. **状态可视化**: 进度条、标签、时间线等可视化组件

---

## 🧩 前端核心组件和模块

### 应用入口和路由

#### `main.tsx` - 应用入口文件

**功能**:
- React 应用启动入口
- 配置 Ant Design 中文语言包
- 渲染根组件 `App`

**核心特性**:
- 使用 `ReactDOM.createRoot` 创建根节点
- 使用 `ConfigProvider` 配置 Ant Design 国际化（中文）
- 启用 React StrictMode

---

#### `App.tsx` - 根组件和路由配置

**功能**:
- 定义应用的所有路由
- 使用 `ProtectedRoute` 保护需要认证的路由
- 配置路由与页面组件的映射关系

**路由结构**:
- `/` - 首页（受保护）
- `/login` - 登录页面（公开）
- `/register` - 注册页面（公开）
- `/rooms` - 房间列表（受保护）
- `/rooms/:roomId/wait` - 等待房间（受保护）
- `/rooms/:roomId/host-setup` - 主持人配置（受保护）
- `/game/:sessionId` - 游戏会话（受保护）
- `/game/:sessionId/review` - 主持人审核（受保护）
- `/game/:sessionId/round/:round/inference` - 推演结果（受保护）
- `/game/:sessionId/events` - 事件进度（受保护）
- `/game/:sessionId/state` - 游戏状态（受保护）
- `/game/history` - 游戏历史（受保护）
- `/game/:sessionId/trade` - 交易页面（受保护）
- `/game/:sessionId/saves` - 存档页面（受保护）
- `/game/:sessionId/tasks` - 任务页面（受保护）
- `/user/strategies` - 策略分析（受保护）
- `/test-websocket` - WebSocket 测试（公开）

**技术实现**:
- 使用 `react-router-dom` 的 `BrowserRouter` 和 `Routes`
- 使用 Ant Design 的 `Layout` 组件
- 所有需要认证的路由都包裹在 `ProtectedRoute` 中

---

### 通用组件 (Components)

#### `GlassCard.tsx` - 毛玻璃卡片组件

**功能**:
- 提供统一的毛玻璃效果卡片样式
- 支持动画效果（淡入和上移）
- 可自定义标题和额外内容

**Props**:
- `children`: React 子节点（卡片内容）
- `title`: 卡片标题（可选）
- `extra`: 额外内容（可选，显示在标题右侧）
- `className`: 自定义 CSS 类名
- `delay`: 动画延迟时间（秒，默认 0）

**核心特性**:
- 使用 `framer-motion` 实现动画效果
- 毛玻璃背景样式（`glass-panel` 类）
- 标题和内容区域分离

**使用场景**:
- 游戏存档页面
- 游戏会话页面
- 其他需要毛玻璃效果的页面

---

#### `ProtectedRoute.tsx` - 路由守卫组件

**功能**:
- 保护需要认证才能访问的路由
- 未认证用户自动重定向到登录页
- 保存来源页面信息，登录后可以返回

**核心特性**:
- 使用 `useAuthStore` 检查认证状态
- 使用 `useLocation` 获取当前路径
- 未认证时使用 `Navigate` 组件跳转到 `/login`
- 通过 `state.from` 保存来源路径

**使用方式**:
```tsx
<ProtectedRoute>
  <YourComponent />
</ProtectedRoute>
```

---

#### `RoomCard.tsx` - 房间卡片组件

**功能**:
- 展示房间信息（名称、状态、人数、房主）
- 提供房间操作按钮（加入、离开、关闭、终止游戏）
- 根据房间状态显示不同的 UI

**Props**:
- `room`: 房间数据对象（`RoomSummary` 类型）
- `onJoin`: 加入房间回调函数
- `onLeave`: 离开房间回调函数
- `onClose`: 关闭房间回调函数（可选，仅房主）
- `onKillGame`: 终止游戏回调函数（可选，仅房主）
- `isHost`: 是否是房主（可选）
- `loading`: 加载状态（可选）

**显示的信息**:
- 房间名称（可省略显示）
- 房间状态标签（waiting/playing/closed）
- 当前人数 / 最大人数
- 房主名称
- 创建时间

**按钮逻辑**:
- 房间已满或正在游戏中时，加入按钮禁用
- 已加入的房间显示"离开"按钮
- 未加入的房间显示"加入"按钮
- 房主显示"关闭房间"和"终止游戏"按钮

---

#### `OnlineRoomsPanel.tsx` - 在线房间面板组件

**功能**:
- 侧边栏显示在线房间列表
- 实时更新房间状态
- 快速加入房间

**核心特性**:
- 使用 `Drawer` 组件实现侧边栏
- 实时监听 WebSocket 事件更新房间列表
- 显示房间名称、人数、状态

---

#### `UserRegistryPanel.tsx` - 用户注册表面板组件

**功能**:
- 侧边栏显示用户注册表
- 展示在线用户列表
- 用户信息展示

**核心特性**:
- 使用 `Drawer` 组件实现侧边栏
- 实时更新用户列表
- 显示用户头像、昵称等信息

---

### 服务层 (Services)

#### `api.ts` - HTTP 客户端配置

**功能**:
- 配置 Axios 实例
- 请求拦截器（自动添加 JWT Token）
- 响应拦截器（统一错误处理）

**核心特性**:
- **Base URL**: 从环境变量 `VITE_API_BASE_URL` 读取，默认 `http://localhost:3000/api`
- **超时设置**: 10 秒
- **请求拦截器**:
  - 从 `localStorage` 读取 `token`
  - 自动添加到 `Authorization` Header
- **响应拦截器**:
  - 返回 `response.data`（后端统一格式）
  - 401 错误时清除 Token 并跳转到登录页

**导出**:
- `apiClient`: 配置好的 Axios 实例

---

#### `auth.ts` - 认证服务

**功能**:
- 用户注册
- 用户登录
- Token 刷新
- 用户信息管理

**API 方法**:
- `authAPI.register()`: 注册新用户
- `authAPI.login()`: 用户登录
- `authAPI.refreshToken()`: 刷新 Token
- `userAPI.getUserInfo()`: 获取当前用户信息
- `userAPI.updateUserInfo()`: 更新用户信息
- `userAPI.uploadAvatar()`: 上传头像

**数据类型**:
- `RegisterData`: 注册数据（username, password）
- `LoginData`: 登录数据（username, password）
- `User`: 用户信息（id, username, nickname, avatarUrl, level, experience 等）
- `AuthResponse`: 认证响应（token, user）

---

#### `rooms.ts` - 房间服务

**功能**:
- 房间列表管理
- 房间创建、加入、离开
- 房间配置管理
- 主持人配置管理

**API 方法**:
- `roomsAPI.list()`: 获取房间列表
- `roomsAPI.create()`: 创建房间
- `roomsAPI.join()`: 加入房间
- `roomsAPI.leave()`: 离开房间
- `roomsAPI.close()`: 关闭房间（房主）
- `roomsAPI.killGame()`: 终止游戏（房主）
- `hostConfigAPI.get()`: 获取主持人配置
- `hostConfigAPI.updateApi()`: 更新 API 配置
- `hostConfigAPI.updateRules()`: 更新游戏规则
- `hostConfigAPI.updatePlayers()`: 更新玩家配置
- `hostConfigAPI.validate()`: 验证配置
- `hostConfigAPI.complete()`: 完成配置

**数据类型**:
- `RoomSummary`: 房间摘要信息
- `HostConfig`: 主持人配置信息

---

#### `game.ts` - 游戏服务

**功能**:
- 游戏会话管理
- 决策提交和查询
- 推演结果获取
- 游戏状态管理
- 临时事件和规则管理
- 游戏存档管理
- 任务管理
- 游戏历史查询
- AI 推荐决策选项

**主要 API 方法**:
- `startGame()`: 开始游戏
- `getSession()`: 获取游戏会话信息
- `submitDecision()`: 提交决策
- `getRoundDecisions()`: 获取回合决策列表
- `getReviewDecisions()`: 获取审核决策列表
- `getDecisionOptions()`: 获取 AI 推荐的决策选项
- `getInferenceResult()`: 获取推演结果
- `startReview()`: 进入审核阶段
- `submitToAI()`: 提交给 AI 推演
- `nextRound()`: 进入下一回合
- `getGameState()`: 获取游戏状态
- `addTemporaryEvent()`: 添加临时事件
- `addTemporaryRule()`: 添加临时规则
- `saveGame()`: 保存游戏
- `getGameSaves()`: 获取存档列表
- `restoreGame()`: 恢复存档
- `getTasks()`: 获取任务列表
- `getGameHistory()`: 获取游戏历史

**数据类型**:
- `GameSessionSummary`: 游戏会话摘要
- `DecisionSummary`: 决策摘要
- `InferenceData`: 推演数据
- `TemporaryEvent`: 临时事件
- `TemporaryRule`: 临时规则

---

#### `websocket.ts` - WebSocket 服务

**功能**:
- WebSocket 连接管理
- 房间和会话跟踪
- 消息发送和接收
- 自动重连机制
- 动态服务器地址配置
- 网络延迟检测

**核心类**: `WebSocketService`

**主要方法**:
- `connect(token)`: 连接 WebSocket（需要 Token）
- `disconnect()`: 断开连接
- `send(event, data, ack?)`: 发送消息
- `sendWithAck(event, data, timeoutMs)`: 发送消息并等待确认
- `on(event, callback)`: 监听事件
- `off(event, callback?)`: 取消监听事件
- `trackRoom(roomId)`: 跟踪房间
- `setActiveSession(sessionId)`: 设置活动会话
- `setServerUrl(url)`: 设置服务器地址（局域网联机）
- `getServerUrl()`: 获取当前服务器地址
- `getLatency()`: 获取当前网络延迟
- `addConnectionStatusListener(listener)`: 添加连接状态监听器
- `removeConnectionStatusListener(listener)`: 移除连接状态监听器

**核心特性**:
- 自动重连（最多 5 次）
- 房间状态管理（自动加入/离开）
- 心跳机制（每 30 秒）
- 连接状态管理
- 延迟检测（每 5 秒 ping 一次）
- 动态服务器地址（支持局域网联机）
- 增量状态同步

**WebSocket URL**: 从环境变量 `VITE_WS_URL` 读取，或通过 `setServerUrl()` 动态设置

---

#### `trade.ts` - 交易服务

**功能**:
- 交易请求管理
- 交易响应（接受/拒绝）
- 交易取消
- 交易列表查询

**API 方法**:
- `tradeAPI.list()`: 获取交易列表
- `tradeAPI.request()`: 发起交易请求
- `tradeAPI.respond()`: 响应交易请求
- `tradeAPI.cancel()`: 取消交易

**数据类型**:
- `Trade`: 交易信息
- `TradeRequest`: 交易请求数据

---

#### `strategy.ts` - 策略服务

**功能**:
- 策略列表查询
- 策略分析详情
- 策略创建和更新

**API 方法**:
- `strategyAPI.getStrategies()`: 获取策略列表（支持分页和排序）
- `strategyAPI.getStrategyAnalysis()`: 获取策略分析详情
- `strategyAPI.createStrategy()`: 创建策略
- `strategyAPI.updateStrategy()`: 更新策略

**数据类型**:
- `Strategy`: 策略信息
- `StrategyAnalysis`: 策略分析数据

---

#### `admin.ts` - 管理员服务

**功能**:
- 用户管理（冻结、解冻、删除）
- 房间管理（关闭房间）

**API 方法**:
- `adminAPI.freezeUser()`: 冻结用户
- `adminAPI.unfreezeUser()`: 解冻用户
- `adminAPI.deleteUser()`: 删除用户
- `adminAPI.closeRoom()`: 关闭房间
- `adminAPI.listRooms()`: 获取房间列表（管理员）

**权限要求**: 需要管理员权限

---

### 自定义 Hooks

#### `useSocket.ts` - WebSocket 连接状态 Hook

**功能**:
- 管理 WebSocket 连接状态
- 自动连接和断开
- 心跳机制

**返回值**: `SocketConnectionStatus` 类型
- `'disconnected'`: 未连接
- `'connecting'`: 连接中
- `'connected'`: 已连接

**核心特性**:
- 根据 Token 自动连接/断开
- 每 30 秒发送心跳
- 监听连接状态变化

**使用方式**:
```tsx
const socketStatus = useSocket();
```

---

#### `useMessageRouter.ts` - WebSocket 消息路由 Hook

**功能**:
- 统一处理 WebSocket 消息
- 自动显示消息提示
- 过滤当前用户自己的消息

**处理的消息类型**:
- `system_message`: 系统消息 → 显示 info 提示
- `chat_message`: 聊天消息 → 显示 info 提示
- `player_joined`: 玩家加入 → 显示 success 提示（排除自己）
- `player_left`: 玩家离开 → 显示 warning 提示（排除自己）
- `game_started`: 游戏开始 → 显示 success 提示
- `round_stage_changed`: 回合阶段变化 → 显示 info 提示
- `decision_status_update`: 决策状态更新 → 显示 info 提示
- `inference_started`: 推演开始 → 显示 info 提示
- `inference_completed`: 推演完成 → 显示 success 提示
- `inference_failed`: 推演失败 → 显示 error 提示
- `error`: 错误消息 → 显示 error 提示

**核心特性**:
- 使用 Ant Design 的 `message` API 显示提示
- 自动过滤当前用户自己的操作消息
- 在组件挂载时注册，卸载时清理

**使用方式**:
```tsx
useMessageRouter(); // 在组件顶层调用即可
```

---

### 状态管理 (Stores)

#### `authStore.ts` - 认证状态管理

**功能**:
- 管理用户认证状态
- 存储用户信息和 Token
- 持久化到 localStorage

**技术栈**: Zustand + persist middleware

**状态字段**:
- `isAuthenticated`: 是否已认证（boolean）
- `user`: 用户信息对象（User | null）
- `token`: JWT Token（string | null）

**方法**:
- `login(token, user)`: 登录（保存 Token 和用户信息）
- `logout()`: 登出（清除所有认证信息）
- `setUser(user)`: 更新用户信息
- `checkAuth()`: 检查认证状态（从 localStorage 读取 Token）

**持久化**:
- 使用 `persist` middleware
- 存储键名: `'auth-storage'`
- 自动同步到 localStorage

**使用方式**:
```tsx
const { user, isAuthenticated, login, logout } = useAuthStore();
```

---

### 样式文件

#### `App.css` - 应用全局样式

**功能**:
- 定义全局 CSS 样式
- 游戏相关页面样式
- 毛玻璃效果样式
- 响应式布局样式

**主要内容**:
- 游戏容器样式（`.game-shell`, `.game-container`）
- 状态栏样式（`.status-bar`）
- 卡片样式（`.card-panel`, `.glass-panel`）
- 决策输入样式（`.decision-input`）
- 房间卡片样式（`.room-card`）

---

#### `index.css` - 基础样式

**功能**:
- 重置浏览器默认样式
- 定义 CSS 变量
- 基础工具类

---

#### `vite-env.d.ts` - TypeScript 环境变量声明

**功能**:
- 声明 Vite 环境变量的类型
- 提供 TypeScript 类型支持

**声明的环境变量**:
- `VITE_API_BASE_URL`: API 基础 URL
- `VITE_WS_URL`: WebSocket URL
- `VITE_ADMIN_USERNAME`: 管理员用户名

---

### 局域网联机相关组件

#### `ConnectionStatus.tsx` - 连接状态组件

**功能**:
- 显示 WebSocket 连接状态
- 显示实时网络延迟
- 提供连接状态可视化

**核心特性**:
- 三种连接状态：已连接（绿色）、连接中（蓝色）、未连接（红色）
- 延迟颜色指示：<100ms 绿色、100-300ms 黄色、>300ms 红色
- 使用 WebSocket 服务的连接状态监听器

**显示内容**:
- 连接状态标签（Badge 组件）
- 延迟数值（毫秒）

---

#### `ServerConfig.tsx` - 服务器配置页面

**路由**: `/server-config`

**功能**:
- 手动配置服务器 IP 和端口
- 自动发现局域网内的游戏服务器
- 测试服务器连接
- 保存服务器配置

**核心特性**:
- 自动发现：通过 HTTP 探测常见局域网地址
- 手动配置：输入 IP 和端口
- 连接测试：验证服务器是否可达
- 配置持久化：保存到 localStorage

**组件状态**:
- `ip`: 服务器 IP 地址
- `port`: 服务器端口
- `discoveredServers`: 发现的服务器列表
- `connectionStatus`: 连接测试状态

---

#### `udpDiscovery.ts` - UDP 发现服务

**功能**:
- 在浏览器环境下发现局域网内的游戏服务器
- 通过 HTTP 探测常见局域网地址
- 管理发现的服务器列表

**核心类**: `UdpDiscoveryService`

**主要方法**:
- `startDiscovery(callback)`: 开始发现服务器
- `stopDiscovery()`: 停止发现
- `addServerManually(ip, port)`: 手动添加服务器
- `getDiscoveredServers()`: 获取发现的服务器列表

**探测策略**:
- 尝试连接 localhost、192.168.1.1、192.168.0.1 等常见地址
- 探测端口 3000-3002
- 通过 `/health` 端点验证服务器

---

**文档生成时间**: 2024-12-24  
**项目版本**: 1.0.0

