# 快捷双击功能介绍

> 本文档介绍项目中所有可双击运行的快捷工具文件，帮助开发者快速执行常用操作。

---

## 📋 目录

- [一、开发环境管理](#一开发环境管理)
  - [1.1 run-dev.bat - 一键启动开发环境](#11-run-devbat---一键启动开发环境)（如果卡住请多按几次回车）
  - [1.2 docker-start.bat - 启动 Docker 服务](#12-docker-startbat---启动-docker-服务)
  - [1.3 docker-stop.bat - 停止 Docker 服务](#13-docker-stopbat---停止-docker-服务)
  - [1.4 check-status.bat - 检查项目状态](#14-check-statusbat---检查项目状态)

- [二、数据库管理](#二数据库管理)
  - [2.1 check-db.bat - 数据库连接诊断](#21-check-dbbat---数据库连接诊断)
  - [2.2 prisma-studio.bat - 数据库可视化工具](#22-prisma-studiobat---数据库可视化工具)
  - [2.3 seed-db.bat - 填充测试数据](#23-seed-dbbat---填充测试数据)
  - [2.4 cleanup-db.bat - 清理数据库过期数据](#24-cleanup-dbbat---清理数据库过期数据)
  - [2.5 check-developer.bat - 检查开发者账号](#25-check-developerbat---检查开发者账号)

- [三、代码管理](#三代码管理)
  - [3.1 format-code.bat - 格式化代码](#31-format-codebat---格式化代码)

- [四、项目维护](#四项目维护)
  - [4.1 cleanup-project.bat - 清理项目垃圾数据](#41-cleanup-projectbat---清理项目垃圾数据)

---

## 一、开发环境管理

### 1.1 run-dev.bat - 一键启动开发环境

**位置**: 项目根目录  
**功能**: 一键启动前后端开发服务器

**自动完成的操作**:
1. ✅ 检查 Node.js 环境
2. ✅ 启动 Docker 服务（PostgreSQL + Redis）
3. ✅ 配置后端环境（自动创建 `.env` 文件）
4. ✅ 安装后端依赖
5. ✅ 运行数据库迁移
6. ✅ 等待数据库就绪
7. ✅ 填充数据库种子数据
8. ✅ 安装前端依赖
9. ✅ 启动后端和前端开发服务器

**使用场景**:
- 首次启动项目
- 日常开发启动
- 环境重置后启动

**启动后访问**:
- 后端: http://localhost:3000
- 前端: http://localhost:5173

**默认测试账号**:
- 开发者账号: `developer` / `000000`
- 测试用户1: `testuser1` / `Test1234!`
- 测试用户2: `testuser2` / `Test1234!`
- 测试用户3: `testuser3` / `Test1234!`
- 演示玩家: `demo_player` / `demo123`
- 开发者代码: `wskfz`（用于管理面板）

---

### 1.2 docker-start.bat - 启动 Docker 服务

**位置**: 项目根目录  
**功能**: 启动 PostgreSQL 和 Redis 容器

**使用场景**:
- 只需要启动数据库服务，不需要启动前后端
- Docker 服务意外停止后重启
- 单独测试数据库功能

**执行内容**:
- 启动 `game-postgres` 容器（PostgreSQL）
- 启动 `game-redis` 容器（Redis）
- 显示容器运行状态

---

### 1.3 docker-stop.bat - 停止 Docker 服务

**位置**: 项目根目录  
**功能**: 停止所有 Docker 容器

**使用场景**:
- 需要停止数据库服务
- 释放系统资源
- 准备关闭开发环境

**执行内容**:
- 停止并删除所有相关容器
- 清理网络资源

---

### 1.4 check-status.bat - 检查项目状态

**位置**: 项目根目录  
**功能**: 全面检查项目运行状态

**检查内容**:
1. Node.js 安装和版本
2. Docker 安装和服务状态
3. 数据库连接状态
4. 后端依赖安装状态
5. 前端依赖安装状态

**使用场景**:
- 快速了解项目环境是否正常
- 故障排查时检查各项状态
- 新环境配置后验证

**输出信息**:
- ✅ 正常状态
- ✗ 异常状态
- 容器运行状态
- 数据库连接结果

---

## 二、数据库管理

### 2.1 check-db.bat - 数据库连接诊断

**位置**: 项目根目录  
**功能**: 诊断数据库连接和配置

**检查内容**:
1. 环境变量配置（DATABASE_URL）
2. 数据库连接测试
3. 数据库表结构检查
4. 数据统计查询

**使用场景**:
- 数据库连接失败时诊断
- 验证数据库配置是否正确
- 检查数据库表是否正常

**输出示例**:
```
✓ DATABASE_URL 已设置
✓ 数据库连接成功
✓ 找到 8 个表
✓ 查询成功，用户表中有 X 条记录
```

---

### 2.2 prisma-studio.bat - 数据库可视化工具

**位置**: 项目根目录  
**功能**: 打开 Prisma Studio 数据库可视化界面

**访问地址**: http://localhost:5555

**功能特性**:
- 可视化查看所有表和数据
- 直接编辑数据库记录
- 支持数据筛选和搜索
- 友好的用户界面

**使用场景**:
- 查看数据库数据
- 手动编辑测试数据
- 调试数据问题
- 验证数据操作结果

**注意事项**:
- 工具会在浏览器中自动打开
- 按 `Ctrl+C` 停止服务
- 建议在开发环境使用，生产环境谨慎使用

---

### 2.3 seed-db.bat - 填充测试数据

**位置**: 项目根目录  
**功能**: 填充测试账号和初始数据

**填充内容**:
- 开发者账号（如果不存在）
- 测试用户账号（testuser1, testuser2, testuser3, demo_player）
- 示例房间数据

**使用场景**:
- 首次配置数据库后初始化数据
- 重置数据库后恢复测试数据
- 添加新的测试账号

**默认账号**:
- 开发者账号: `developer` / `000000`
- 测试用户1: `testuser1` / `Test1234!`
- 测试用户2: `testuser2` / `Test1234!`
- 测试用户3: `testuser3` / `Test1234!`
- 演示玩家: `demo_player` / `demo123`

---

### 2.4 cleanup-db.bat - 清理数据库过期数据

**位置**: 项目根目录  
**功能**: 清理过期的房间、会话、事件等数据

**清理内容**:
- 已关闭超过 7 天的房间
- 已结束超过 7 天的游戏会话
- 过期的临时事件（已完成超过 7 天，或未完成但超过 30 天）
- 已离开房间超过 30 天的玩家记录

**使用场景**:
- 定期清理测试数据
- 释放数据库空间
- 保持数据库整洁

**注意事项**:
- 清理操作不可逆
- 建议定期运行（如每周一次）
- 生产环境谨慎使用

---

### 2.5 check-developer.bat - 检查开发者账号

**位置**: 项目根目录  
**功能**: 检查并修复开发者账号

**检查内容**:
1. 数据库连接状态
2. 开发者账号是否存在
3. 密码是否正确
4. 如果不存在或密码错误，自动创建/修复

**使用场景**:
- 开发者账号登录失败时
- 验证开发者账号状态
- 重置开发者账号密码

**支持的账号**:
- `developer`
- `开发者账号`
- 环境变量 `ADMIN_USERNAME` 指定的用户名

**默认密码**: `000000`

---

## 三、代码管理

### 3.1 format-code.bat - 格式化代码

**位置**: 项目根目录  
**功能**: 格式化后端和前端代码

**格式化内容**:
- 后端 TypeScript 代码（使用 Prettier）
- 前端 TypeScript/TSX 代码（如果配置了格式化命令）

**使用场景**:
- 提交代码前格式化
- 统一代码风格
- 修复代码格式问题

**注意事项**:
- 会修改代码文件
- 建议在提交前运行
- 确保已保存所有更改

---

## 四、项目维护

### 4.1 cleanup-project.bat - 清理项目垃圾数据

**位置**: 项目根目录  
**功能**: 一键扫描并清理项目垃圾数据

**清理内容**:

#### 文件系统垃圾
- **后端**: `node_modules`, `dist`, `logs`, `*.tsbuildinfo`, `*.log`, `uploads`
- **前端**: `node_modules`, `dist`, `.vite`, `*.log`
- **根目录**: `.DS_Store`, `Thumbs.db`, `*.tmp`

#### 数据库垃圾
- 已关闭超过 7 天的房间
- 已结束超过 7 天的游戏会话
- 过期的临时事件
- 已离开房间超过 30 天的玩家记录

#### Docker 垃圾
- 未使用的镜像
- 停止的容器
- 未使用的卷
- 构建缓存

**使用场景**:
- 定期清理项目（建议每周一次）
- 释放磁盘空间
- 保持项目整洁

**注意事项**:
- 清理操作不可逆
- 会删除 `node_modules`，需要重新安装依赖
- 会删除构建产物，需要重新构建

**预期效果**:
- 可释放数百 MB 到数 GB 的磁盘空间
- 清理后需要运行 `run-dev.bat` 重新安装依赖

---

## 📌 使用建议

### 日常开发流程

1. **启动项目**: 双击 `run-dev.bat`
2. **查看数据库**: 双击 `prisma-studio.bat`
3. **诊断问题**: 双击 `check-db.bat` 或 `check-status.bat`
4. **提交代码前**: 双击 `format-code.bat`

### 数据库管理流程

1. **初始化数据**: 双击 `seed-db.bat`
2. **查看数据**: 双击 `prisma-studio.bat`
3. **诊断连接**: 双击 `check-db.bat`
4. **定期清理**: 双击 `cleanup-db.bat`

### 故障排查流程

1. **检查整体状态**: 双击 `check-status.bat`
2. **检查数据库**: 双击 `check-db.bat`
3. **检查开发者账号**: 双击 `check-developer.bat`
4. **查看详细日志**: 查看后端日志文件

### 定期维护

- **每周**: 运行 `cleanup-project.bat` 清理项目
- **每月**: 运行 `cleanup-db.bat` 清理数据库
- **需要时**: 运行 `seed-db.bat` 重置测试数据

---

## 🔧 故障排除

### 问题：双击文件无反应

**可能原因**:
1. PowerShell 执行策略限制
2. 文件路径包含特殊字符
3. 权限不足

**解决方案**:
1. 右键以管理员身份运行
2. 检查 PowerShell 执行策略：`Get-ExecutionPolicy`
3. 手动运行：`powershell -ExecutionPolicy Bypass -File <脚本名>.ps1`

### 问题：命令执行失败

**可能原因**:
1. 未安装 Node.js 或 Docker
2. 环境变量未配置
3. 依赖未安装

**解决方案**:
1. 运行 `check-status.bat` 检查环境
2. 确保已运行 `run-dev.bat` 完成初始化
3. 查看错误信息，根据提示修复

### 问题：数据库连接失败

**可能原因**:
1. Docker 服务未启动
2. `.env` 文件配置错误
3. 数据库容器异常

**解决方案**:
1. 运行 `docker-start.bat` 启动服务
2. 运行 `check-db.bat` 诊断问题
3. 检查 `docker ps` 查看容器状态

---

## 📝 相关文档

- `必读说明.md` - 项目完整说明文档
- `双击工具建议清单.md` - 工具创建建议和规划
- `rebuild/production/backend/环境配置指南.md` - 详细环境配置指南
- `rebuild/production/backend/环境变量说明.md` - 环境变量详细说明

---

**文档版本**: v1.0  
**最后更新**: 2024年12月23日  
**维护者**: 开发团队

