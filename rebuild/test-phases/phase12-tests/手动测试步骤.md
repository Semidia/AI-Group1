# 第十二阶段手动测试步骤

## 已完成的工作

1. ✅ 数据库Schema已更新（添加Trade模型）
2. ✅ 后端API路由已创建（`src/routes/trade.ts`）
3. ✅ 后端路由已注册（`server.ts`）
4. ✅ 前端服务已创建（`src/services/trade.ts`）
5. ✅ 前端页面已创建（`src/pages/Trade.tsx`）
6. ✅ 前端路由已注册（`App.tsx`）
7. ✅ 测试脚本已创建（`test-phase12.ps1`）

## 需要手动完成的步骤

### 1. 数据库迁移

在 `rebuild/production/backend` 目录下运行：

```powershell
npx prisma db push --accept-data-loss
```

或者如果提示需要重置：

```powershell
npx prisma migrate reset --force
npx prisma migrate dev --name add_trade_model
```

### 2. 启动后端服务

确保后端服务正在运行：

```powershell
cd rebuild/production/backend
npm run dev
```

### 3. 运行测试

在项目根目录运行：

```powershell
cd rebuild/test-phases/phase12-tests
.\test-phase12.ps1
```

## 功能说明

### 后端API

- `POST /api/game/:sessionId/trade/request` - 发起交易请求
- `POST /api/game/:sessionId/trade/:tradeId/respond` - 响应交易（接受/拒绝）
- `GET /api/game/:sessionId/trade/list` - 获取交易列表
- `DELETE /api/game/:sessionId/trade/:tradeId` - 取消交易

### 前端页面

访问路径：`/game/:sessionId/trade`

功能：
- 查看交易列表
- 发起交易请求
- 接受/拒绝交易
- 取消交易
- WebSocket实时通知

## 注意事项

1. 交易只能在游戏进行中（status='playing'）发起
2. 交易有过期时间（默认5分钟）
3. 不能与自己交易
4. 不能重复向同一用户发起待处理的交易

