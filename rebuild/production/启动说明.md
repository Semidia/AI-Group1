# 项目启动说明

## 前置要求
- Node.js ≥ 18
- Docker & Docker Compose（如可用）
- npm / yarn

## 一键启动（推荐）
在 `rebuild\production` 目录双击 `run-dev.bat`，脚本会完成：
1) 检查 Node.js；2) 启动 Docker（PostgreSQL/Redis）；3) 生成后端 `.env`；4) 安装依赖；5) 迁移 + 种子数据；6) 安装前端依赖；7) 启动前后端（会弹出两个 PowerShell 窗口）。

访问：
- 后端：http://localhost:3000
- 前端：http://localhost:5173

默认账号：
- developer / 000000
- testuser1 / Test1234!
- testuser2 / Test1234!
- testuser3 / Test1234!
- demo_player / demo123
- 开发者代码（管理面板）：wskfz

> 关闭脚本打开的 PowerShell 窗口会停止对应服务。

## 手动启动

### 1. 启动数据库服务

```bash
cd backend
docker-compose up -d
```

这将启动：
- PostgreSQL (端口 5432)
- Redis (端口 6379)

### 2. 后端启动

```bash
cd backend
npm install
cp .env.example .env   # 填好数据库等配置
npm run prisma:migrate
npm run dev
```

后端将在 http://localhost:3000 启动

### 3. 前端启动

```bash
cd frontend
npm install
cp .env.example .env   # 可选
npm run dev
```

前端将在 http://localhost:5173 启动

## 验证安装

1) http://localhost:3000/health 返回 `{"status":"ok",...}`
2) http://localhost:5173 能正常打开，登录后可进 `/rooms` 创建/加入房间

## 实用工具（新增）
- 日志监控：在 `rebuild/production/backend` 运行 `.\monitor-api-logs.ps1`（过滤 AI/游戏相关日志）。
- 房间重置：房主可调用 `POST /api/rooms/:roomId/reset-game` 清空旧对局（需要 Token）。
- 推演结果：推演完成会广播 `roundStatus = result`，玩家端自动跳结果页，主持人端可直接查看并“进入下一回合”。

## 常见问题

### 数据库连接失败
- 确保 Docker 容器正在运行：`docker ps`
- 检查 .env 文件中的 DATABASE_URL 配置

### 端口被占用
- 修改 backend/.env 中的 PORT
- 修改 frontend/vite.config.ts 中的 port

### Prisma 迁移失败
- 确保数据库容器已启动
- 检查 DATABASE_URL 是否正确
- 运行 `npm run prisma:generate` 重新生成客户端

## 下一步
> 已通过联合脚本 `各阶段测试用/全阶段共同测试/test-phase1-3.ps1` 完成阶段1/2/3。

- 已完成：基础搭建、用户认证、房间基础流（前端 `/rooms` 列表/创建/加入/离开，订阅房间事件刷新）。
- 可继续：房间等待页与后续实时通信、Socket ack、Redis 状态缓存、第四阶段 WS 目录化处理。

