# 项目启动说明

## 前置要求

- Node.js >= 18
- Docker & Docker Compose
- npm 或 yarn

## 一键化启动（推荐）

项目提供了 `run-dev.bat` 脚本，可以一键完成所有配置和启动步骤。

### 使用 run-dev.bat

在 `rebuild\production` 目录下，双击运行 `run-dev.bat`，脚本会自动完成：

1. ✅ **检查 Node.js 环境** - 验证 Node.js (>= 18) 是否已安装
2. ✅ **启动 Docker 服务** - 自动启动 PostgreSQL 和 Redis 容器（如果 Docker 可用）
3. ✅ **配置后端环境** - 自动创建 `.env` 文件（如果不存在，会调用 `scripts\setup-env.ps1`）
4. ✅ **安装后端依赖** - 自动运行 `npm install`（仅在 node_modules 不存在时）
5. ✅ **数据库迁移** - 自动运行 `npm run prisma:migrate`
6. ✅ **等待数据库就绪** - 自动检测数据库连接状态（最多等待 60 秒）
7. ✅ **数据库种子数据** - 自动运行 `npm run seed` 填充测试数据
8. ✅ **安装前端依赖** - 自动运行前端 `npm install`（仅在 node_modules 不存在时）
9. ✅ **启动开发服务器** - 自动在新 PowerShell 窗口中启动后端和前端服务

**启动后访问地址：**
- 后端：http://localhost:3000
- 前端：http://localhost:5173

**默认测试账号：**
- 开发者账号：`developer` / `000000`
- 测试用户1：`testuser1` / `Test1234!`
- 测试用户2：`testuser2` / `Test1234!`
- 测试用户3：`testuser3` / `Test1234!`
- 演示玩家：`demo_player` / `demo123`
- 开发者代码：`wskfz`（用于管理面板）

> **注意**：`run-dev.bat` 会打开两个新的 PowerShell 窗口分别运行后端和前端服务，请保持这些窗口运行。关闭窗口会停止对应的服务。

## 快速启动（手动步骤）

### 1. 启动数据库服务

```bash
cd backend
docker-compose up -d
```

这将启动：
- PostgreSQL (端口 5432)
- Redis (端口 6379)

### 2. 后端启动

```bash
cd backend

# 安装依赖
npm install

# 配置环境变量
cp .env.example .env
# 编辑 .env 文件，设置数据库连接等信息

# 运行数据库迁移
npm run prisma:migrate

# 启动开发服务器
npm run dev
```

后端将在 http://localhost:3000 启动

### 3. 前端启动

```bash
cd frontend

# 安装依赖
npm install

# 配置环境变量（可选）
cp .env.example .env

# 启动开发服务器
npm run dev
```

前端将在 http://localhost:5173 启动

## 验证安装

1. 访问 http://localhost:3000/health 应该返回 `{"status":"ok",...}`
2. 访问 http://localhost:5173 应该看到前端页面（登录后可进入 `/rooms` 进行房间创建/加入）

## 常见问题

### 数据库连接失败
- 确保 Docker 容器正在运行：`docker ps`
- 检查 .env 文件中的 DATABASE_URL 配置

### 端口被占用
- 修改 backend/.env 中的 PORT
- 修改 frontend/vite.config.ts 中的 port

### Prisma 迁移失败
- 确保数据库容器已启动
- 检查 DATABASE_URL 是否正确
- 运行 `npm run prisma:generate` 重新生成客户端

## 下一步
> 已通过联合脚本 `各阶段测试用/全阶段共同测试/test-phase1-3.ps1` 完成阶段1/2/3。

- 已完成：基础搭建、用户认证、房间基础流（前端 `/rooms` 列表/创建/加入/离开，订阅房间事件刷新）。
- 可继续：房间等待页与后续实时通信、Socket ack、Redis 状态缓存、第四阶段 WS 目录化处理。

